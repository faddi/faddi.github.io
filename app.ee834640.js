(function () {var oe=this;async function pe(){return new Promise(e=>{_a.pki.rsa.generateKeyPair({bits:2048,workers:-1},function(r,t){e(r?{isError:!0,type:"failed-to-gen-key",error:r}:{isError:!1,result:t})})})}function Ja(e){const r=document.querySelector(e);if(null===r)throw Error(`Could not find ${e}`);return r}function qe(){return{sendSection:Ja("#send-secret"),receiveSection:Ja("#receive-secret"),showSendSectionButton:Ja("#show-send-section-button"),showReceiveSectionButton:Ja("#show-receive-section-button"),generateKeysButton:Ja("#generate-keys-button"),receivePublicKeyArea:Ja("#receive-public-key"),receivePrivateKeyArea:Ja("#receive-private-key"),encryptMessageButton:Ja("#encrypt-message-button"),sendPublicKeyArea:Ja("#send-public-key"),secretMessageArea:Ja("#secret-message-area"),sendEncryptedMessageArea:Ja("#send-encrypted-message-area"),receiveEncryptedMessageArea:Ja("#receive-encrypted-message-area"),decryptedMessageArea:Ja("#decrypted-message-area"),decryptMessageButton:Ja("#decrypt-message-button")}}var _a={};var aa={};aa={options:{usePureJavaScript:!1}};function tb($,r){aa.cipher.registerAlgorithm($,function(){return new aa.aes.Algorithm($,r)})}var re=false;function ab(){if(re)return;re=true}var Zc={},$c=(ab(),{}).Buffer,nc={};Zc=nc;var _c={};function se(r,e){var t=0,a=e.length,n=e.charAt(0),f=[0];for(t=0;t<r.length();++t){for(var o=0,$=r.at(t);o<f.length;++o)$+=f[o]<<8,f[o]=$%a,$=$/a|0;for(;$>0;)f.push($%a),$=$/a|0}var h="";for(t=0;0===r.at(t)&&t<r.length()-1;++t)h+=n;for(t=f.length-1;t>=0;--t)h+=e[f[t]];return h}nc.encode=function(r,e,t){if("string"!=typeof e)throw new TypeError("\"alphabet\" must be a string.");if(void 0!==t&&"number"!=typeof t)throw new TypeError("\"maxline\" must be a number.");var a="";if(r instanceof Uint8Array){var n=0,f=e.length,o=e.charAt(0),$=[0];for(n=0;n<r.length;++n){for(var h=0,v=r[n];h<$.length;++h)v+=$[h]<<8,$[h]=v%f,v=v/f|0;for(;v>0;)$.push(v%f),v=v/f|0}for(n=0;0===r[n]&&n<r.length-1;++n)a+=o;for(n=$.length-1;n>=0;--n)a+=e[$[n]]}else a=se(r,e);if(t){var i=new RegExp(".{1,"+t+"}","g");a=a.match(i).join("\r\n")}return a},nc.decode=function(r,e){if("string"!=typeof r)throw new TypeError("\"input\" must be a string.");if("string"!=typeof e)throw new TypeError("\"alphabet\" must be a string.");var t=_c[e];if(!t){t=_c[e]=[];for(var a=0;a<e.length;++a)t[e.charCodeAt(a)]=a}r=r.replace(/\s/g,"");var n=e.length,f=e.charAt(0),o=[0];for(a=0;a<r.length;a++){var $=t[r.charCodeAt(a)];if(void 0===$)return;for(var h=0,v=$;h<o.length;++h)v+=o[h]*n,o[h]=255&v,v>>=8;for(;v>0;)o.push(255&v),v>>=8}for(var i=0;r[i]===f&&i<r.length-1;++i)o.push(0);return void 0!==$c?$c.from(o.reverse()):new Uint8Array(o.reverse())};var ad=(ab(),{}).Buffer,Gb=(ab(),{}),ga=aa.util=aa.util||{};function Hb(t){if(8!==t&&16!==t&&24!==t&&32!==t)throw new Error("Only 8, 16, 24, or 32 bits supported: "+t)}function oc(t){if(this.data="",this.read=0,"string"==typeof t)this.data=t;else if(ga.isArrayBuffer(t)||ga.isArrayBufferView(t)){if(void 0!==ad&&t instanceof ad)this.data=t.toString("binary");else{var r=new Uint8Array(t);try{this.data=String.fromCharCode.apply(null,r)}catch(a){for(var e=0;e<r.length;++e)this.putByte(r[e])}}}else(t instanceof oc||"object"==typeof t&&"string"==typeof t.data&&"number"==typeof t.read)&&(this.data=t.data,this.read=t.read);this._constructedStringLength=0}!function(){if(void 0!==Gb&&Gb.nextTick,"function"==typeof setImmediate)return ga.setImmediate=function(){return setImmediate.apply(void 0,arguments)},void(ga.nextTick=function(t){return setImmediate(t)});if(ga.setImmediate=function(t){setTimeout(t,0)},"undefined"!=typeof window&&"function"==typeof window.postMessage){var t="forge.setImmediate",r=[];ga.setImmediate=function(e){r.push(e),1===r.length&&window.postMessage(t,"*")},window.addEventListener("message",function(e){if(e.source===window&&e.data===t){e.stopPropagation();var a=r.slice();r.length=0,a.forEach(function(t){t()})}},!0)}if("undefined"!=typeof MutationObserver){var e=Date.now(),a=!0,i=document.createElement("div");r=[];new MutationObserver(function(){var t=r.slice();r.length=0,t.forEach(function(t){t()})}).observe(i,{attributes:!0});var n=ga.setImmediate;ga.setImmediate=function(t){Date.now()-e>15?(e=Date.now(),n(t)):(r.push(t),1===r.length&&i.setAttribute("a",a=!a))}}ga.nextTick=ga.setImmediate}(),ga.isNodejs=void 0!==Gb&&Gb.versions&&Gb.versions.node,ga.globalScope=ga.isNodejs?oe:"undefined"==typeof self?window:self,ga.isArray=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},ga.isArrayBuffer=function(t){return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer},ga.isArrayBufferView=function(t){return t&&ga.isArrayBuffer(t.buffer)&&void 0!==t.byteLength},ga.ByteBuffer=oc,ga.ByteStringBuffer=oc;var te=4096;function ue(t,r){r=r||{},this.read=r.readOffset||0,this.growSize=r.growSize||1024;var e=ga.isArrayBuffer(t),a=ga.isArrayBufferView(t);if(e||a)return this.data=e?new DataView(t):new DataView(t.buffer,t.byteOffset,t.byteLength),void(this.write="writeOffset"in r?r.writeOffset:this.data.byteLength);this.data=new DataView(new ArrayBuffer(0)),this.write=0,null!=t&&this.putBytes(t),"writeOffset"in r&&(this.write=r.writeOffset)}ga.ByteStringBuffer.prototype._optimizeConstructedString=function(t){this._constructedStringLength+=t,this._constructedStringLength>te&&(this.data.substr(0,1),this._constructedStringLength=0)},ga.ByteStringBuffer.prototype.length=function(){return this.data.length-this.read},ga.ByteStringBuffer.prototype.isEmpty=function(){return this.length()<=0},ga.ByteStringBuffer.prototype.putByte=function(t){return this.putBytes(String.fromCharCode(t))},ga.ByteStringBuffer.prototype.fillWithByte=function(t,r){t=String.fromCharCode(t);for(var e=this.data;r>0;)1&r&&(e+=t),(r>>>=1)>0&&(t+=t);return this.data=e,this._optimizeConstructedString(r),this},ga.ByteStringBuffer.prototype.putBytes=function(t){return this.data+=t,this._optimizeConstructedString(t.length),this},ga.ByteStringBuffer.prototype.putString=function(t){return this.putBytes(ga.encodeUtf8(t))},ga.ByteStringBuffer.prototype.putInt16=function(t){return this.putBytes(String.fromCharCode(t>>8&255)+String.fromCharCode(255&t))},ga.ByteStringBuffer.prototype.putInt24=function(t){return this.putBytes(String.fromCharCode(t>>16&255)+String.fromCharCode(t>>8&255)+String.fromCharCode(255&t))},ga.ByteStringBuffer.prototype.putInt32=function(t){return this.putBytes(String.fromCharCode(t>>24&255)+String.fromCharCode(t>>16&255)+String.fromCharCode(t>>8&255)+String.fromCharCode(255&t))},ga.ByteStringBuffer.prototype.putInt16Le=function(t){return this.putBytes(String.fromCharCode(255&t)+String.fromCharCode(t>>8&255))},ga.ByteStringBuffer.prototype.putInt24Le=function(t){return this.putBytes(String.fromCharCode(255&t)+String.fromCharCode(t>>8&255)+String.fromCharCode(t>>16&255))},ga.ByteStringBuffer.prototype.putInt32Le=function(t){return this.putBytes(String.fromCharCode(255&t)+String.fromCharCode(t>>8&255)+String.fromCharCode(t>>16&255)+String.fromCharCode(t>>24&255))},ga.ByteStringBuffer.prototype.putInt=function(t,r){Hb(r);var e="";do{r-=8,e+=String.fromCharCode(t>>r&255)}while(r>0);return this.putBytes(e)},ga.ByteStringBuffer.prototype.putSignedInt=function(t,r){return t<0&&(t+=2<<r-1),this.putInt(t,r)},ga.ByteStringBuffer.prototype.putBuffer=function(t){return this.putBytes(t.getBytes())},ga.ByteStringBuffer.prototype.getByte=function(){return this.data.charCodeAt(this.read++)},ga.ByteStringBuffer.prototype.getInt16=function(){var t=this.data.charCodeAt(this.read)<<8^this.data.charCodeAt(this.read+1);return this.read+=2,t},ga.ByteStringBuffer.prototype.getInt24=function(){var t=this.data.charCodeAt(this.read)<<16^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2);return this.read+=3,t},ga.ByteStringBuffer.prototype.getInt32=function(){var t=this.data.charCodeAt(this.read)<<24^this.data.charCodeAt(this.read+1)<<16^this.data.charCodeAt(this.read+2)<<8^this.data.charCodeAt(this.read+3);return this.read+=4,t},ga.ByteStringBuffer.prototype.getInt16Le=function(){var t=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8;return this.read+=2,t},ga.ByteStringBuffer.prototype.getInt24Le=function(){var t=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16;return this.read+=3,t},ga.ByteStringBuffer.prototype.getInt32Le=function(){var t=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16^this.data.charCodeAt(this.read+3)<<24;return this.read+=4,t},ga.ByteStringBuffer.prototype.getInt=function(t){Hb(t);var r=0;do{r=(r<<8)+this.data.charCodeAt(this.read++),t-=8}while(t>0);return r},ga.ByteStringBuffer.prototype.getSignedInt=function(t){var r=this.getInt(t),e=2<<t-2;return r>=e&&(r-=e<<1),r},ga.ByteStringBuffer.prototype.getBytes=function(t){var r;return t?(t=Math.min(this.length(),t),r=this.data.slice(this.read,this.read+t),this.read+=t):0===t?r="":(r=0===this.read?this.data:this.data.slice(this.read),this.clear()),r},ga.ByteStringBuffer.prototype.bytes=function(t){return void 0===t?this.data.slice(this.read):this.data.slice(this.read,this.read+t)},ga.ByteStringBuffer.prototype.at=function(t){return this.data.charCodeAt(this.read+t)},ga.ByteStringBuffer.prototype.setAt=function(t,r){return this.data=this.data.substr(0,this.read+t)+String.fromCharCode(r)+this.data.substr(this.read+t+1),this},ga.ByteStringBuffer.prototype.last=function(){return this.data.charCodeAt(this.data.length-1)},ga.ByteStringBuffer.prototype.copy=function(){var t=ga.createBuffer(this.data);return t.read=this.read,t},ga.ByteStringBuffer.prototype.compact=function(){return this.read>0&&(this.data=this.data.slice(this.read),this.read=0),this},ga.ByteStringBuffer.prototype.clear=function(){return this.data="",this.read=0,this},ga.ByteStringBuffer.prototype.truncate=function(t){var r=Math.max(0,this.length()-t);return this.data=this.data.substr(this.read,r),this.read=0,this},ga.ByteStringBuffer.prototype.toHex=function(){for(var t="",r=this.read;r<this.data.length;++r){var e=this.data.charCodeAt(r);e<16&&(t+="0"),t+=e.toString(16)}return t},ga.ByteStringBuffer.prototype.toString=function(){return ga.decodeUtf8(this.bytes())},ga.DataBuffer=ue,ga.DataBuffer.prototype.length=function(){return this.write-this.read},ga.DataBuffer.prototype.isEmpty=function(){return this.length()<=0},ga.DataBuffer.prototype.accommodate=function(t,r){if(this.length()>=t)return this;r=Math.max(r||this.growSize,t);var e=new Uint8Array(this.data.buffer,this.data.byteOffset,this.data.byteLength),a=new Uint8Array(this.length()+r);return a.set(e),this.data=new DataView(a.buffer),this},ga.DataBuffer.prototype.putByte=function(t){return this.accommodate(1),this.data.setUint8(this.write++,t),this},ga.DataBuffer.prototype.fillWithByte=function(t,r){this.accommodate(r);for(var e=0;e<r;++e)this.data.setUint8(t);return this},ga.DataBuffer.prototype.putBytes=function(t,r){if(ga.isArrayBufferView(t)){var e=(a=new Uint8Array(t.buffer,t.byteOffset,t.byteLength)).byteLength-a.byteOffset;return this.accommodate(e),new Uint8Array(this.data.buffer,this.write).set(a),this.write+=e,this}if(ga.isArrayBuffer(t)){var a=new Uint8Array(t);return this.accommodate(a.byteLength),new Uint8Array(this.data.buffer).set(a,this.write),this.write+=a.byteLength,this}if(t instanceof ga.DataBuffer||"object"==typeof t&&"number"==typeof t.read&&"number"==typeof t.write&&ga.isArrayBufferView(t.data)){a=new Uint8Array(t.data.byteLength,t.read,t.length());return this.accommodate(a.byteLength),new Uint8Array(t.data.byteLength,this.write).set(a),this.write+=a.byteLength,this}if(t instanceof ga.ByteStringBuffer&&(t=t.data,r="binary"),r=r||"binary","string"==typeof t){var i;if("hex"===r)return this.accommodate(Math.ceil(t.length/2)),i=new Uint8Array(this.data.buffer,this.write),this.write+=ga.binary.hex.decode(t,i,this.write),this;if("base64"===r)return this.accommodate(3*Math.ceil(t.length/4)),i=new Uint8Array(this.data.buffer,this.write),this.write+=ga.binary.base64.decode(t,i,this.write),this;if("utf8"===r&&(t=ga.encodeUtf8(t),r="binary"),"binary"===r||"raw"===r)return this.accommodate(t.length),i=new Uint8Array(this.data.buffer,this.write),this.write+=ga.binary.raw.decode(i),this;if("utf16"===r)return this.accommodate(2*t.length),i=new Uint16Array(this.data.buffer,this.write),this.write+=ga.text.utf16.encode(i),this;throw new Error("Invalid encoding: "+r)}throw Error("Invalid parameter: "+t)},ga.DataBuffer.prototype.putBuffer=function(t){return this.putBytes(t),t.clear(),this},ga.DataBuffer.prototype.putString=function(t){return this.putBytes(t,"utf16")},ga.DataBuffer.prototype.putInt16=function(t){return this.accommodate(2),this.data.setInt16(this.write,t),this.write+=2,this},ga.DataBuffer.prototype.putInt24=function(t){return this.accommodate(3),this.data.setInt16(this.write,t>>8&65535),this.data.setInt8(this.write,t>>16&255),this.write+=3,this},ga.DataBuffer.prototype.putInt32=function(t){return this.accommodate(4),this.data.setInt32(this.write,t),this.write+=4,this},ga.DataBuffer.prototype.putInt16Le=function(t){return this.accommodate(2),this.data.setInt16(this.write,t,!0),this.write+=2,this},ga.DataBuffer.prototype.putInt24Le=function(t){return this.accommodate(3),this.data.setInt8(this.write,t>>16&255),this.data.setInt16(this.write,t>>8&65535,!0),this.write+=3,this},ga.DataBuffer.prototype.putInt32Le=function(t){return this.accommodate(4),this.data.setInt32(this.write,t,!0),this.write+=4,this},ga.DataBuffer.prototype.putInt=function(t,r){Hb(r),this.accommodate(r/8);do{r-=8,this.data.setInt8(this.write++,t>>r&255)}while(r>0);return this},ga.DataBuffer.prototype.putSignedInt=function(t,r){return Hb(r),this.accommodate(r/8),t<0&&(t+=2<<r-1),this.putInt(t,r)},ga.DataBuffer.prototype.getByte=function(){return this.data.getInt8(this.read++)},ga.DataBuffer.prototype.getInt16=function(){var t=this.data.getInt16(this.read);return this.read+=2,t},ga.DataBuffer.prototype.getInt24=function(){var t=this.data.getInt16(this.read)<<8^this.data.getInt8(this.read+2);return this.read+=3,t},ga.DataBuffer.prototype.getInt32=function(){var t=this.data.getInt32(this.read);return this.read+=4,t},ga.DataBuffer.prototype.getInt16Le=function(){var t=this.data.getInt16(this.read,!0);return this.read+=2,t},ga.DataBuffer.prototype.getInt24Le=function(){var t=this.data.getInt8(this.read)^this.data.getInt16(this.read+1,!0)<<8;return this.read+=3,t},ga.DataBuffer.prototype.getInt32Le=function(){var t=this.data.getInt32(this.read,!0);return this.read+=4,t},ga.DataBuffer.prototype.getInt=function(t){Hb(t);var r=0;do{r=(r<<8)+this.data.getInt8(this.read++),t-=8}while(t>0);return r},ga.DataBuffer.prototype.getSignedInt=function(t){var r=this.getInt(t),e=2<<t-2;return r>=e&&(r-=e<<1),r},ga.DataBuffer.prototype.getBytes=function(t){var r;return t?(t=Math.min(this.length(),t),r=this.data.slice(this.read,this.read+t),this.read+=t):0===t?r="":(r=0===this.read?this.data:this.data.slice(this.read),this.clear()),r},ga.DataBuffer.prototype.bytes=function(t){return void 0===t?this.data.slice(this.read):this.data.slice(this.read,this.read+t)},ga.DataBuffer.prototype.at=function(t){return this.data.getUint8(this.read+t)},ga.DataBuffer.prototype.setAt=function(t,r){return this.data.setUint8(t,r),this},ga.DataBuffer.prototype.last=function(){return this.data.getUint8(this.write-1)},ga.DataBuffer.prototype.copy=function(){return new ga.DataBuffer(this)},ga.DataBuffer.prototype.compact=function(){if(this.read>0){var t=new Uint8Array(this.data.buffer,this.read),r=new Uint8Array(t.byteLength);r.set(t),this.data=new DataView(r),this.write-=this.read,this.read=0}return this},ga.DataBuffer.prototype.clear=function(){return this.data=new DataView(new ArrayBuffer(0)),this.read=this.write=0,this},ga.DataBuffer.prototype.truncate=function(t){return this.write=Math.max(0,this.length()-t),this.read=Math.min(this.read,this.write),this},ga.DataBuffer.prototype.toHex=function(){for(var t="",r=this.read;r<this.data.byteLength;++r){var e=this.data.getUint8(r);e<16&&(t+="0"),t+=e.toString(16)}return t},ga.DataBuffer.prototype.toString=function(t){var r=new Uint8Array(this.data,this.read,this.length());if("binary"===(t=t||"utf8")||"raw"===t)return ga.binary.raw.encode(r);if("hex"===t)return ga.binary.hex.encode(r);if("base64"===t)return ga.binary.base64.encode(r);if("utf8"===t)return ga.text.utf8.decode(r);if("utf16"===t)return ga.text.utf16.decode(r);throw new Error("Invalid encoding: "+t)},ga.createBuffer=function(t,r){return r=r||"raw",void 0!==t&&"utf8"===r&&(t=ga.encodeUtf8(t)),new ga.ByteBuffer(t)},ga.fillString=function(t,r){for(var e="";r>0;)1&r&&(e+=t),(r>>>=1)>0&&(t+=t);return e},ga.xorBytes=function(t,r,e){for(var a="",i="",n="",h=0,u=0;e>0;--e,++h)i=t.charCodeAt(h)^r.charCodeAt(h),u>=10&&(a+=n,n="",u=0),n+=String.fromCharCode(i),++u;return a+=n},ga.hexToBytes=function(t){var r="",e=0;for(!0&t.length&&(e=1,r+=String.fromCharCode(parseInt(t[0],16)));e<t.length;e+=2)r+=String.fromCharCode(parseInt(t.substr(e,2),16));return r},ga.bytesToHex=function(t){return ga.createBuffer(t).toHex()},ga.int32ToBytes=function(t){return String.fromCharCode(t>>24&255)+String.fromCharCode(t>>16&255)+String.fromCharCode(t>>8&255)+String.fromCharCode(255&t)};var db="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",eb=[62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,64,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51],bd="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";ga.encode64=function(t,r){for(var e,a,i,n="",h="",u=0;u<t.length;)e=t.charCodeAt(u++),a=t.charCodeAt(u++),i=t.charCodeAt(u++),n+=db.charAt(e>>2),n+=db.charAt((3&e)<<4|a>>4),isNaN(a)?n+="==":(n+=db.charAt((15&a)<<2|i>>6),n+=isNaN(i)?"=":db.charAt(63&i)),r&&n.length>r&&(h+=n.substr(0,r)+"\r\n",n=n.substr(r));return h+=n},ga.decode64=function(t){t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(var r,e,a,i,n="",h=0;h<t.length;)r=eb[t.charCodeAt(h++)-43],e=eb[t.charCodeAt(h++)-43],a=eb[t.charCodeAt(h++)-43],i=eb[t.charCodeAt(h++)-43],n+=String.fromCharCode(r<<2|e>>4),64!==a&&(n+=String.fromCharCode((15&e)<<4|a>>2),64!==i&&(n+=String.fromCharCode((3&a)<<6|i)));return n},ga.encodeUtf8=function(t){return unescape(encodeURIComponent(t))},ga.decodeUtf8=function(t){return decodeURIComponent(escape(t))},ga.binary={raw:{},hex:{},base64:{},base58:{},baseN:{encode:Zc.encode,decode:Zc.decode}},ga.binary.raw.encode=function(t){return String.fromCharCode.apply(null,t)},ga.binary.raw.decode=function(t,r,e){var a=r;a||(a=new Uint8Array(t.length));for(var i=e=e||0,n=0;n<t.length;++n)a[i++]=t.charCodeAt(n);return r?i-e:a},ga.binary.hex.encode=ga.bytesToHex,ga.binary.hex.decode=function(t,r,e){var a=r;a||(a=new Uint8Array(Math.ceil(t.length/2)));var i=0,n=e=e||0;for(1&t.length&&(i=1,a[n++]=parseInt(t[0],16));i<t.length;i+=2)a[n++]=parseInt(t.substr(i,2),16);return r?n-e:a},ga.binary.base64.encode=function(t,r){for(var e,a,i,n="",h="",u=0;u<t.byteLength;)e=t[u++],a=t[u++],i=t[u++],n+=db.charAt(e>>2),n+=db.charAt((3&e)<<4|a>>4),isNaN(a)?n+="==":(n+=db.charAt((15&a)<<2|i>>6),n+=isNaN(i)?"=":db.charAt(63&i)),r&&n.length>r&&(h+=n.substr(0,r)+"\r\n",n=n.substr(r));return h+=n},ga.binary.base64.decode=function(t,r,e){var a,i,n,h,u=r;u||(u=new Uint8Array(3*Math.ceil(t.length/4))),t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(var $=0,o=e=e||0;$<t.length;)a=eb[t.charCodeAt($++)-43],i=eb[t.charCodeAt($++)-43],n=eb[t.charCodeAt($++)-43],h=eb[t.charCodeAt($++)-43],u[o++]=a<<2|i>>4,64!==n&&(u[o++]=(15&i)<<4|n>>2,64!==h&&(u[o++]=(3&n)<<6|h));return r?o-e:u.subarray(0,o)},ga.binary.base58.encode=function(t,r){return ga.binary.baseN.encode(t,bd,r)},ga.binary.base58.decode=function(t,r){return ga.binary.baseN.decode(t,bd,r)},ga.text={utf8:{},utf16:{}},ga.text.utf8.encode=function(t,r,e){t=ga.encodeUtf8(t);var a=r;a||(a=new Uint8Array(t.length));for(var i=e=e||0,n=0;n<t.length;++n)a[i++]=t.charCodeAt(n);return r?i-e:a},ga.text.utf8.decode=function(t){return ga.decodeUtf8(String.fromCharCode.apply(null,t))},ga.text.utf16.encode=function(t,r,e){var a=r;a||(a=new Uint8Array(2*t.length));for(var i=new Uint16Array(a.buffer),n=e=e||0,h=e,u=0;u<t.length;++u)i[h++]=t.charCodeAt(u),n+=2;return r?n-e:a},ga.text.utf16.decode=function(t){return String.fromCharCode.apply(null,new Uint16Array(t.buffer))},ga.deflate=function(t,r,e){if(r=ga.decode64(t.deflate(ga.encode64(r)).rval),e){var a=2;32&r.charCodeAt(1)&&(a=6),r=r.substring(a,r.length-4)}return r},ga.inflate=function(t,r,e){var a=t.inflate(ga.encode64(r)).rval;return null===a?null:ga.decode64(a)};var pc=function(t,r,e){if(!t)throw new Error("WebStorage not available.");var a;if(null===e?a=t.removeItem(r):(e=ga.encode64(JSON.stringify(e)),a=t.setItem(r,e)),void 0!==a&&!0!==a.rval){var i=new Error(a.error.message);throw i.id=a.error.id,i.name=a.error.name,i}},qc=function(t,r){if(!t)throw new Error("WebStorage not available.");var e=t.getItem(r);if(t.init)if(null===e.rval){if(e.error){var a=new Error(e.error.message);throw a.id=e.error.id,a.name=e.error.name,a}e=null}else e=e.rval;return null!==e&&(e=JSON.parse(ga.decode64(e))),e},ve=function(t,r,e,a){var i=qc(t,r);null===i&&(i={}),i[e]=a,pc(t,r,i)},we=function(t,r,e){var a=qc(t,r);return null!==a&&(a=e in a?a[e]:null),a},xe=function(t,r,e){var a=qc(t,r);if(null!==a&&e in a){delete a[e];var i=!0;for(var n in a){i=!1;break}i&&(a=null),pc(t,r,a)}},ye=function(t,r){pc(t,r,null)},Sb=function(t,r,e){var a,i=null;void 0===e&&(e=["web","flash"]);var n=!1,h=null;for(var u in e){a=e[u];try{if("flash"===a||"both"===a){if(null===r[0])throw new Error("Flash local storage not available.");i=t.apply(this,r),n="flash"===a}"web"!==a&&"both"!==a||(r[0]=localStorage,i=t.apply(this,r),n=!0)}catch($){h=$}if(n)break}if(!n)throw h;return i};ga.setItem=function(t,r,e,a,i){Sb(ve,arguments,i)},ga.getItem=function(t,r,e,a){return Sb(we,arguments,a)},ga.removeItem=function(t,r,e,a){Sb(xe,arguments,a)},ga.clearItems=function(t,r,e){Sb(ye,arguments,e)},ga.parseUrl=function(t){var r=/^(https?):\/\/([^:&^\/]*):?(\d*)(.*)$/g;r.lastIndex=0;var e=r.exec(t),a=null===e?null:{full:t,scheme:e[1],host:e[2],port:e[3],path:e[4]};return a&&(a.fullHost=a.host,a.port?80!==a.port&&"http"===a.scheme?a.fullHost+=":"+a.port:443!==a.port&&"https"===a.scheme&&(a.fullHost+=":"+a.port):"http"===a.scheme?a.port=80:"https"===a.scheme&&(a.port=443),a.full=a.scheme+"://"+a.fullHost),a};var cd=null;ga.getQueryVariables=function(t){var r,e=function(t){for(var r={},e=t.split("&"),a=0;a<e.length;a++){var i,n,h=e[a].indexOf("=");h>0?(i=e[a].substring(0,h),n=e[a].substring(h+1)):(i=e[a],n=null),i in r||(r[i]=[]),i in Object.prototype||null===n||r[i].push(unescape(n))}return r};return void 0===t?(null===cd&&(cd="undefined"!=typeof window&&window.location&&window.location.search?e(window.location.search.substring(1)):{}),r=cd):r=e(t),r},ga.parseFragment=function(t){var r=t,e="",a=t.indexOf("?");a>0&&(r=t.substring(0,a),e=t.substring(a+1));var i=r.split("/");return i.length>0&&""===i[0]&&i.shift(),{pathString:r,queryString:e,path:i,query:""===e?{}:ga.getQueryVariables(e)}},ga.makeRequest=function(t){var r=ga.parseFragment(t),e={path:r.pathString,query:r.queryString,getPath:function(t){return void 0===t?r.path:r.path[t]},getQuery:function(t,e){var a;return void 0===t?a=r.query:(a=r.query[t])&&void 0!==e&&(a=a[e]),a},getQueryLast:function(t,r){var a=e.getQuery(t);return a?a[a.length-1]:r}};return e},ga.makeLink=function(t,r,e){t=jQuery.isArray(t)?t.join("/"):t;var a=jQuery.param(r||{});return e=e||"",t+(a.length>0?"?"+a:"")+(e.length>0?"#"+e:"")},ga.setPath=function(t,r,e){if("object"==typeof t&&null!==t)for(var a=0,i=r.length;a<i;){var n=r[a++];if(a==i)t[n]=e;else{var h=(n in t);(!h||h&&"object"!=typeof t[n]||h&&null===t[n])&&(t[n]={}),t=t[n]}}},ga.getPath=function(t,r,e){for(var a=0,i=r.length,n=!0;n&&a<i&&"object"==typeof t&&null!==t;){var h=r[a++];(n=h in t)&&(t=t[h])}return n?t:e},ga.deletePath=function(t,r){if("object"==typeof t&&null!==t)for(var e=0,a=r.length;e<a;){var i=r[e++];if(e==a)delete t[i];else{if(!(i in t)||"object"!=typeof t[i]||null===t[i])break;t=t[i]}}},ga.isEmpty=function(t){for(var r in t)if(t.hasOwnProperty(r))return!1;return!0},ga.format=function(t){for(var r,e,a=/%./g,i=0,n=[],h=0;r=a.exec(t);){(e=t.substring(h,a.lastIndex-2)).length>0&&n.push(e),h=a.lastIndex;var u=r[0][1];switch(u){case"s":case"o":i<arguments.length?n.push(arguments[1+i++]):n.push("<?>");break;case"%":n.push("%");break;default:n.push("<%"+u+"?>");}}return n.push(t.substring(h)),n.join("")},ga.formatNumber=function(t,r,e,a){var i=t,n=isNaN(r=Math.abs(r))?2:r,h=void 0===e?",":e,u=void 0===a?".":a,$=i<0?"-":"",o=parseInt(i=Math.abs(+i||0).toFixed(n),10)+"",l=o.length>3?o.length%3:0;return $+(l?o.substr(0,l)+u:"")+o.substr(l).replace(/(\d{3})(?=\d)/g,"$1"+u)+(n?h+Math.abs(i-o).toFixed(n).slice(2):"")},ga.formatSize=function(t){return t=t>=1073741824?ga.formatNumber(t/1073741824,2,".","")+" GiB":t>=1048576?ga.formatNumber(t/1048576,2,".","")+" MiB":t>=1024?ga.formatNumber(t/1024,0)+" KiB":ga.formatNumber(t,0)+" bytes"},ga.bytesFromIP=function(t){return-1!==t.indexOf(".")?ga.bytesFromIPv4(t):-1!==t.indexOf(":")?ga.bytesFromIPv6(t):null},ga.bytesFromIPv4=function(t){if(4!==(t=t.split(".")).length)return null;for(var r=ga.createBuffer(),e=0;e<t.length;++e){var a=parseInt(t[e],10);if(isNaN(a))return null;r.putByte(a)}return r.getBytes()},ga.bytesFromIPv6=function(t){for(var r=0,e=2*(8-(t=t.split(":").filter(function(t){return 0===t.length&&++r,!0})).length+r),a=ga.createBuffer(),i=0;i<8;++i)if(t[i]&&0!==t[i].length){var n=ga.hexToBytes(t[i]);n.length<2&&a.putByte(0),a.putBytes(n)}else a.fillWithByte(0,e),e=0;return a.getBytes()},ga.bytesToIP=function(t){return 4===t.length?ga.bytesToIPv4(t):16===t.length?ga.bytesToIPv6(t):null},ga.bytesToIPv4=function(t){if(4!==t.length)return null;for(var r=[],e=0;e<t.length;++e)r.push(t.charCodeAt(e));return r.join(".")},ga.bytesToIPv6=function(t){if(16!==t.length)return null;for(var r=[],e=[],a=0,i=0;i<t.length;i+=2){for(var n=ga.bytesToHex(t[i]+t[i+1]);"0"===n[0]&&"0"!==n;)n=n.substr(1);if("0"===n){var h=e[e.length-1],u=r.length;h&&u===h.end+1?(h.end=u,h.end-h.start>e[a].end-e[a].start&&(a=e.length-1)):e.push({start:u,end:u})}r.push(n)}if(e.length>0){var $=e[a];$.end-$.start>0&&(r.splice($.start,$.end-$.start+1,""),0===$.start&&r.unshift(""),7===$.end&&r.push(""))}return r.join(":")},ga.estimateCores=function(t,r){if("function"==typeof t&&(r=t,t={}),t=t||{},"cores"in ga&&!t.update)return r(null,ga.cores);if("undefined"!=typeof navigator&&"hardwareConcurrency"in navigator&&navigator.hardwareConcurrency>0)return ga.cores=navigator.hardwareConcurrency,r(null,ga.cores);if("undefined"==typeof Worker)return ga.cores=1,r(null,ga.cores);if("undefined"==typeof Blob)return ga.cores=2,r(null,ga.cores);var e=URL.createObjectURL(new Blob(["(",function(){self.addEventListener("message",function(t){for(var r=Date.now(),e=r+4;Date.now()<e;);self.postMessage({st:r,et:e})})}.toString(),")()"],{type:"application/javascript"}));!function t(a,i,n){if(0===i){var h=Math.floor(a.reduce(function(t,r){return t+r},0)/a.length);return ga.cores=Math.max(1,h),URL.revokeObjectURL(e),r(null,ga.cores)}!function(t,r){for(var a=[],i=[],n=0;n<t;++n){var h=new Worker(e);h.addEventListener("message",function(e){if(i.push(e.data),i.length===t){for(var n=0;n<t;++n)a[n].terminate();r(null,i)}}),a.push(h)}for(var n=0;n<t;++n)a[n].postMessage(n)}(n,function(r,e){a.push(function(t,r){for(var e=[],a=0;a<t;++a)for(var i=r[a],n=e[a]=[],h=0;h<t;++h)if(a!==h){var u=r[h];(i.st>u.st&&i.st<u.et||u.st>i.st&&u.st<i.et)&&n.push(h)}return e.reduce(function(t,r){return Math.max(t,r.length)},0)}(n,e)),t(a,i-1,n)})}([],5,16)};aa.cipher.algorithms=aa.cipher.algorithms||{},aa.cipher.createCipher=function(i,r){var t=i;if("string"==typeof t&&(t=aa.cipher.getAlgorithm(t))&&(t=t()),!t)throw new Error("Unsupported algorithm: "+i);return new aa.cipher.BlockCipher({algorithm:t,key:r,decrypt:!1})},aa.cipher.createDecipher=function(i,r){var t=i;if("string"==typeof t&&(t=aa.cipher.getAlgorithm(t))&&(t=t()),!t)throw new Error("Unsupported algorithm: "+i);return new aa.cipher.BlockCipher({algorithm:t,key:r,decrypt:!0})},aa.cipher.registerAlgorithm=function(i,r){i=i.toUpperCase(),aa.cipher.algorithms[i]=r},aa.cipher.getAlgorithm=function(i){return(i=i.toUpperCase())in aa.cipher.algorithms?aa.cipher.algorithms[i]:null};var rc=aa.cipher.BlockCipher=function(i){this.algorithm=i.algorithm,this.mode=this.algorithm.mode,this.blockSize=this.mode.blockSize,this._finish=!1,this._input=null,this.output=null,this._op=i.decrypt?this.mode.decrypt:this.mode.encrypt,this._decrypt=i.decrypt,this.algorithm.initialize(i)};rc.prototype.start=function(i){i=i||{};var r={};for(var t in i)r[t]=i[t];r.decrypt=this._decrypt,this._finish=!1,this._input=aa.util.createBuffer(),this.output=i.output||aa.util.createBuffer(),this.mode.start(r)},rc.prototype.update=function(i){for(i&&this._input.putBuffer(i);!this._op.call(this.mode,this._input,this.output,this._finish)&&!this._finish;);this._input.compact()},rc.prototype.finish=function(i){!i||"ECB"!==this.mode.name&&"CBC"!==this.mode.name||(this.mode.pad=function(r){return i(this.blockSize,r,!1)},this.mode.unpad=function(r){return i(this.blockSize,r,!0)});var r={};return r.decrypt=this._decrypt,r.overflow=this._input.length()%this.blockSize,!(!this._decrypt&&this.mode.pad&&!this.mode.pad(this._input,r))&&(this._finish=!0,this.update(),!(this._decrypt&&this.mode.unpad&&!this.mode.unpad(this.output,r))&&!(this.mode.afterFinish&&!this.mode.afterFinish(this.output,r)))};aa.cipher=aa.cipher||{};var ta=aa.cipher.modes=aa.cipher.modes||{};function Tb(t,i){if("string"==typeof t&&(t=aa.util.createBuffer(t)),aa.util.isArray(t)&&t.length>4){var e=t;t=aa.util.createBuffer();for(var s=0;s<e.length;++s)t.putByte(e[s])}if(t.length()<i)throw new Error("Invalid IV length; got "+t.length()+" bytes and expected "+i+" bytes.");if(!aa.util.isArray(t)){var r=[],h=i/4;for(s=0;s<h;++s)r.push(t.getInt32());t=r}return t}function Ub(t){t[t.length-1]=t[t.length-1]+1&4294967295}function sc(t){return[t/4294967296|0,4294967295&t]}ta.ecb=function(t){t=t||{},this.name="ECB",this.cipher=t.cipher,this.blockSize=t.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints)},ta.ecb.prototype.start=function(t){},ta.ecb.prototype.encrypt=function(t,i,e){if(t.length()<this.blockSize&&!(e&&t.length()>0))return!0;for(var s=0;s<this._ints;++s)this._inBlock[s]=t.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(s=0;s<this._ints;++s)i.putInt32(this._outBlock[s])},ta.ecb.prototype.decrypt=function(t,i,e){if(t.length()<this.blockSize&&!(e&&t.length()>0))return!0;for(var s=0;s<this._ints;++s)this._inBlock[s]=t.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(s=0;s<this._ints;++s)i.putInt32(this._outBlock[s])},ta.ecb.prototype.pad=function(t,i){var e=t.length()===this.blockSize?this.blockSize:this.blockSize-t.length();return t.fillWithByte(e,e),!0},ta.ecb.prototype.unpad=function(t,i){if(i.overflow>0)return!1;var e=t.length(),s=t.at(e-1);return!(s>this.blockSize<<2)&&(t.truncate(s),!0)},ta.cbc=function(t){t=t||{},this.name="CBC",this.cipher=t.cipher,this.blockSize=t.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints)},ta.cbc.prototype.start=function(t){if(null===t.iv){if(!this._prev)throw new Error("Invalid IV parameter.");this._iv=this._prev.slice(0)}else{if(!("iv"in t))throw new Error("Invalid IV parameter.");this._iv=Tb(t.iv,this.blockSize),this._prev=this._iv.slice(0)}},ta.cbc.prototype.encrypt=function(t,i,e){if(t.length()<this.blockSize&&!(e&&t.length()>0))return!0;for(var s=0;s<this._ints;++s)this._inBlock[s]=this._prev[s]^t.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(s=0;s<this._ints;++s)i.putInt32(this._outBlock[s]);this._prev=this._outBlock},ta.cbc.prototype.decrypt=function(t,i,e){if(t.length()<this.blockSize&&!(e&&t.length()>0))return!0;for(var s=0;s<this._ints;++s)this._inBlock[s]=t.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(s=0;s<this._ints;++s)i.putInt32(this._prev[s]^this._outBlock[s]);this._prev=this._inBlock.slice(0)},ta.cbc.prototype.pad=function(t,i){var e=t.length()===this.blockSize?this.blockSize:this.blockSize-t.length();return t.fillWithByte(e,e),!0},ta.cbc.prototype.unpad=function(t,i){if(i.overflow>0)return!1;var e=t.length(),s=t.at(e-1);return!(s>this.blockSize<<2)&&(t.truncate(s),!0)},ta.cfb=function(t){t=t||{},this.name="CFB",this.cipher=t.cipher,this.blockSize=t.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialBlock=new Array(this._ints),this._partialOutput=aa.util.createBuffer(),this._partialBytes=0},ta.cfb.prototype.start=function(t){if(!("iv"in t))throw new Error("Invalid IV parameter.");this._iv=Tb(t.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0},ta.cfb.prototype.encrypt=function(t,i,e){var s=t.length();if(0===s)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&s>=this.blockSize)for(var r=0;r<this._ints;++r)this._inBlock[r]=t.getInt32()^this._outBlock[r],i.putInt32(this._inBlock[r]);else{var h=(this.blockSize-s)%this.blockSize;h>0&&(h=this.blockSize-h),this._partialOutput.clear();for(r=0;r<this._ints;++r)this._partialBlock[r]=t.getInt32()^this._outBlock[r],this._partialOutput.putInt32(this._partialBlock[r]);if(h>0)t.read-=this.blockSize;else for(r=0;r<this._ints;++r)this._inBlock[r]=this._partialBlock[r];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),h>0&&!e)return i.putBytes(this._partialOutput.getBytes(h-this._partialBytes)),this._partialBytes=h,!0;i.putBytes(this._partialOutput.getBytes(s-this._partialBytes)),this._partialBytes=0}},ta.cfb.prototype.decrypt=function(t,i,e){var s=t.length();if(0===s)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&s>=this.blockSize)for(var r=0;r<this._ints;++r)this._inBlock[r]=t.getInt32(),i.putInt32(this._inBlock[r]^this._outBlock[r]);else{var h=(this.blockSize-s)%this.blockSize;h>0&&(h=this.blockSize-h),this._partialOutput.clear();for(r=0;r<this._ints;++r)this._partialBlock[r]=t.getInt32(),this._partialOutput.putInt32(this._partialBlock[r]^this._outBlock[r]);if(h>0)t.read-=this.blockSize;else for(r=0;r<this._ints;++r)this._inBlock[r]=this._partialBlock[r];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),h>0&&!e)return i.putBytes(this._partialOutput.getBytes(h-this._partialBytes)),this._partialBytes=h,!0;i.putBytes(this._partialOutput.getBytes(s-this._partialBytes)),this._partialBytes=0}},ta.ofb=function(t){t=t||{},this.name="OFB",this.cipher=t.cipher,this.blockSize=t.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialOutput=aa.util.createBuffer(),this._partialBytes=0},ta.ofb.prototype.start=function(t){if(!("iv"in t))throw new Error("Invalid IV parameter.");this._iv=Tb(t.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0},ta.ofb.prototype.encrypt=function(t,i,e){var s=t.length();if(0===t.length())return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&s>=this.blockSize)for(var r=0;r<this._ints;++r)i.putInt32(t.getInt32()^this._outBlock[r]),this._inBlock[r]=this._outBlock[r];else{var h=(this.blockSize-s)%this.blockSize;h>0&&(h=this.blockSize-h),this._partialOutput.clear();for(r=0;r<this._ints;++r)this._partialOutput.putInt32(t.getInt32()^this._outBlock[r]);if(h>0)t.read-=this.blockSize;else for(r=0;r<this._ints;++r)this._inBlock[r]=this._outBlock[r];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),h>0&&!e)return i.putBytes(this._partialOutput.getBytes(h-this._partialBytes)),this._partialBytes=h,!0;i.putBytes(this._partialOutput.getBytes(s-this._partialBytes)),this._partialBytes=0}},ta.ofb.prototype.decrypt=ta.ofb.prototype.encrypt,ta.ctr=function(t){t=t||{},this.name="CTR",this.cipher=t.cipher,this.blockSize=t.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialOutput=aa.util.createBuffer(),this._partialBytes=0},ta.ctr.prototype.start=function(t){if(!("iv"in t))throw new Error("Invalid IV parameter.");this._iv=Tb(t.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0},ta.ctr.prototype.encrypt=function(t,i,e){var s=t.length();if(0===s)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&s>=this.blockSize)for(var r=0;r<this._ints;++r)i.putInt32(t.getInt32()^this._outBlock[r]);else{var h=(this.blockSize-s)%this.blockSize;h>0&&(h=this.blockSize-h),this._partialOutput.clear();for(r=0;r<this._ints;++r)this._partialOutput.putInt32(t.getInt32()^this._outBlock[r]);if(h>0&&(t.read-=this.blockSize),this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),h>0&&!e)return i.putBytes(this._partialOutput.getBytes(h-this._partialBytes)),this._partialBytes=h,!0;i.putBytes(this._partialOutput.getBytes(s-this._partialBytes)),this._partialBytes=0}Ub(this._inBlock)},ta.ctr.prototype.decrypt=ta.ctr.prototype.encrypt,ta.gcm=function(t){t=t||{},this.name="GCM",this.cipher=t.cipher,this.blockSize=t.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints),this._partialOutput=aa.util.createBuffer(),this._partialBytes=0,this._R=3774873600},ta.gcm.prototype.start=function(t){if(!("iv"in t))throw new Error("Invalid IV parameter.");var i,e=aa.util.createBuffer(t.iv);if(this._cipherLength=0,i="additionalData"in t?aa.util.createBuffer(t.additionalData):aa.util.createBuffer(),this._tagLength="tagLength"in t?t.tagLength:128,this._tag=null,t.decrypt&&(this._tag=aa.util.createBuffer(t.tag).getBytes(),this._tag.length!==this._tagLength/8))throw new Error("Authentication tag does not match tag length.");this._hashBlock=new Array(this._ints),this.tag=null,this._hashSubkey=new Array(this._ints),this.cipher.encrypt([0,0,0,0],this._hashSubkey),this.componentBits=4,this._m=this.generateHashTable(this._hashSubkey,this.componentBits);var s=e.length();if(12===s)this._j0=[e.getInt32(),e.getInt32(),e.getInt32(),1];else{for(this._j0=[0,0,0,0];e.length()>0;)this._j0=this.ghash(this._hashSubkey,this._j0,[e.getInt32(),e.getInt32(),e.getInt32(),e.getInt32()]);this._j0=this.ghash(this._hashSubkey,this._j0,[0,0].concat(sc(8*s)))}this._inBlock=this._j0.slice(0),Ub(this._inBlock),this._partialBytes=0,i=aa.util.createBuffer(i),this._aDataLength=sc(8*i.length());var r=i.length()%this.blockSize;for(r&&i.fillWithByte(0,this.blockSize-r),this._s=[0,0,0,0];i.length()>0;)this._s=this.ghash(this._hashSubkey,this._s,[i.getInt32(),i.getInt32(),i.getInt32(),i.getInt32()])},ta.gcm.prototype.encrypt=function(t,i,e){var s=t.length();if(0===s)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&s>=this.blockSize){for(var r=0;r<this._ints;++r)i.putInt32(this._outBlock[r]^=t.getInt32());this._cipherLength+=this.blockSize}else{var h=(this.blockSize-s)%this.blockSize;h>0&&(h=this.blockSize-h),this._partialOutput.clear();for(r=0;r<this._ints;++r)this._partialOutput.putInt32(t.getInt32()^this._outBlock[r]);if(h<=0||e){if(e){var o=s%this.blockSize;this._cipherLength+=o,this._partialOutput.truncate(this.blockSize-o)}else this._cipherLength+=this.blockSize;for(r=0;r<this._ints;++r)this._outBlock[r]=this._partialOutput.getInt32();this._partialOutput.read-=this.blockSize}if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),h>0&&!e)return t.read-=this.blockSize,i.putBytes(this._partialOutput.getBytes(h-this._partialBytes)),this._partialBytes=h,!0;i.putBytes(this._partialOutput.getBytes(s-this._partialBytes)),this._partialBytes=0}this._s=this.ghash(this._hashSubkey,this._s,this._outBlock),Ub(this._inBlock)},ta.gcm.prototype.decrypt=function(t,i,e){var s=t.length();if(s<this.blockSize&&!(e&&s>0))return!0;this.cipher.encrypt(this._inBlock,this._outBlock),Ub(this._inBlock),this._hashBlock[0]=t.getInt32(),this._hashBlock[1]=t.getInt32(),this._hashBlock[2]=t.getInt32(),this._hashBlock[3]=t.getInt32(),this._s=this.ghash(this._hashSubkey,this._s,this._hashBlock);for(var r=0;r<this._ints;++r)i.putInt32(this._outBlock[r]^this._hashBlock[r]);s<this.blockSize?this._cipherLength+=s%this.blockSize:this._cipherLength+=this.blockSize},ta.gcm.prototype.afterFinish=function(t,i){var e=!0;i.decrypt&&i.overflow&&t.truncate(this.blockSize-i.overflow),this.tag=aa.util.createBuffer();var s=this._aDataLength.concat(sc(8*this._cipherLength));this._s=this.ghash(this._hashSubkey,this._s,s);var r=[];this.cipher.encrypt(this._j0,r);for(var h=0;h<this._ints;++h)this.tag.putInt32(this._s[h]^r[h]);return this.tag.truncate(this.tag.length()%(this._tagLength/8)),i.decrypt&&this.tag.bytes()!==this._tag&&(e=!1),e},ta.gcm.prototype.multiply=function(t,i){for(var e=[0,0,0,0],s=i.slice(0),r=0;r<128;++r){t[r/32|0]&1<<31-r%32&&(e[0]^=s[0],e[1]^=s[1],e[2]^=s[2],e[3]^=s[3]),this.pow(s,s)}return e},ta.gcm.prototype.pow=function(t,i){for(var e=1&t[3],s=3;s>0;--s)i[s]=t[s]>>>1|(1&t[s-1])<<31;i[0]=t[0]>>>1,e&&(i[0]^=this._R)},ta.gcm.prototype.tableMultiply=function(t){for(var i=[0,0,0,0],e=0;e<32;++e){var s=t[e/8|0]>>>4*(7-e%8)&15,r=this._m[e][s];i[0]^=r[0],i[1]^=r[1],i[2]^=r[2],i[3]^=r[3]}return i},ta.gcm.prototype.ghash=function(t,i,e){return i[0]^=e[0],i[1]^=e[1],i[2]^=e[2],i[3]^=e[3],this.tableMultiply(i)},ta.gcm.prototype.generateHashTable=function(t,i){for(var e=8/i,s=4*e,r=16*e,h=new Array(r),o=0;o<r;++o){var a=[0,0,0,0],n=(s-1-o%s)*i;a[o/s|0]=1<<i-1<<n,h[o]=this.generateSubHashTable(this.multiply(a,t),i)}return h},ta.gcm.prototype.generateSubHashTable=function(t,i){var e=1<<i,s=e>>>1,r=new Array(e);r[s]=t.slice(0);for(var h=s>>>1;h>0;)this.pow(r[2*h],r[h]=[]),h>>=1;for(h=2;h<s;){for(var o=1;o<h;++o){var a=r[h],n=r[o];r[h+o]=[a[0]^n[0],a[1]^n[1],a[2]^n[2],a[3]^n[3]]}h*=2}for(r[0]=[0,0,0,0],h=s+1;h<e;++h){var p=r[h^s];r[h]=[t[0]^p[0],t[1]^p[1],t[2]^p[2],t[3]^p[3]]}return r};aa.aes.startEncrypting=function($,r,e,a){var i=Vb({key:$,output:e,decrypt:!1,mode:a});return i.start(r),i},aa.aes.createEncryptionCipher=function($,r){return Vb({key:$,output:null,decrypt:!1,mode:r})},aa.aes.startDecrypting=function($,r,e,a){var i=Vb({key:$,output:e,decrypt:!0,mode:a});return i.start(r),i},aa.aes.createDecryptionCipher=function($,r){return Vb({key:$,output:null,decrypt:!0,mode:r})},aa.aes.Algorithm=function($,r){ed||fd();var e=this;e.name=$,e.mode=new r({blockSize:16,cipher:{encrypt:function($,r){return tc(e._w,$,r,!1)},decrypt:function($,r){return tc(e._w,$,r,!0)}}}),e._init=!1},aa.aes.Algorithm.prototype.initialize=function($){if(!this._init){var r,e=$.key;if("string"!=typeof e||16!==e.length&&24!==e.length&&32!==e.length){if(aa.util.isArray(e)&&(16===e.length||24===e.length||32===e.length)){r=e,e=aa.util.createBuffer();for(var a=0;a<r.length;++a)e.putByte(r[a])}}else e=aa.util.createBuffer(e);if(!aa.util.isArray(e)){r=e,e=[];var i=r.length();if(16===i||24===i||32===i){i>>>=2;for(a=0;a<i;++a)e.push(r.getInt32())}}if(!aa.util.isArray(e)||4!==e.length&&6!==e.length&&8!==e.length)throw new Error("Invalid key parameter.");var t=this.mode.name,o=-1!==["CFB","OFB","CTR","GCM"].indexOf(t);this._w=gd(e,$.decrypt&&!o),this._init=!0}},aa.aes._expandKey=function($,r){return ed||fd(),gd($,r)},aa.aes._updateBlock=tc,tb("AES-ECB",aa.cipher.modes.ecb),tb("AES-CBC",aa.cipher.modes.cbc),tb("AES-CFB",aa.cipher.modes.cfb),tb("AES-OFB",aa.cipher.modes.ofb),tb("AES-CTR",aa.cipher.modes.ctr),tb("AES-GCM",aa.cipher.modes.gcm);var Ka,dd,ze,ub,Xa,ed=!1,vb=4;function fd(){ed=!0,ze=[0,1,2,4,8,16,32,64,128,27,54];for(var $=new Array(256),r=0;r<128;++r)$[r]=r<<1,$[r+128]=r+128<<1^283;Ka=new Array(256),dd=new Array(256),ub=new Array(4),Xa=new Array(4);for(r=0;r<4;++r)ub[r]=new Array(256),Xa[r]=new Array(256);var e,a,i,t,o,v,k,E=0,Q=0;for(r=0;r<256;++r){t=(t=Q^Q<<1^Q<<2^Q<<3^Q<<4)>>8^255&t^99,Ka[E]=t,dd[t]=E,v=(o=$[t])<<24^t<<16^t<<8^t^o,k=((e=$[E])^(a=$[e])^(i=$[a]))<<24^(E^i)<<16^(E^a^i)<<8^E^e^i;for(var n=0;n<4;++n)ub[n][E]=v,Xa[n][t]=k,v=v<<24|v>>>8,k=k<<24|k>>>8;0===E?E=Q=1:(E=e^$[$[$[e^i]]],Q^=$[$[Q]])}}function gd($,r){for(var e,a=$.slice(0),i=1,t=a.length,o=vb*(t+6+1),v=t;v<o;++v)e=a[v-1],v%t==0?(e=Ka[e>>>16&255]<<24^Ka[e>>>8&255]<<16^Ka[255&e]<<8^Ka[e>>>24]^ze[i]<<24,i++):t>6&&v%t==4&&(e=Ka[e>>>24]<<24^Ka[e>>>16&255]<<16^Ka[e>>>8&255]<<8^Ka[255&e]),a[v]=a[v-t]^e;if(r){for(var k,E=Xa[0],Q=Xa[1],n=Xa[2],c=Xa[3],f=a.slice(0),s=(v=0,(o=a.length)-vb);v<o;v+=vb,s-=vb)if(0===v||v===o-vb)f[v]=a[s],f[v+1]=a[s+3],f[v+2]=a[s+2],f[v+3]=a[s+1];else for(var g=0;g<vb;++g)k=a[s+g],f[v+(3&-g)]=E[Ka[k>>>24]]^Q[Ka[k>>>16&255]]^n[Ka[k>>>8&255]]^c[Ka[255&k]];a=f}return a}function tc($,r,e,a){var i,t,o,v,k,E,Q,n,c,f,s,g,p=$.length/4-1;a?(i=Xa[0],t=Xa[1],o=Xa[2],v=Xa[3],k=dd):(i=ub[0],t=ub[1],o=ub[2],v=ub[3],k=Ka),E=r[0]^$[0],Q=r[a?3:1]^$[1],n=r[2]^$[2],c=r[a?1:3]^$[3];for(var u=3,l=1;l<p;++l)f=i[E>>>24]^t[Q>>>16&255]^o[n>>>8&255]^v[255&c]^$[++u],s=i[Q>>>24]^t[n>>>16&255]^o[c>>>8&255]^v[255&E]^$[++u],g=i[n>>>24]^t[c>>>16&255]^o[E>>>8&255]^v[255&Q]^$[++u],c=i[c>>>24]^t[E>>>16&255]^o[Q>>>8&255]^v[255&n]^$[++u],E=f,Q=s,n=g;e[0]=k[E>>>24]<<24^k[Q>>>16&255]<<16^k[n>>>8&255]<<8^k[255&c]^$[++u],e[a?3:1]=k[Q>>>24]<<24^k[n>>>16&255]<<16^k[c>>>8&255]<<8^k[255&E]^$[++u],e[2]=k[n>>>24]<<24^k[c>>>16&255]<<16^k[E>>>8&255]<<8^k[255&Q]^$[++u],e[a?1:3]=k[c>>>24]<<24^k[E>>>16&255]<<16^k[Q>>>8&255]<<8^k[255&n]^$[++u]}function Vb($){var r,e="AES-"+(($=$||{}).mode||"CBC").toUpperCase(),a=(r=$.decrypt?aa.cipher.createDecipher(e,$.key):aa.cipher.createCipher(e,$.key)).start;return r.start=function($,e){var i=null;e instanceof aa.util.ByteBuffer&&(i=e,e={}),(e=e||{}).output=i,e.iv=$,a.call(r,e)},r}aa.pki=aa.pki||{};var uc=aa.pki.oids=aa.oids=aa.oids||{};function ka($,r){uc[$]=r,uc[r]=$}function ya($,r){uc[$]=r}ka("1.2.840.113549.1.1.1","rsaEncryption"),ka("1.2.840.113549.1.1.4","md5WithRSAEncryption"),ka("1.2.840.113549.1.1.5","sha1WithRSAEncryption"),ka("1.2.840.113549.1.1.7","RSAES-OAEP"),ka("1.2.840.113549.1.1.8","mgf1"),ka("1.2.840.113549.1.1.9","pSpecified"),ka("1.2.840.113549.1.1.10","RSASSA-PSS"),ka("1.2.840.113549.1.1.11","sha256WithRSAEncryption"),ka("1.2.840.113549.1.1.12","sha384WithRSAEncryption"),ka("1.2.840.113549.1.1.13","sha512WithRSAEncryption"),ka("1.3.101.112","EdDSA25519"),ka("1.2.840.10040.4.3","dsa-with-sha1"),ka("1.3.14.3.2.7","desCBC"),ka("1.3.14.3.2.26","sha1"),ka("2.16.840.1.101.3.4.2.1","sha256"),ka("2.16.840.1.101.3.4.2.2","sha384"),ka("2.16.840.1.101.3.4.2.3","sha512"),ka("1.2.840.113549.2.5","md5"),ka("1.2.840.113549.1.7.1","data"),ka("1.2.840.113549.1.7.2","signedData"),ka("1.2.840.113549.1.7.3","envelopedData"),ka("1.2.840.113549.1.7.4","signedAndEnvelopedData"),ka("1.2.840.113549.1.7.5","digestedData"),ka("1.2.840.113549.1.7.6","encryptedData"),ka("1.2.840.113549.1.9.1","emailAddress"),ka("1.2.840.113549.1.9.2","unstructuredName"),ka("1.2.840.113549.1.9.3","contentType"),ka("1.2.840.113549.1.9.4","messageDigest"),ka("1.2.840.113549.1.9.5","signingTime"),ka("1.2.840.113549.1.9.6","counterSignature"),ka("1.2.840.113549.1.9.7","challengePassword"),ka("1.2.840.113549.1.9.8","unstructuredAddress"),ka("1.2.840.113549.1.9.14","extensionRequest"),ka("1.2.840.113549.1.9.20","friendlyName"),ka("1.2.840.113549.1.9.21","localKeyId"),ka("1.2.840.113549.1.9.22.1","x509Certificate"),ka("1.2.840.113549.1.12.10.1.1","keyBag"),ka("1.2.840.113549.1.12.10.1.2","pkcs8ShroudedKeyBag"),ka("1.2.840.113549.1.12.10.1.3","certBag"),ka("1.2.840.113549.1.12.10.1.4","crlBag"),ka("1.2.840.113549.1.12.10.1.5","secretBag"),ka("1.2.840.113549.1.12.10.1.6","safeContentsBag"),ka("1.2.840.113549.1.5.13","pkcs5PBES2"),ka("1.2.840.113549.1.5.12","pkcs5PBKDF2"),ka("1.2.840.113549.1.12.1.1","pbeWithSHAAnd128BitRC4"),ka("1.2.840.113549.1.12.1.2","pbeWithSHAAnd40BitRC4"),ka("1.2.840.113549.1.12.1.3","pbeWithSHAAnd3-KeyTripleDES-CBC"),ka("1.2.840.113549.1.12.1.4","pbeWithSHAAnd2-KeyTripleDES-CBC"),ka("1.2.840.113549.1.12.1.5","pbeWithSHAAnd128BitRC2-CBC"),ka("1.2.840.113549.1.12.1.6","pbewithSHAAnd40BitRC2-CBC"),ka("1.2.840.113549.2.7","hmacWithSHA1"),ka("1.2.840.113549.2.8","hmacWithSHA224"),ka("1.2.840.113549.2.9","hmacWithSHA256"),ka("1.2.840.113549.2.10","hmacWithSHA384"),ka("1.2.840.113549.2.11","hmacWithSHA512"),ka("1.2.840.113549.3.7","des-EDE3-CBC"),ka("2.16.840.1.101.3.4.1.2","aes128-CBC"),ka("2.16.840.1.101.3.4.1.22","aes192-CBC"),ka("2.16.840.1.101.3.4.1.42","aes256-CBC"),ka("2.5.4.3","commonName"),ka("2.5.4.5","serialName"),ka("2.5.4.6","countryName"),ka("2.5.4.7","localityName"),ka("2.5.4.8","stateOrProvinceName"),ka("2.5.4.9","streetAddress"),ka("2.5.4.10","organizationName"),ka("2.5.4.11","organizationalUnitName"),ka("2.5.4.13","description"),ka("2.5.4.15","businessCategory"),ka("2.5.4.17","postalCode"),ka("1.3.6.1.4.1.311.60.2.1.2","jurisdictionOfIncorporationStateOrProvinceName"),ka("1.3.6.1.4.1.311.60.2.1.3","jurisdictionOfIncorporationCountryName"),ka("2.16.840.1.113730.1.1","nsCertType"),ka("2.16.840.1.113730.1.13","nsComment"),ya("2.5.29.1","authorityKeyIdentifier"),ya("2.5.29.2","keyAttributes"),ya("2.5.29.3","certificatePolicies"),ya("2.5.29.4","keyUsageRestriction"),ya("2.5.29.5","policyMapping"),ya("2.5.29.6","subtreesConstraint"),ya("2.5.29.7","subjectAltName"),ya("2.5.29.8","issuerAltName"),ya("2.5.29.9","subjectDirectoryAttributes"),ya("2.5.29.10","basicConstraints"),ya("2.5.29.11","nameConstraints"),ya("2.5.29.12","policyConstraints"),ya("2.5.29.13","basicConstraints"),ka("2.5.29.14","subjectKeyIdentifier"),ka("2.5.29.15","keyUsage"),ya("2.5.29.16","privateKeyUsagePeriod"),ka("2.5.29.17","subjectAltName"),ka("2.5.29.18","issuerAltName"),ka("2.5.29.19","basicConstraints"),ya("2.5.29.20","cRLNumber"),ya("2.5.29.21","cRLReason"),ya("2.5.29.22","expirationDate"),ya("2.5.29.23","instructionCode"),ya("2.5.29.24","invalidityDate"),ya("2.5.29.25","cRLDistributionPoints"),ya("2.5.29.26","issuingDistributionPoint"),ya("2.5.29.27","deltaCRLIndicator"),ya("2.5.29.28","issuingDistributionPoint"),ya("2.5.29.29","certificateIssuer"),ya("2.5.29.30","nameConstraints"),ka("2.5.29.31","cRLDistributionPoints"),ka("2.5.29.32","certificatePolicies"),ya("2.5.29.33","policyMappings"),ya("2.5.29.34","policyConstraints"),ka("2.5.29.35","authorityKeyIdentifier"),ya("2.5.29.36","policyConstraints"),ka("2.5.29.37","extKeyUsage"),ya("2.5.29.46","freshestCRL"),ya("2.5.29.54","inhibitAnyPolicy"),ka("1.3.6.1.4.1.11129.2.4.2","timestampList"),ka("1.3.6.1.5.5.7.1.1","authorityInfoAccess"),ka("1.3.6.1.5.5.7.3.1","serverAuth"),ka("1.3.6.1.5.5.7.3.2","clientAuth"),ka("1.3.6.1.5.5.7.3.3","codeSigning"),ka("1.3.6.1.5.5.7.3.4","emailProtection"),ka("1.3.6.1.5.5.7.3.8","timeStamping");var ma=aa.asn1=aa.asn1||{};function Ib(e,t,r){if(r>t){var a=new Error("Too few bytes to parse DER.");throw a.available=e.length(),a.remaining=t,a.requested=r,a}}ma.Class={UNIVERSAL:0,APPLICATION:64,CONTEXT_SPECIFIC:128,PRIVATE:192},ma.Type={NONE:0,BOOLEAN:1,INTEGER:2,BITSTRING:3,OCTETSTRING:4,NULL:5,OID:6,ODESC:7,EXTERNAL:8,REAL:9,ENUMERATED:10,EMBEDDED:11,UTF8:12,ROID:13,SEQUENCE:16,SET:17,PRINTABLESTRING:19,IA5STRING:22,UTCTIME:23,GENERALIZEDTIME:24,BMPSTRING:30},ma.create=function(e,t,r,a,n){if(aa.util.isArray(a)){for(var s=[],$=0;$<a.length;++$)void 0!==a[$]&&s.push(a[$]);a=s}var i={tagClass:e,type:t,constructed:r,composed:r||aa.util.isArray(a),value:a};return n&&"bitStringContents"in n&&(i.bitStringContents=n.bitStringContents,i.original=ma.copy(i)),i},ma.copy=function(e,t){var r;if(aa.util.isArray(e)){r=[];for(var a=0;a<e.length;++a)r.push(ma.copy(e[a],t));return r}return"string"==typeof e?e:(r={tagClass:e.tagClass,type:e.type,constructed:e.constructed,composed:e.composed,value:ma.copy(e.value,t)},t&&!t.excludeBitStringContents&&(r.bitStringContents=e.bitStringContents),r)},ma.equals=function(e,t,r){if(aa.util.isArray(e)){if(!aa.util.isArray(t))return!1;if(e.length!==t.length)return!1;for(var a=0;a<e.length;++a)if(!ma.equals(e[a],t[a]))return!1;return!0}if(typeof e!=typeof t)return!1;if("string"==typeof e)return e===t;var n=e.tagClass===t.tagClass&&e.type===t.type&&e.constructed===t.constructed&&e.composed===t.composed&&ma.equals(e.value,t.value);return r&&r.includeBitStringContents&&(n=n&&e.bitStringContents===t.bitStringContents),n},ma.getBerValueLength=function(e){var t=e.getByte();if(128!==t)return 128&t?e.getInt((127&t)<<3):t};var Ae=function(e,t){var r=e.getByte();if(128!==r){var a;if(128&r){var n=127&r;Ib(e,--t,n),a=e.getInt(n<<3)}else a=r;if(a<0)throw new Error("Negative length: "+a);return a}};function Wb(e,t,r,a){var n;Ib(e,t,2);var s=e.getByte();t--;var $=192&s,i=31&s;n=e.length();var o,u,v=Ae(e,t);if(t-=n-e.length(),void 0!==v&&v>t){if(a.strict){var l=new Error("Too few bytes to read ASN.1 value.");throw l.available=e.length(),l.remaining=t,l.requested=v,l}v=t}var g=32==(32&s);if(g)if(o=[],void 0===v)for(;;){if(Ib(e,t,2),e.bytes(2)===String.fromCharCode(0,0)){e.getBytes(2),t-=2;break}n=e.length(),o.push(Wb(e,t,r+1,a)),t-=n-e.length()}else for(;v>0;)n=e.length(),o.push(Wb(e,v,r+1,a)),t-=n-e.length(),v-=n-e.length();if(void 0===o&&$===ma.Class.UNIVERSAL&&i===ma.Type.BITSTRING&&(u=e.bytes(v)),void 0===o&&a.decodeBitStrings&&$===ma.Class.UNIVERSAL&&i===ma.Type.BITSTRING&&v>1){var B=e.read,p=t,c=0;if(i===ma.Type.BITSTRING&&(Ib(e,t,1),c=e.getByte(),t--),0===c)try{n=e.length();var A=Wb(e,t,r+1,{verbose:a.verbose,strict:!0,decodeBitStrings:!0}),f=n-e.length();t-=f,i==ma.Type.BITSTRING&&f++;var T=A.tagClass;f!==v||T!==ma.Class.UNIVERSAL&&T!==ma.Class.CONTEXT_SPECIFIC||(o=[A])}catch(h){}void 0===o&&(e.read=B,t=p)}if(void 0===o){if(void 0===v){if(a.strict)throw new Error("Non-constructed ASN.1 object of indefinite length.");v=t}if(i===ma.Type.BMPSTRING)for(o="";v>0;v-=2)Ib(e,t,2),o+=String.fromCharCode(e.getInt16()),t-=2;else o=e.getBytes(v)}var j=void 0===u?null:{bitStringContents:u};return ma.create($,i,g,o,j)}ma.fromDer=function(e,t){return void 0===t&&(t={strict:!0,decodeBitStrings:!0}),"boolean"==typeof t&&(t={strict:t,decodeBitStrings:!0}),"strict"in t||(t.strict=!0),"decodeBitStrings"in t||(t.decodeBitStrings=!0),"string"==typeof e&&(e=aa.util.createBuffer(e)),Wb(e,e.length(),0,t)},ma.toDer=function(e){var t=aa.util.createBuffer(),r=e.tagClass|e.type,a=aa.util.createBuffer(),n=!1;if("bitStringContents"in e&&(n=!0,e.original&&(n=ma.equals(e,e.original))),n)a.putBytes(e.bitStringContents);else if(e.composed){e.constructed?r|=32:a.putByte(0);for(var s=0;s<e.value.length;++s)void 0!==e.value[s]&&a.putBuffer(ma.toDer(e.value[s]))}else if(e.type===ma.Type.BMPSTRING)for(s=0;s<e.value.length;++s)a.putInt16(e.value.charCodeAt(s));else e.type===ma.Type.INTEGER&&e.value.length>1&&(0===e.value.charCodeAt(0)&&0==(128&e.value.charCodeAt(1))||255===e.value.charCodeAt(0)&&128==(128&e.value.charCodeAt(1)))?a.putBytes(e.value.substr(1)):a.putBytes(e.value);if(t.putByte(r),a.length()<=127)t.putByte(127&a.length());else{var $=a.length(),i="";do{i+=String.fromCharCode(255&$),$>>>=8}while($>0);t.putByte(128|i.length);for(s=i.length-1;s>=0;--s)t.putByte(i.charCodeAt(s))}return t.putBuffer(a),t},ma.oidToDer=function(e){var t,r,a,n,s=e.split("."),$=aa.util.createBuffer();$.putByte(40*parseInt(s[0],10)+parseInt(s[1],10));for(var i=2;i<s.length;++i){t=!0,r=[],a=parseInt(s[i],10);do{n=127&a,a>>>=7,t||(n|=128),r.push(n),t=!1}while(a>0);for(var o=r.length-1;o>=0;--o)$.putByte(r[o])}return $},ma.derToOid=function(e){var t;"string"==typeof e&&(e=aa.util.createBuffer(e));var r=e.getByte();t=Math.floor(r/40)+"."+r%40;for(var a=0;e.length()>0;)a<<=7,128&(r=e.getByte())?a+=127&r:(t+="."+(a+r),a=0);return t},ma.utcTimeToDate=function(e){var t=new Date,r=parseInt(e.substr(0,2),10);r=r>=50?1900+r:2e3+r;var a=parseInt(e.substr(2,2),10)-1,n=parseInt(e.substr(4,2),10),s=parseInt(e.substr(6,2),10),$=parseInt(e.substr(8,2),10),i=0;if(e.length>11){var o=e.charAt(10),u=10;"+"!==o&&"-"!==o&&(i=parseInt(e.substr(10,2),10),u+=2)}if(t.setUTCFullYear(r,a,n),t.setUTCHours(s,$,i,0),u&&("+"===(o=e.charAt(u))||"-"===o)){var v=60*parseInt(e.substr(u+1,2),10)+parseInt(e.substr(u+4,2),10);v*=6e4,"+"===o?t.setTime(+t-v):t.setTime(+t+v)}return t},ma.generalizedTimeToDate=function(e){var t=new Date,r=parseInt(e.substr(0,4),10),a=parseInt(e.substr(4,2),10)-1,n=parseInt(e.substr(6,2),10),s=parseInt(e.substr(8,2),10),$=parseInt(e.substr(10,2),10),i=parseInt(e.substr(12,2),10),o=0,u=0,v=!1;"Z"===e.charAt(e.length-1)&&(v=!0);var l=e.length-5,g=e.charAt(l);"+"!==g&&"-"!==g||(u=60*parseInt(e.substr(l+1,2),10)+parseInt(e.substr(l+4,2),10),u*=6e4,"+"===g&&(u*=-1),v=!0);return"."===e.charAt(14)&&(o=1e3*parseFloat(e.substr(14),10)),v?(t.setUTCFullYear(r,a,n),t.setUTCHours(s,$,i,o),t.setTime(+t+u)):(t.setFullYear(r,a,n),t.setHours(s,$,i,o)),t},ma.dateToUtcTime=function(e){if("string"==typeof e)return e;var t="",r=[];r.push((""+e.getUTCFullYear()).substr(2)),r.push(""+(e.getUTCMonth()+1)),r.push(""+e.getUTCDate()),r.push(""+e.getUTCHours()),r.push(""+e.getUTCMinutes()),r.push(""+e.getUTCSeconds());for(var a=0;a<r.length;++a)r[a].length<2&&(t+="0"),t+=r[a];return t+="Z"},ma.dateToGeneralizedTime=function(e){if("string"==typeof e)return e;var t="",r=[];r.push(""+e.getUTCFullYear()),r.push(""+(e.getUTCMonth()+1)),r.push(""+e.getUTCDate()),r.push(""+e.getUTCHours()),r.push(""+e.getUTCMinutes()),r.push(""+e.getUTCSeconds());for(var a=0;a<r.length;++a)r[a].length<2&&(t+="0"),t+=r[a];return t+="Z"},ma.integerToDer=function(e){var t=aa.util.createBuffer();if(e>=-128&&e<128)return t.putSignedInt(e,8);if(e>=-32768&&e<32768)return t.putSignedInt(e,16);if(e>=-8388608&&e<8388608)return t.putSignedInt(e,24);if(e>=-2147483648&&e<2147483648)return t.putSignedInt(e,32);var r=new Error("Integer too large; max is 32-bits.");throw r.integer=e,r},ma.derToInteger=function(e){"string"==typeof e&&(e=aa.util.createBuffer(e));var t=8*e.length();if(t>32)throw new Error("Integer too large; max is 32-bits.");return e.getSignedInt(t)},ma.validate=function(e,t,r,a){var n=!1;if(e.tagClass!==t.tagClass&&void 0!==t.tagClass||e.type!==t.type&&void 0!==t.type)a&&(e.tagClass!==t.tagClass&&a.push("["+t.name+"] Expected tag class \""+t.tagClass+"\", got \""+e.tagClass+"\""),e.type!==t.type&&a.push("["+t.name+"] Expected type \""+t.type+"\", got \""+e.type+"\""));else if(e.constructed===t.constructed||void 0===t.constructed){if(n=!0,t.value&&aa.util.isArray(t.value))for(var s=0,$=0;n&&$<t.value.length;++$)n=t.value[$].optional||!1,e.value[s]&&((n=ma.validate(e.value[s],t.value[$],r,a))?++s:t.value[$].optional&&(n=!0)),!n&&a&&a.push("["+t.name+"] Tag class \""+t.tagClass+"\", type \""+t.type+"\" expected value length \""+t.value.length+"\", got \""+e.value.length+"\"");if(n&&r)if(t.capture&&(r[t.capture]=e.value),t.captureAsn1&&(r[t.captureAsn1]=e),t.captureBitStringContents&&"bitStringContents"in e&&(r[t.captureBitStringContents]=e.bitStringContents),t.captureBitStringValue&&"bitStringContents"in e)if(e.bitStringContents.length<2)r[t.captureBitStringValue]="";else{if(0!==e.bitStringContents.charCodeAt(0))throw new Error("captureBitStringValue only supported for zero unused bits");r[t.captureBitStringValue]=e.bitStringContents.slice(1)}}else a&&a.push("["+t.name+"] Expected constructed \""+t.constructed+"\", got \""+e.constructed+"\"");return n};var hd=/[^\\u0000-\\u00ff]/;ma.prettyPrint=function(e,t,r){var a="";r=r||2,(t=t||0)>0&&(a+="\n");for(var n="",s=0;s<t*r;++s)n+=" ";switch(a+=n+"Tag: ",e.tagClass){case ma.Class.UNIVERSAL:a+="Universal:";break;case ma.Class.APPLICATION:a+="Application:";break;case ma.Class.CONTEXT_SPECIFIC:a+="Context-Specific:";break;case ma.Class.PRIVATE:a+="Private:";}if(e.tagClass===ma.Class.UNIVERSAL)switch(a+=e.type,e.type){case ma.Type.NONE:a+=" (None)";break;case ma.Type.BOOLEAN:a+=" (Boolean)";break;case ma.Type.INTEGER:a+=" (Integer)";break;case ma.Type.BITSTRING:a+=" (Bit string)";break;case ma.Type.OCTETSTRING:a+=" (Octet string)";break;case ma.Type.NULL:a+=" (Null)";break;case ma.Type.OID:a+=" (Object Identifier)";break;case ma.Type.ODESC:a+=" (Object Descriptor)";break;case ma.Type.EXTERNAL:a+=" (External or Instance of)";break;case ma.Type.REAL:a+=" (Real)";break;case ma.Type.ENUMERATED:a+=" (Enumerated)";break;case ma.Type.EMBEDDED:a+=" (Embedded PDV)";break;case ma.Type.UTF8:a+=" (UTF8)";break;case ma.Type.ROID:a+=" (Relative Object Identifier)";break;case ma.Type.SEQUENCE:a+=" (Sequence)";break;case ma.Type.SET:a+=" (Set)";break;case ma.Type.PRINTABLESTRING:a+=" (Printable String)";break;case ma.Type.IA5String:a+=" (IA5String (ASCII))";break;case ma.Type.UTCTIME:a+=" (UTC time)";break;case ma.Type.GENERALIZEDTIME:a+=" (Generalized time)";break;case ma.Type.BMPSTRING:a+=" (BMP String)";}else a+=e.type;if(a+="\n",a+=n+"Constructed: "+e.constructed+"\n",e.composed){var $=0,i="";for(s=0;s<e.value.length;++s)void 0!==e.value[s]&&($+=1,i+=ma.prettyPrint(e.value[s],t+1,r),s+1<e.value.length&&(i+=","));a+=n+"Sub values: "+$+i}else{if(a+=n+"Value: ",e.type===ma.Type.OID){var o=ma.derToOid(e.value);a+=o,aa.pki&&aa.pki.oids&&o in aa.pki.oids&&(a+=" ("+aa.pki.oids[o]+") ")}if(e.type===ma.Type.INTEGER)try{a+=ma.derToInteger(e.value)}catch(v){a+="0x"+aa.util.bytesToHex(e.value)}else if(e.type===ma.Type.BITSTRING){if(e.value.length>1?a+="0x"+aa.util.bytesToHex(e.value.slice(1)):a+="(none)",e.value.length>0){var u=e.value.charCodeAt(0);1==u?a+=" (1 unused bit shown)":u>1&&(a+=" ("+u+" unused bits shown)")}}else e.type===ma.Type.OCTETSTRING?(hd.test(e.value)||(a+="("+e.value+") "),a+="0x"+aa.util.bytesToHex(e.value)):e.type===ma.Type.UTF8?a+=aa.util.decodeUtf8(e.value):e.type===ma.Type.PRINTABLESTRING||e.type===ma.Type.IA5String?a+=e.value:hd.test(e.value)?a+="0x"+aa.util.bytesToHex(e.value):0===e.value.length?a+="[null]":a+=e.value}return a};aa.md.algorithms=aa.md.algorithms||{};var Be=aa.hmac=aa.hmac||{};Be.create=function(){var e=null,r=null,t=null,a=null,$={start:function($,u){if(null!==$)if("string"==typeof $){if(!(($=$.toLowerCase())in aa.md.algorithms))throw new Error("Unknown hash algorithm \""+$+"\"");r=aa.md.algorithms[$].create()}else r=$;if(null===u)u=e;else{if("string"==typeof u)u=aa.util.createBuffer(u);else if(aa.util.isArray(u)){var f=u;u=aa.util.createBuffer();for(var l=0;l<f.length;++l)u.putByte(f[l])}var o=u.length();o>r.blockLength&&(r.start(),r.update(u.bytes()),u=r.digest()),t=aa.util.createBuffer(),a=aa.util.createBuffer(),o=u.length();for(l=0;l<o;++l){f=u.at(l);t.putByte(54^f),a.putByte(92^f)}if(o<r.blockLength)for(f=r.blockLength-o,l=0;l<f;++l)t.putByte(54),a.putByte(92);e=u,t=t.bytes(),a=a.bytes()}r.start(),r.update(t)},update:function(e){r.update(e)},getMac:function(){var e=r.digest().bytes();return r.start(),r.update(a),r.update(e),r.digest()}};return $.digest=$.getMac,$};var id=aa.md5=aa.md5||{};aa.md.md5=aa.md.algorithms.md5=id,id.create=function(){De||Ee();var r=null,$=aa.util.createBuffer(),e=new Array(16),a={algorithm:"md5",blockLength:64,digestLength:16,messageLength:0,fullMessageLength:null,messageLengthSize:8,start:function(){a.messageLength=0,a.fullMessageLength=a.messageLength64=[];for(var e=a.messageLengthSize/4,t=0;t<e;++t)a.fullMessageLength.push(0);return $=aa.util.createBuffer(),r={h0:1732584193,h1:4023233417,h2:2562383102,h3:271733878},a}};return a.start(),a.update=function(t,g){"utf8"===g&&(t=aa.util.encodeUtf8(t));var n=t.length;a.messageLength+=n,n=[n/4294967296>>>0,n>>>0];for(var h=a.fullMessageLength.length-1;h>=0;--h)a.fullMessageLength[h]+=n[1],n[1]=n[0]+(a.fullMessageLength[h]/4294967296>>>0),a.fullMessageLength[h]=a.fullMessageLength[h]>>>0,n[0]=n[1]/4294967296>>>0;return $.putBytes(t),jd(r,e,$),($.read>2048||0===$.length())&&$.compact(),a},a.digest=function(){var t=aa.util.createBuffer();t.putBytes($.bytes());var g=a.fullMessageLength[a.fullMessageLength.length-1]+a.messageLengthSize&a.blockLength-1;t.putBytes(Ce.substr(0,a.blockLength-g));for(var n,h=0,l=a.fullMessageLength.length-1;l>=0;--l)h=(n=8*a.fullMessageLength[l]+h)/4294967296>>>0,t.putInt32Le(n>>>0);var v={h0:r.h0,h1:r.h1,h2:r.h2,h3:r.h3};jd(v,e,t);var u=aa.util.createBuffer();return u.putInt32Le(v.h0),u.putInt32Le(v.h1),u.putInt32Le(v.h2),u.putInt32Le(v.h3),u},a};var Ce=null,vc=null,Xb=null,Jb=null,De=!1;function Ee(){Ce=String.fromCharCode(128),Ce+=aa.util.fillString(String.fromCharCode(0),64),vc=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,1,6,11,0,5,10,15,4,9,14,3,8,13,2,7,12,5,8,11,14,1,4,7,10,13,0,3,6,9,12,15,2,0,7,14,5,12,3,10,1,8,15,6,13,4,11,2,9],Xb=[7,12,17,22,7,12,17,22,7,12,17,22,7,12,17,22,5,9,14,20,5,9,14,20,5,9,14,20,5,9,14,20,4,11,16,23,4,11,16,23,4,11,16,23,4,11,16,23,6,10,15,21,6,10,15,21,6,10,15,21,6,10,15,21],Jb=new Array(64);for(var r=0;r<64;++r)Jb[r]=Math.floor(4294967296*Math.abs(Math.sin(r+1)));De=!0}function jd(r,$,e){for(var a,t,g,n,h,l,v,u=e.length();u>=64;){for(t=r.h0,g=r.h1,n=r.h2,h=r.h3,v=0;v<16;++v)$[v]=e.getInt32Le(),a=t+(h^g&(n^h))+Jb[v]+$[v],t=h,h=n,n=g,g+=a<<(l=Xb[v])|a>>>32-l;for(;v<32;++v)a=t+(n^h&(g^n))+Jb[v]+$[vc[v]],t=h,h=n,n=g,g+=a<<(l=Xb[v])|a>>>32-l;for(;v<48;++v)a=t+(g^n^h)+Jb[v]+$[vc[v]],t=h,h=n,n=g,g+=a<<(l=Xb[v])|a>>>32-l;for(;v<64;++v)a=t+(n^(g|~h))+Jb[v]+$[vc[v]],t=h,h=n,n=g,g+=a<<(l=Xb[v])|a>>>32-l;r.h0=r.h0+t|0,r.h1=r.h1+g|0,r.h2=r.h2+n|0,r.h3=r.h3+h|0,u-=64}}var kd=aa.pem=aa.pem||{};function Yb(e){for(var r=e.name+": ",a=[],n=function(e,r){return" "+r},o=0;o<e.values.length;++o)a.push(e.values[o].replace(/^(\S+\r\n)/,n));r+=a.join(",")+"\r\n";var t=0,l=-1;for(o=0;o<r.length;++o,++t)if(t>65&&-1!==l){var s=r[l];","===s?(++l,r=r.substr(0,l)+"\r\n "+r.substr(l)):r=r.substr(0,l)+"\r\n"+s+r.substr(l+1),t=o-l-1,l=-1,++o}else" "!==r[o]&&"\t"!==r[o]&&","!==r[o]||(l=o);return r}function Fe(e){return e.replace(/^\s+/,"")}kd.encode=function(e,r){r=r||{};var a,n="-----BEGIN "+e.type+"-----\r\n";if(e.procType&&(n+=Yb(a={name:"Proc-Type",values:[String(e.procType.version),e.procType.type]})),e.contentDomain&&(n+=Yb(a={name:"Content-Domain",values:[e.contentDomain]})),e.dekInfo&&(a={name:"DEK-Info",values:[e.dekInfo.algorithm]},e.dekInfo.parameters&&a.values.push(e.dekInfo.parameters),n+=Yb(a)),e.headers)for(var o=0;o<e.headers.length;++o)n+=Yb(e.headers[o]);return e.procType&&(n+="\r\n"),n+=aa.util.encode64(e.body,r.maxline||64)+"\r\n",n+="-----END "+e.type+"-----\r\n"},kd.decode=function(e){for(var r,a=[],n=/\s*-----BEGIN ([A-Z0-9- ]+)-----\r?\n?([\x21-\x7e\s]+?(?:\r?\n\r?\n))?([:A-Za-z0-9+\/=\s]+?)-----END \1-----/g,o=/([\x21-\x7e]+):\s*([\x21-\x7e\s^:]+)/,t=/\r?\n/;r=n.exec(e);){var l={type:r[1],procType:null,contentDomain:null,dekInfo:null,headers:[],body:aa.util.decode64(r[3])};if(a.push(l),r[2]){for(var s=r[2].split(t),f=0;r&&f<s.length;){for(var $=s[f].replace(/\s+$/,""),i=f+1;i<s.length;++i){var p=s[i];if(!/\s/.test(p[0]))break;$+=p,f=i}if(r=$.match(o)){for(var d={name:r[1],values:[]},v=r[2].split(","),u=0;u<v.length;++u)d.values.push(Fe(v[u]));if(l.procType){if(l.contentDomain||"Content-Domain"!==d.name){if(l.dekInfo||"DEK-Info"!==d.name)l.headers.push(d);else{if(0===d.values.length)throw new Error("Invalid PEM formatted message. The \"DEK-Info\" header must have at least one subfield.");l.dekInfo={algorithm:v[0],parameters:v[1]||null}}}else l.contentDomain=v[0]||"";}else{if("Proc-Type"!==d.name)throw new Error("Invalid PEM formatted message. The first encapsulated header must be \"Proc-Type\".");if(2!==d.values.length)throw new Error("Invalid PEM formatted message. The \"Proc-Type\" header must have two subfields.");l.procType={version:v[0],type:v[1]}}}++f}if("ENCRYPTED"===l.procType&&!l.dekInfo)throw new Error("Invalid PEM formatted message. The \"DEK-Info\" header must be present if \"Proc-Type\" is \"ENCRYPTED\".")}}if(0===a.length)throw new Error("Invalid PEM formatted message.");return a};function Ya(r,e){aa.cipher.registerAlgorithm(r,function(){return new aa.des.Algorithm(r,e)})}aa.des.startEncrypting=function(r,e,$,t){var i=Zb({key:r,output:$,decrypt:!1,mode:t||(null===e?"ECB":"CBC")});return i.start(e),i},aa.des.createEncryptionCipher=function(r,e){return Zb({key:r,output:null,decrypt:!1,mode:e})},aa.des.startDecrypting=function(r,e,$,t){var i=Zb({key:r,output:$,decrypt:!0,mode:t||(null===e?"ECB":"CBC")});return i.start(e),i},aa.des.createDecryptionCipher=function(r,e){return Zb({key:r,output:null,decrypt:!0,mode:e})},aa.des.Algorithm=function(r,e){var $=this;$.name=r,$.mode=new e({blockSize:8,cipher:{encrypt:function(r,e){return ld($._keys,r,e,!1)},decrypt:function(r,e){return ld($._keys,r,e,!0)}}}),$._init=!1},aa.des.Algorithm.prototype.initialize=function(r){if(!this._init){var e=aa.util.createBuffer(r.key);if(0===this.name.indexOf("3DES")&&24!==e.length())throw new Error("Invalid Triple-DES key size: "+8*e.length());this._keys=Oe(e),this._init=!0}},Ya("DES-ECB",aa.cipher.modes.ecb),Ya("DES-CBC",aa.cipher.modes.cbc),Ya("DES-CFB",aa.cipher.modes.cfb),Ya("DES-OFB",aa.cipher.modes.ofb),Ya("DES-CTR",aa.cipher.modes.ctr),Ya("3DES-ECB",aa.cipher.modes.ecb),Ya("3DES-CBC",aa.cipher.modes.cbc),Ya("3DES-CFB",aa.cipher.modes.cfb),Ya("3DES-OFB",aa.cipher.modes.ofb),Ya("3DES-CTR",aa.cipher.modes.ctr);var Ge=[16843776,0,65536,16843780,16842756,66564,4,65536,1024,16843776,16843780,1024,16778244,16842756,16777216,4,1028,16778240,16778240,66560,66560,16842752,16842752,16778244,65540,16777220,16777220,65540,0,1028,66564,16777216,65536,16843780,4,16842752,16843776,16777216,16777216,1024,16842756,65536,66560,16777220,1024,4,16778244,66564,16843780,65540,16842752,16778244,16777220,1028,66564,16843776,1028,16778240,16778240,0,65540,66560,0,16842756],He=[-2146402272,-2147450880,32768,1081376,1048576,32,-2146435040,-2147450848,-2147483616,-2146402272,-2146402304,-2147483648,-2147450880,1048576,32,-2146435040,1081344,1048608,-2147450848,0,-2147483648,32768,1081376,-2146435072,1048608,-2147483616,0,1081344,32800,-2146402304,-2146435072,32800,0,1081376,-2146435040,1048576,-2147450848,-2146435072,-2146402304,32768,-2146435072,-2147450880,32,-2146402272,1081376,32,32768,-2147483648,32800,-2146402304,1048576,-2147483616,1048608,-2147450848,-2147483616,1048608,1081344,0,-2147450880,32800,-2147483648,-2146435040,-2146402272,1081344],Ie=[520,134349312,0,134348808,134218240,0,131592,134218240,131080,134217736,134217736,131072,134349320,131080,134348800,520,134217728,8,134349312,512,131584,134348800,134348808,131592,134218248,131584,131072,134218248,8,134349320,512,134217728,134349312,134217728,131080,520,131072,134349312,134218240,0,512,131080,134349320,134218240,134217736,512,0,134348808,134218248,131072,134217728,134349320,8,131592,131584,134217736,134348800,134218248,520,134348800,131592,8,134348808,131584],Je=[8396801,8321,8321,128,8396928,8388737,8388609,8193,0,8396800,8396800,8396929,129,0,8388736,8388609,1,8192,8388608,8396801,128,8388608,8193,8320,8388737,1,8320,8388736,8192,8396928,8396929,129,8388736,8388609,8396800,8396929,129,0,0,8396800,8320,8388736,8388737,1,8396801,8321,8321,128,8396929,129,1,8192,8388609,8193,8396928,8388737,8193,8320,8388608,8396801,128,8388608,8192,8396928],Ke=[256,34078976,34078720,1107296512,524288,256,1073741824,34078720,1074266368,524288,33554688,1074266368,1107296512,1107820544,524544,1073741824,33554432,1074266112,1074266112,0,1073742080,1107820800,1107820800,33554688,1107820544,1073742080,0,1107296256,34078976,33554432,1107296256,524544,524288,1107296512,256,33554432,1073741824,34078720,1107296512,1074266368,33554688,1073741824,1107820544,34078976,1074266368,256,33554432,1107820544,1107820800,524544,1107296256,1107820800,34078720,0,1074266112,1107296256,524544,33554688,1073742080,524288,0,1074266112,34078976,1073742080],Le=[536870928,541065216,16384,541081616,541065216,16,541081616,4194304,536887296,4210704,4194304,536870928,4194320,536887296,536870912,16400,0,4194320,536887312,16384,4210688,536887312,16,541065232,541065232,0,4210704,541081600,16400,4210688,541081600,536870912,536887296,16,541065232,4210688,541081616,4194304,16400,536870928,4194304,536887296,536870912,16400,536870928,541081616,4210688,541065216,4210704,541081600,0,541065232,16,16384,541065216,4210704,16384,4194320,536887312,0,541081600,536870912,4194320,536887312],Me=[2097152,69206018,67110914,0,2048,67110914,2099202,69208064,69208066,2097152,0,67108866,2,67108864,69206018,2050,67110912,2099202,2097154,67110912,67108866,69206016,69208064,2097154,69206016,2048,2050,69208066,2099200,2,67108864,2099200,67108864,2099200,2097152,67110914,67110914,69206018,69206018,2,2097154,67108864,67110912,2097152,69208064,2050,2099202,69208064,2050,67108866,69208066,69206016,2099200,0,2,69208066,0,2099202,69206016,2048,67108866,67110912,2048,2097154],Ne=[268439616,4096,262144,268701760,268435456,268439616,64,268435456,262208,268697600,268701760,266240,268701696,266304,4096,64,268697600,268435520,268439552,4160,266240,262208,268697664,268701696,4160,0,0,268697664,268435520,268439552,266304,262144,266304,262144,268701696,4096,64,268697664,4096,266304,268439552,64,268435520,268697600,268697664,268435456,262144,268439616,0,268701760,262208,268435520,268697600,268439552,268439616,0,268701760,266240,266240,4160,4160,262208,268435456,268701696];function Oe(r){for(var e,$=[0,4,536870912,536870916,65536,65540,536936448,536936452,512,516,536871424,536871428,66048,66052,536936960,536936964],t=[0,1,1048576,1048577,67108864,67108865,68157440,68157441,256,257,1048832,1048833,67109120,67109121,68157696,68157697],i=[0,8,2048,2056,16777216,16777224,16779264,16779272,0,8,2048,2056,16777216,16777224,16779264,16779272],o=[0,2097152,134217728,136314880,8192,2105344,134225920,136323072,131072,2228224,134348800,136445952,139264,2236416,134356992,136454144],a=[0,262144,16,262160,0,262144,16,262160,4096,266240,4112,266256,4096,266240,4112,266256],n=[0,1024,32,1056,0,1024,32,1056,33554432,33555456,33554464,33555488,33554432,33555456,33554464,33555488],c=[0,268435456,524288,268959744,2,268435458,524290,268959746,0,268435456,524288,268959744,2,268435458,524290,268959746],k=[0,65536,2048,67584,536870912,536936448,536872960,536938496,131072,196608,133120,198656,537001984,537067520,537004032,537069568],v=[0,262144,0,262144,2,262146,2,262146,33554432,33816576,33554432,33816576,33554434,33816578,33554434,33816578],b=[0,268435456,8,268435464,0,268435456,8,268435464,1024,268436480,1032,268436488,1024,268436480,1032,268436488],f=[0,32,0,32,1048576,1048608,1048576,1048608,8192,8224,8192,8224,1056768,1056800,1056768,1056800],p=[0,16777216,512,16777728,2097152,18874368,2097664,18874880,67108864,83886080,67109376,83886592,69206016,85983232,69206528,85983744],s=[0,4096,134217728,134221824,524288,528384,134742016,134746112,16,4112,134217744,134221840,524304,528400,134742032,134746128],J=[0,4,256,260,0,4,256,260,1,5,257,261,1,5,257,261],X=r.length()>8?3:1,u=[],g=[0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0],h=0,l=0;l<X;l++){var d=r.getInt32(),m=r.getInt32();d^=(e=252645135&(d>>>4^m))<<4,d^=e=65535&((m^=e)>>>-16^d),d^=(e=858993459&(d>>>2^(m^=e<<-16)))<<2,d^=e=65535&((m^=e)>>>-16^d),d^=(e=1431655765&(d>>>1^(m^=e<<-16)))<<1,d^=e=16711935&((m^=e)>>>8^d),e=(d^=(e=1431655765&(d>>>1^(m^=e<<8)))<<1)<<8|(m^=e)>>>20&240,d=m<<24|m<<8&16711680|m>>>8&65280|m>>>24&240,m=e;for(var C=0;C<g.length;++C){g[C]?(d=d<<2|d>>>26,m=m<<2|m>>>26):(d=d<<1|d>>>27,m=m<<1|m>>>27);var y=$[(d&=-15)>>>28]|t[d>>>24&15]|i[d>>>20&15]|o[d>>>16&15]|a[d>>>12&15]|n[d>>>8&15]|c[d>>>4&15],E=k[(m&=-15)>>>28]|v[m>>>24&15]|b[m>>>20&15]|f[m>>>16&15]|p[m>>>12&15]|s[m>>>8&15]|J[m>>>4&15];e=65535&(E>>>16^y),u[h++]=y^e,u[h++]=E^e<<16}}return u}function ld(r,e,$,t){var i,o,a=32===r.length?3:9;i=3===a?t?[30,-2,-2]:[0,32,2]:t?[94,62,-2,32,64,2,30,-2,-2]:[0,32,2,62,30,-2,64,96,2];var n=e[0],c=e[1];n^=(o=252645135&(n>>>4^c))<<4,n^=(o=65535&(n>>>16^(c^=o)))<<16,n^=o=858993459&((c^=o)>>>2^n),n^=o=16711935&((c^=o<<2)>>>8^n),n=(n^=(o=1431655765&(n>>>1^(c^=o<<8)))<<1)<<1|n>>>31,c=(c^=o)<<1|c>>>31;for(var k=0;k<a;k+=3){for(var v=i[k+1],b=i[k+2],f=i[k];f!=v;f+=b){var p=c^r[f],s=(c>>>4|c<<28)^r[f+1];o=n,n=c,c=o^(He[p>>>24&63]|Je[p>>>16&63]|Le[p>>>8&63]|Ne[63&p]|Ge[s>>>24&63]|Ie[s>>>16&63]|Ke[s>>>8&63]|Me[63&s])}o=n,n=c,c=o}c=c>>>1|c<<31,c^=o=1431655765&((n=n>>>1|n<<31)>>>1^c),c^=(o=16711935&(c>>>8^(n^=o<<1)))<<8,c^=(o=858993459&(c>>>2^(n^=o)))<<2,c^=o=65535&((n^=o)>>>16^c),c^=o=252645135&((n^=o<<16)>>>4^c),n^=o<<4,$[0]=n,$[1]=c}function Zb(r){var e,$="DES-"+((r=r||{}).mode||"CBC").toUpperCase(),t=(e=r.decrypt?aa.cipher.createDecipher($,r.key):aa.cipher.createCipher($,r.key)).start;return e.start=function(r,$){var i=null;$ instanceof aa.util.ByteBuffer&&(i=$,$={}),($=$||{}).output=i,$.iv=r,t.call(e,$)},e}var a=(ab(),{}).Buffer;var b,c=aa.pkcs5=aa.pkcs5||{};aa.util.isNodejs&&!aa.options.usePureJavaScript&&(b=(ab(),{}));var md=aa.sha256=aa.sha256||{};aa.md.sha256=aa.md.algorithms.sha256=md,md.create=function(){Qe||Se();var e=null,t=aa.util.createBuffer(),r=new Array(64),h={algorithm:"sha256",blockLength:64,digestLength:32,messageLength:0,fullMessageLength:null,messageLengthSize:8,start:function(){h.messageLength=0,h.fullMessageLength=h.messageLength64=[];for(var r=h.messageLengthSize/4,a=0;a<r;++a)h.fullMessageLength.push(0);return t=aa.util.createBuffer(),e={h0:1779033703,h1:3144134277,h2:1013904242,h3:2773480762,h4:1359893119,h5:2600822924,h6:528734635,h7:1541459225},h}};return h.start(),h.update=function(a,$){"utf8"===$&&(a=aa.util.encodeUtf8(a));var n=a.length;h.messageLength+=n,n=[n/4294967296>>>0,n>>>0];for(var g=h.fullMessageLength.length-1;g>=0;--g)h.fullMessageLength[g]+=n[1],n[1]=n[0]+(h.fullMessageLength[g]/4294967296>>>0),h.fullMessageLength[g]=h.fullMessageLength[g]>>>0,n[0]=n[1]/4294967296>>>0;return t.putBytes(a),nd(e,r,t),(t.read>2048||0===t.length())&&t.compact(),h},h.digest=function(){var a=aa.util.createBuffer();a.putBytes(t.bytes());var $,n=h.fullMessageLength[h.fullMessageLength.length-1]+h.messageLengthSize&h.blockLength-1;a.putBytes(Pe.substr(0,h.blockLength-n));for(var g=8*h.fullMessageLength[0],p=0;p<h.fullMessageLength.length-1;++p)g+=($=8*h.fullMessageLength[p+1])/4294967296>>>0,a.putInt32(g>>>0),g=$>>>0;a.putInt32(g);var s={h0:e.h0,h1:e.h1,h2:e.h2,h3:e.h3,h4:e.h4,h5:e.h5,h6:e.h6,h7:e.h7};nd(s,r,a);var u=aa.util.createBuffer();return u.putInt32(s.h0),u.putInt32(s.h1),u.putInt32(s.h2),u.putInt32(s.h3),u.putInt32(s.h4),u.putInt32(s.h5),u.putInt32(s.h6),u.putInt32(s.h7),u},h};var Pe=null,Qe=!1,Re=null;function Se(){Pe=String.fromCharCode(128),Pe+=aa.util.fillString(String.fromCharCode(0),64),Re=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],Qe=!0}function nd(e,t,r){for(var h,a,$,n,g,p,s,u,l,f,i,v,o,A=r.length();A>=64;){for(g=0;g<16;++g)t[g]=r.getInt32();for(;g<64;++g)h=((h=t[g-2])>>>17|h<<15)^(h>>>19|h<<13)^h>>>10,a=((a=t[g-15])>>>7|a<<25)^(a>>>18|a<<14)^a>>>3,t[g]=h+t[g-7]+a+t[g-16]|0;for(p=e.h0,s=e.h1,u=e.h2,l=e.h3,f=e.h4,i=e.h5,v=e.h6,o=e.h7,g=0;g<64;++g)$=(p>>>2|p<<30)^(p>>>13|p<<19)^(p>>>22|p<<10),n=p&s|u&(p^s),h=o+((f>>>6|f<<26)^(f>>>11|f<<21)^(f>>>25|f<<7))+(v^f&(i^v))+Re[g]+t[g],o=v,v=i,i=f,f=l+h>>>0,l=u,u=s,s=p,p=h+(a=$+n)>>>0;e.h0=e.h0+p|0,e.h1=e.h1+s|0,e.h2=e.h2+u|0,e.h3=e.h3+l|0,e.h4=e.h4+f|0,e.h5=e.h5+i|0,e.h6=e.h6+v|0,e.h7=e.h7+o|0,A-=64}}var Te=(ab(),{});var wc=null;!aa.util.isNodejs||aa.options.usePureJavaScript||Te.versions["node-webkit"]||(wc=(ab(),{}));var Ue=aa.prng=aa.prng||{};Ue.create=function(e){for(var r={plugin:e,key:null,seed:null,time:null,reseeds:0,generated:0,keyBytes:""},t=e.md,n=new Array(32),o=0;o<32;++o)n[o]=t.create();function g(){if(r.pools[0].messageLength>=32)return a();var e=32-r.pools[0].messageLength<<5;r.collect(r.seedFileSync(e)),a()}function a(){r.reseeds=4294967295===r.reseeds?0:r.reseeds+1;var e=r.plugin.md.create();e.update(r.keyBytes);for(var t=1,n=0;n<32;++n)r.reseeds%t==0&&(e.update(r.pools[n].digest().getBytes()),r.pools[n].start()),t<<=1;r.keyBytes=e.digest().getBytes(),e.start(),e.update(r.keyBytes);var o=e.digest().getBytes();r.key=r.plugin.formatKey(r.keyBytes),r.seed=r.plugin.formatSeed(o),r.generated=0}function s(e){var r=null,t=aa.util.globalScope,n=t.crypto||t.msCrypto;n&&n.getRandomValues&&(r=function(e){return n.getRandomValues(e)});var o=aa.util.createBuffer();if(r)for(;o.length()<e;){var g=Math.max(1,Math.min(e-o.length(),65536)/4),a=new Uint32Array(Math.floor(g));try{r(a);for(var s=0;s<a.length;++s)o.putInt32(a[s])}catch($){if(!("undefined"!=typeof QuotaExceededError&&$ instanceof QuotaExceededError))throw $}}if(o.length()<e)for(var l,i,u,f=Math.floor(65536*Math.random());o.length()<e;){i=16807*(65535&f),i+=(32767&(l=16807*(f>>16)))<<16,f=4294967295&(i=(2147483647&(i+=l>>15))+(i>>31));for(s=0;s<3;++s)u=f>>>(s<<3),u^=Math.floor(256*Math.random()),o.putByte(String.fromCharCode(255&u))}return o.getBytes(e)}return r.pools=n,r.pool=0,r.generate=function(e,t){if(!t)return r.generateSync(e);var n=r.plugin.cipher,o=r.plugin.increment,g=r.plugin.formatKey,s=r.plugin.formatSeed,l=aa.util.createBuffer();r.key=null,function i(u){if(u)return t(u);if(l.length()>=e)return t(null,l.getBytes(e));r.generated>1048575&&(r.key=null);if(null===r.key)return aa.util.nextTick(function(){!function(e){if(r.pools[0].messageLength>=32)return a(),e();var t=32-r.pools[0].messageLength<<5;r.seedFile(t,function(t,n){if(t)return e(t);r.collect(n),a(),e()})}(i)});var f=n(r.key,r.seed);r.generated+=f.length;l.putBytes(f);r.key=g(n(r.key,o(r.seed)));r.seed=s(n(r.key,r.seed));aa.util.setImmediate(i)}()},r.generateSync=function(e){var t=r.plugin.cipher,n=r.plugin.increment,o=r.plugin.formatKey,a=r.plugin.formatSeed;r.key=null;for(var s=aa.util.createBuffer();s.length()<e;){r.generated>1048575&&(r.key=null),null===r.key&&g();var l=t(r.key,r.seed);r.generated+=l.length,s.putBytes(l),r.key=o(t(r.key,n(r.seed))),r.seed=a(t(r.key,r.seed))}return s.getBytes(e)},wc?(r.seedFile=function(e,r){wc.randomBytes(e,function(e,t){if(e)return r(e);r(null,t.toString())})},r.seedFileSync=function(e){return wc.randomBytes(e).toString()}):(r.seedFile=function(e,r){try{r(null,s(e))}catch(t){r(t)}},r.seedFileSync=s),r.collect=function(e){for(var t=e.length,n=0;n<t;++n)r.pools[r.pool].update(e.substr(n,1)),r.pool=31===r.pool?0:r.pool+1},r.collectInt=function(e,t){for(var n="",o=0;o<t;o+=8)n+=String.fromCharCode(e>>o&255);r.collect(n)},r.registerWorker=function(e){if(e===self)r.seedFile=function(e,r){self.addEventListener("message",function e(t){var n=t.data;n.forge&&n.forge.prng&&(self.removeEventListener("message",e),r(n.forge.prng.err,n.forge.prng.bytes))}),self.postMessage({forge:{prng:{needed:e}}})};else{e.addEventListener("message",function(t){var n=t.data;n.forge&&n.forge.prng&&r.seedFile(n.forge.prng.needed,function(r,t){e.postMessage({forge:{prng:{err:r,bytes:t}}})})})}},r};aa.random&&aa.random.getBytes?aa.random:function(e){var r={},t=new Array(4),n=aa.util.createBuffer();function a(){var e=aa.prng.create(r);return e.getBytes=function(r,t){return e.generate(r,t)},e.getBytesSync=function(r){return e.generate(r)},e}r.formatKey=function(e){var r=aa.util.createBuffer(e);return(e=new Array(4))[0]=r.getInt32(),e[1]=r.getInt32(),e[2]=r.getInt32(),e[3]=r.getInt32(),aa.aes._expandKey(e,!1)},r.formatSeed=function(e){var r=aa.util.createBuffer(e);return(e=new Array(4))[0]=r.getInt32(),e[1]=r.getInt32(),e[2]=r.getInt32(),e[3]=r.getInt32(),e},r.cipher=function(e,r){return aa.aes._updateBlock(e,r,t,!1),n.putInt32(t[0]),n.putInt32(t[1]),n.putInt32(t[2]),n.putInt32(t[3]),n.getBytes()},r.increment=function(e){return++e[3],e},r.md=aa.md.sha256;var f=a(),o=null,$=aa.util.globalScope,u=$.crypto||$.msCrypto;if(u&&u.getRandomValues&&(o=function(e){return u.getRandomValues(e)}),aa.options.usePureJavaScript||!aa.util.isNodejs&&!o){if("undefined"==typeof window||window.document,f.collectInt(+new Date,32),"undefined"!=typeof navigator){var c="";for(var g in navigator)try{"string"==typeof navigator[g]&&(c+=navigator[g])}catch(i){}f.collect(c),c=null}e&&(e().mousemove(function(e){f.collectInt(e.clientX,16),f.collectInt(e.clientY,16)}),e().keypress(function(e){f.collectInt(e.charCode,8)}))}if(aa.random)for(var g in f)aa.random[g]=f[g];else aa.random=f;aa.random.createInstance=a}("undefined"!=typeof jQuery?jQuery:null);var xc=[217,120,249,196,25,221,181,237,40,233,253,121,74,160,216,157,198,126,55,131,43,118,83,142,98,76,100,136,68,139,251,162,23,154,89,245,135,179,79,19,97,69,109,141,9,129,125,50,189,143,64,235,134,183,123,11,240,149,33,34,92,107,78,130,84,214,101,147,206,96,178,28,115,86,192,20,167,140,241,220,18,117,202,31,59,190,228,209,66,61,212,48,163,60,182,38,111,191,14,218,70,105,7,87,39,242,29,155,188,148,67,3,248,17,199,246,144,239,62,231,6,195,213,47,200,102,30,215,8,232,234,222,128,82,238,247,132,170,114,172,53,77,106,42,150,26,210,113,90,21,73,116,75,159,208,94,4,24,164,236,194,224,65,110,15,81,203,204,36,145,175,80,161,244,112,57,153,124,58,133,35,184,180,122,252,2,54,91,37,85,151,49,45,93,250,152,227,138,146,174,5,223,41,16,103,108,186,201,211,0,230,207,225,158,168,44,99,22,1,63,88,226,137,169,13,56,52,27,171,51,255,176,187,72,12,95,185,177,205,46,197,243,219,71,229,165,156,119,10,166,32,104,254,127,193,173],od=[1,2,3,5],Ve=function(r,e){return r<<e&65535|(65535&r)>>16-e},We=function(r,e){return(65535&r)>>e|r<<16-e&65535};aa.rc2.expandKey=function(r,e){"string"==typeof r&&(r=aa.util.createBuffer(r)),e=e||128;var t,$=r,i=r.length(),a=e,n=Math.ceil(a/8),f=255>>(7&a);for(t=i;t<128;t++)$.putByte(xc[$.at(t-1)+$.at(t-i)&255]);for($.setAt(128-n,xc[$.at(128-n)&f]),t=127-n;t>=0;t--)$.setAt(t,xc[$.at(t+1)^$.at(t+n)]);return $};var pd=function(r,e,t){var $,i,a,n,f=!1,o=null,u=null,c=null,v=[];for(r=aa.rc2.expandKey(r,e),a=0;a<64;a++)v.push(r.getInt16Le());t?($=function(r){for(a=0;a<4;a++)r[a]+=v[n]+(r[(a+3)%4]&r[(a+2)%4])+(~r[(a+3)%4]&r[(a+1)%4]),r[a]=Ve(r[a],od[a]),n++},i=function(r){for(a=0;a<4;a++)r[a]+=v[63&r[(a+3)%4]]}):($=function(r){for(a=3;a>=0;a--)r[a]=We(r[a],od[a]),r[a]-=v[n]+(r[(a+3)%4]&r[(a+2)%4])+(~r[(a+3)%4]&r[(a+1)%4]),n--},i=function(r){for(a=3;a>=0;a--)r[a]-=v[63&r[(a+3)%4]]});var l=function(r){var e=[];for(a=0;a<4;a++){var $=o.getInt16Le();null!==c&&(t?$^=c.getInt16Le():c.putInt16Le($)),e.push(65535&$)}n=t?0:63;for(var i=0;i<r.length;i++)for(var f=0;f<r[i][0];f++)r[i][1](e);for(a=0;a<4;a++)null!==c&&(t?c.putInt16Le(e[a]):e[a]^=c.getInt16Le()),u.putInt16Le(e[a])},p=null;return p={start:function(r,e){r&&"string"==typeof r&&(r=aa.util.createBuffer(r)),f=!1,o=aa.util.createBuffer(),u=e||new aa.util.createBuffer,c=r,p.output=u},update:function(r){for(f||o.putBuffer(r);o.length()>=8;)l([[5,$],[1,i],[6,$],[1,i],[5,$]])},finish:function(r){var e=!0;if(t)if(r)e=r(8,o,!t);else{var $=8===o.length()?8:8-o.length();o.fillWithByte($,$)}if(e&&(f=!0,p.update()),!t&&(e=0===o.length()))if(r)e=r(8,u,!t);else{var i=u.length(),a=u.at(i-1);a>i?e=!1:u.truncate(a)}return e}}};aa.rc2.startEncrypting=function(r,e,t){var $=aa.rc2.createEncryptionCipher(r,128);return $.start(e,t),$},aa.rc2.createEncryptionCipher=function(r,e){return pd(r,e,!0)},aa.rc2.startDecrypting=function(r,e,t){var $=aa.rc2.createDecryptionCipher(r,128);return $.start(e,t),$},aa.rc2.createDecryptionCipher=function(r,e){return pd(r,e,!1)};var Kb;var Xe=0xdeadbeefcafe,qd=15715070==(16777215&Xe);function ja(t,r,$){this.data=[],null!=t&&("number"==typeof t?this.fromNumber(t,r,$):null==r&&"string"!=typeof t?this.fromString(t,256):this.fromString(t,r))}function wa(){return new ja(null)}function Ye(t,r,$,v,a,i){for(;--i>=0;){var e=r*this.data[t++]+$.data[v]+a;a=Math.floor(e/67108864),$.data[v++]=67108863&e}return a}function Ze(t,r,$,v,a,i){for(var e=32767&r,n=r>>15;--i>=0;){var u=32767&this.data[t],o=this.data[t++]>>15,s=n*u+o*e;a=((u=e*u+((32767&s)<<15)+$.data[v]+(1073741823&a))>>>30)+(s>>>15)+n*o+(a>>>30),$.data[v++]=1073741823&u}return a}function rd(t,r,$,v,a,i){for(var e=16383&r,n=r>>14;--i>=0;){var u=16383&this.data[t],o=this.data[t++]>>14,s=n*u+o*e;a=((u=e*u+((16383&s)<<14)+$.data[v]+a)>>28)+(s>>14)+n*o,$.data[v++]=268435455&u}return a}aa.jsbn.BigInteger=ja,"undefined"==typeof navigator?(ja.prototype.am=rd,Kb=28):qd&&"Microsoft Internet Explorer"==navigator.appName?(ja.prototype.am=Ze,Kb=30):qd&&"Netscape"!=navigator.appName?(ja.prototype.am=Ye,Kb=26):(ja.prototype.am=rd,Kb=28),ja.prototype.DB=Kb,ja.prototype.DM=(1<<Kb)-1,ja.prototype.DV=1<<Kb;var yc=52;ja.prototype.FV=Math.pow(2,yc),ja.prototype.F1=yc-Kb,ja.prototype.F2=2*Kb-yc;var zc,bb,$e="0123456789abcdefghijklmnopqrstuvwxyz",$b=new Array;for(zc="0".charCodeAt(0),bb=0;bb<=9;++bb)$b[zc++]=bb;for(zc="a".charCodeAt(0),bb=10;bb<36;++bb)$b[zc++]=bb;for(zc="A".charCodeAt(0),bb=10;bb<36;++bb)$b[zc++]=bb;function sd(t){return $e.charAt(t)}function td(t,r){var $=$b[t.charCodeAt(r)];return null==$?-1:$}function _e(t){for(var r=this.t-1;r>=0;--r)t.data[r]=this.data[r];t.t=this.t,t.s=this.s}function af(t){this.t=1,this.s=t<0?-1:0,t>0?this.data[0]=t:t<-1?this.data[0]=t+this.DV:this.t=0}function fb(t){var r=wa();return r.fromInt(t),r}function bf(t,r){var $;if(16==r)$=4;else if(8==r)$=3;else if(256==r)$=8;else if(2==r)$=1;else if(32==r)$=5;else{if(4!=r)return void this.fromRadix(t,r);$=2}this.t=0,this.s=0;for(var v=t.length,a=!1,i=0;--v>=0;){var e=8==$?255&t[v]:td(t,v);e<0?"-"==t.charAt(v)&&(a=!0):(a=!1,0==i?this.data[this.t++]=e:i+$>this.DB?(this.data[this.t-1]|=(e&(1<<this.DB-i)-1)<<i,this.data[this.t++]=e>>this.DB-i):this.data[this.t-1]|=e<<i,(i+=$)>=this.DB&&(i-=this.DB))}8==$&&0!=(128&t[0])&&(this.s=-1,i>0&&(this.data[this.t-1]|=(1<<this.DB-i)-1<<i)),this.clamp(),a&&ja.ZERO.subTo(this,this)}function cf(){for(var t=this.s&this.DM;this.t>0&&this.data[this.t-1]==t;)--this.t}function df(t){if(this.s<0)return"-"+this.negate().toString(t);var r;if(16==t)r=4;else if(8==t)r=3;else if(2==t)r=1;else if(32==t)r=5;else{if(4!=t)return this.toRadix(t);r=2}var $,v=(1<<r)-1,a=!1,i="",e=this.t,n=this.DB-e*this.DB%r;if(e-->0)for(n<this.DB&&($=this.data[e]>>n)>0&&(a=!0,i=sd($));e>=0;)n<r?($=(this.data[e]&(1<<n)-1)<<r-n,$|=this.data[--e]>>(n+=this.DB-r)):($=this.data[e]>>(n-=r)&v,n<=0&&(n+=this.DB,--e)),$>0&&(a=!0),a&&(i+=sd($));return a?i:"0"}function ef(){var t=wa();return ja.ZERO.subTo(this,t),t}function ff(){return this.s<0?this.negate():this}function gf(t){var r=this.s-t.s;if(0!=r)return r;var $=this.t;if(0!=(r=$-t.t))return this.s<0?-r:r;for(;--$>=0;)if(0!=(r=this.data[$]-t.data[$]))return r;return 0}function _b(t){var r,$=1;return 0!=(r=t>>>16)&&(t=r,$+=16),0!=(r=t>>8)&&(t=r,$+=8),0!=(r=t>>4)&&(t=r,$+=4),0!=(r=t>>2)&&(t=r,$+=2),0!=(r=t>>1)&&(t=r,$+=1),$}function hf(){return this.t<=0?0:this.DB*(this.t-1)+_b(this.data[this.t-1]^this.s&this.DM)}function jf(t,r){var $;for($=this.t-1;$>=0;--$)r.data[$+t]=this.data[$];for($=t-1;$>=0;--$)r.data[$]=0;r.t=this.t+t,r.s=this.s}function kf(t,r){for(var $=t;$<this.t;++$)r.data[$-t]=this.data[$];r.t=Math.max(this.t-t,0),r.s=this.s}function lf(t,r){var $,v=t%this.DB,a=this.DB-v,i=(1<<a)-1,e=Math.floor(t/this.DB),n=this.s<<v&this.DM;for($=this.t-1;$>=0;--$)r.data[$+e+1]=this.data[$]>>a|n,n=(this.data[$]&i)<<v;for($=e-1;$>=0;--$)r.data[$]=0;r.data[e]=n,r.t=this.t+e+1,r.s=this.s,r.clamp()}function mf(t,r){r.s=this.s;var $=Math.floor(t/this.DB);if($>=this.t)r.t=0;else{var v=t%this.DB,a=this.DB-v,i=(1<<v)-1;r.data[0]=this.data[$]>>v;for(var e=$+1;e<this.t;++e)r.data[e-$-1]|=(this.data[e]&i)<<a,r.data[e-$]=this.data[e]>>v;v>0&&(r.data[this.t-$-1]|=(this.s&i)<<a),r.t=this.t-$,r.clamp()}}function nf(t,r){for(var $=0,v=0,a=Math.min(t.t,this.t);$<a;)v+=this.data[$]-t.data[$],r.data[$++]=v&this.DM,v>>=this.DB;if(t.t<this.t){for(v-=t.s;$<this.t;)v+=this.data[$],r.data[$++]=v&this.DM,v>>=this.DB;v+=this.s}else{for(v+=this.s;$<t.t;)v-=t.data[$],r.data[$++]=v&this.DM,v>>=this.DB;v-=t.s}r.s=v<0?-1:0,v<-1?r.data[$++]=this.DV+v:v>0&&(r.data[$++]=v),r.t=$,r.clamp()}function of(t,r){var $=this.abs(),v=t.abs(),a=$.t;for(r.t=a+v.t;--a>=0;)r.data[a]=0;for(a=0;a<v.t;++a)r.data[a+$.t]=$.am(0,v.data[a],r,a,0,$.t);r.s=0,r.clamp(),this.s!=t.s&&ja.ZERO.subTo(r,r)}function pf(t){for(var r=this.abs(),$=t.t=2*r.t;--$>=0;)t.data[$]=0;for($=0;$<r.t-1;++$){var v=r.am($,r.data[$],t,2*$,0,1);(t.data[$+r.t]+=r.am($+1,2*r.data[$],t,2*$+1,v,r.t-$-1))>=r.DV&&(t.data[$+r.t]-=r.DV,t.data[$+r.t+1]=1)}t.t>0&&(t.data[t.t-1]+=r.am($,r.data[$],t,2*$,0,1)),t.s=0,t.clamp()}function qf(t,r,$){var v=t.abs();if(!(v.t<=0)){var a=this.abs();if(a.t<v.t)return null!=r&&r.fromInt(0),void(null!=$&&this.copyTo($));null==$&&($=wa());var i=wa(),e=this.s,n=t.s,u=this.DB-_b(v.data[v.t-1]);u>0?(v.lShiftTo(u,i),a.lShiftTo(u,$)):(v.copyTo(i),a.copyTo($));var o=i.t,s=i.data[o-1];if(0!=s){var h=s*(1<<this.F1)+(o>1?i.data[o-2]>>this.F2:0),F=this.FV/h,p=(1<<this.F1)/h,f=1<<this.F2,d=$.t,g=d-o,b=null==r?wa():r;for(i.dlShiftTo(g,b),$.compareTo(b)>=0&&($.data[$.t++]=1,$.subTo(b,$)),ja.ONE.dlShiftTo(o,b),b.subTo(i,i);i.t<o;)i.data[i.t++]=0;for(;--g>=0;){var l=$.data[--d]==s?this.DM:Math.floor($.data[d]*F+($.data[d-1]+f)*p);if(($.data[d]+=i.am(0,l,$,g,0,o))<l)for(i.dlShiftTo(g,b),$.subTo(b,$);$.data[d]<--l;)$.subTo(b,$)}null!=r&&($.drShiftTo(o,r),e!=n&&ja.ZERO.subTo(r,r)),$.t=o,$.clamp(),u>0&&$.rShiftTo(u,$),e<0&&ja.ZERO.subTo($,$)}}}function rf(t){var r=wa();return this.abs().divRemTo(t,null,r),this.s<0&&r.compareTo(ja.ZERO)>0&&t.subTo(r,r),r}function lb(t){this.m=t}function sf(t){return t.s<0||t.compareTo(this.m)>=0?t.mod(this.m):t}function tf(t){return t}function uf(t){t.divRemTo(this.m,null,t)}function vf(t,r,$){t.multiplyTo(r,$),this.reduce($)}function wf(t,r){t.squareTo(r),this.reduce(r)}function xf(){if(this.t<1)return 0;var t=this.data[0];if(0==(1&t))return 0;var r=3&t;return(r=(r=(r=(r=r*(2-(15&t)*r)&15)*(2-(255&t)*r)&255)*(2-((65535&t)*r&65535))&65535)*(2-t*r%this.DV)%this.DV)>0?this.DV-r:-r}function mb(t){this.m=t,this.mp=t.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<t.DB-15)-1,this.mt2=2*t.t}function yf(t){var r=wa();return t.abs().dlShiftTo(this.m.t,r),r.divRemTo(this.m,null,r),t.s<0&&r.compareTo(ja.ZERO)>0&&this.m.subTo(r,r),r}function zf(t){var r=wa();return t.copyTo(r),this.reduce(r),r}function Af(t){for(;t.t<=this.mt2;)t.data[t.t++]=0;for(var r=0;r<this.m.t;++r){var $=32767&t.data[r],v=$*this.mpl+(($*this.mph+(t.data[r]>>15)*this.mpl&this.um)<<15)&t.DM;for($=r+this.m.t,t.data[$]+=this.m.am(0,v,t,r,0,this.m.t);t.data[$]>=t.DV;)t.data[$]-=t.DV,t.data[++$]++}t.clamp(),t.drShiftTo(this.m.t,t),t.compareTo(this.m)>=0&&t.subTo(this.m,t)}function Bf(t,r){t.squareTo(r),this.reduce(r)}function Cf(t,r,$){t.multiplyTo(r,$),this.reduce($)}function Df(){return 0==(this.t>0?1&this.data[0]:this.s)}function Ef(t,r){if(t>4294967295||t<1)return ja.ONE;var $=wa(),v=wa(),a=r.convert(this),i=_b(t)-1;for(a.copyTo($);--i>=0;)if(r.sqrTo($,v),(t&1<<i)>0)r.mulTo(v,a,$);else{var e=$;$=v,v=e}return r.revert($)}function Ff(t,r){var $;return $=t<256||r.isEven()?new lb(r):new mb(r),this.exp(t,$)}function Gf(){var t=wa();return this.copyTo(t),t}function Hf(){if(this.s<0){if(1==this.t)return this.data[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this.data[0];if(0==this.t)return 0}return(this.data[1]&(1<<32-this.DB)-1)<<this.DB|this.data[0]}function If(){return 0==this.t?this.s:this.data[0]<<24>>24}function Jf(){return 0==this.t?this.s:this.data[0]<<16>>16}function Kf(t){return Math.floor(Math.LN2*this.DB/Math.log(t))}function Lf(){return this.s<0?-1:this.t<=0||1==this.t&&this.data[0]<=0?0:1}function Mf(t){if(null==t&&(t=10),0==this.signum()||t<2||t>36)return"0";var r=this.chunkSize(t),$=Math.pow(t,r),v=fb($),a=wa(),i=wa(),e="";for(this.divRemTo(v,a,i);a.signum()>0;)e=($+i.intValue()).toString(t).substr(1)+e,a.divRemTo(v,a,i);return i.intValue().toString(t)+e}function Nf(t,r){this.fromInt(0),null==r&&(r=10);for(var $=this.chunkSize(r),v=Math.pow(r,$),a=!1,i=0,e=0,n=0;n<t.length;++n){var u=td(t,n);u<0?"-"==t.charAt(n)&&0==this.signum()&&(a=!0):(e=r*e+u,++i>=$&&(this.dMultiply(v),this.dAddOffset(e,0),i=0,e=0))}i>0&&(this.dMultiply(Math.pow(r,i)),this.dAddOffset(e,0)),a&&ja.ZERO.subTo(this,this)}function Of(t,r,$){if("number"==typeof r){if(t<2)this.fromInt(1);else for(this.fromNumber(t,$),this.testBit(t-1)||this.bitwiseTo(ja.ONE.shiftLeft(t-1),Ac,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(r);)this.dAddOffset(2,0),this.bitLength()>t&&this.subTo(ja.ONE.shiftLeft(t-1),this);}else{var v=new Array,a=7&t;v.length=1+(t>>3),r.nextBytes(v),a>0?v[0]&=(1<<a)-1:v[0]=0,this.fromString(v,256)}}function Pf(){var t=this.t,r=new Array;r[0]=this.s;var $,v=this.DB-t*this.DB%8,a=0;if(t-->0)for(v<this.DB&&($=this.data[t]>>v)!=(this.s&this.DM)>>v&&(r[a++]=$|this.s<<this.DB-v);t>=0;)v<8?($=(this.data[t]&(1<<v)-1)<<8-v,$|=this.data[--t]>>(v+=this.DB-8)):($=this.data[t]>>(v-=8)&255,v<=0&&(v+=this.DB,--t)),0!=(128&$)&&($|=-256),0==a&&(128&this.s)!=(128&$)&&++a,(a>0||$!=this.s)&&(r[a++]=$);return r}function Qf(t){return 0==this.compareTo(t)}function Rf(t){return this.compareTo(t)<0?this:t}function Sf(t){return this.compareTo(t)>0?this:t}function Tf(t,r,$){var v,a,i=Math.min(t.t,this.t);for(v=0;v<i;++v)$.data[v]=r(this.data[v],t.data[v]);if(t.t<this.t){for(a=t.s&this.DM,v=i;v<this.t;++v)$.data[v]=r(this.data[v],a);$.t=this.t}else{for(a=this.s&this.DM,v=i;v<t.t;++v)$.data[v]=r(a,t.data[v]);$.t=t.t}$.s=r(this.s,t.s),$.clamp()}function Uf(t,r){return t&r}function Vf(t){var r=wa();return this.bitwiseTo(t,Uf,r),r}function Ac(t,r){return t|r}function Wf(t){var r=wa();return this.bitwiseTo(t,Ac,r),r}function ud(t,r){return t^r}function Xf(t){var r=wa();return this.bitwiseTo(t,ud,r),r}function vd(t,r){return t&~r}function Yf(t){var r=wa();return this.bitwiseTo(t,vd,r),r}function Zf(){for(var t=wa(),r=0;r<this.t;++r)t.data[r]=this.DM&~this.data[r];return t.t=this.t,t.s=~this.s,t}function $f(t){var r=wa();return t<0?this.rShiftTo(-t,r):this.lShiftTo(t,r),r}function _f(t){var r=wa();return t<0?this.lShiftTo(-t,r):this.rShiftTo(t,r),r}function ag(t){if(0==t)return-1;var r=0;return 0==(65535&t)&&(t>>=16,r+=16),0==(255&t)&&(t>>=8,r+=8),0==(15&t)&&(t>>=4,r+=4),0==(3&t)&&(t>>=2,r+=2),0==(1&t)&&++r,r}function bg(){for(var t=0;t<this.t;++t)if(0!=this.data[t])return t*this.DB+ag(this.data[t]);return this.s<0?this.t*this.DB:-1}function cg(t){for(var r=0;0!=t;)t&=t-1,++r;return r}function dg(){for(var t=0,r=this.s&this.DM,$=0;$<this.t;++$)t+=cg(this.data[$]^r);return t}function eg(t){var r=Math.floor(t/this.DB);return r>=this.t?0!=this.s:0!=(this.data[r]&1<<t%this.DB)}function fg(t,r){var $=ja.ONE.shiftLeft(t);return this.bitwiseTo($,r,$),$}function gg(t){return this.changeBit(t,Ac)}function hg(t){return this.changeBit(t,vd)}function ig(t){return this.changeBit(t,ud)}function jg(t,r){for(var $=0,v=0,a=Math.min(t.t,this.t);$<a;)v+=this.data[$]+t.data[$],r.data[$++]=v&this.DM,v>>=this.DB;if(t.t<this.t){for(v+=t.s;$<this.t;)v+=this.data[$],r.data[$++]=v&this.DM,v>>=this.DB;v+=this.s}else{for(v+=this.s;$<t.t;)v+=t.data[$],r.data[$++]=v&this.DM,v>>=this.DB;v+=t.s}r.s=v<0?-1:0,v>0?r.data[$++]=v:v<-1&&(r.data[$++]=this.DV+v),r.t=$,r.clamp()}function kg(t){var r=wa();return this.addTo(t,r),r}function lg(t){var r=wa();return this.subTo(t,r),r}function mg(t){var r=wa();return this.multiplyTo(t,r),r}function ng(t){var r=wa();return this.divRemTo(t,r,null),r}function og(t){var r=wa();return this.divRemTo(t,null,r),r}function pg(t){var r=wa(),$=wa();return this.divRemTo(t,r,$),new Array(r,$)}function qg(t){this.data[this.t]=this.am(0,t-1,this,0,0,this.t),++this.t,this.clamp()}function rg(t,r){if(0!=t){for(;this.t<=r;)this.data[this.t++]=0;for(this.data[r]+=t;this.data[r]>=this.DV;)this.data[r]-=this.DV,++r>=this.t&&(this.data[this.t++]=0),++this.data[r]}}function Lb(){}function wd(t){return t}function sg(t,r,$){t.multiplyTo(r,$)}function tg(t,r){t.squareTo(r)}function ug(t){return this.exp(t,new Lb)}function vg(t,r,$){var v,a=Math.min(this.t+t.t,r);for($.s=0,$.t=a;a>0;)$.data[--a]=0;for(v=$.t-this.t;a<v;++a)$.data[a+this.t]=this.am(0,t.data[a],$,a,0,this.t);for(v=Math.min(t.t,r);a<v;++a)this.am(0,t.data[a],$,a,0,r-a);$.clamp()}function wg(t,r,$){--r;var v=$.t=this.t+t.t-r;for($.s=0;--v>=0;)$.data[v]=0;for(v=Math.max(r-this.t,0);v<t.t;++v)$.data[this.t+v-r]=this.am(r-v,t.data[v],$,0,0,this.t+v-r);$.clamp(),$.drShiftTo(1,$)}function wb(t){this.r2=wa(),this.q3=wa(),ja.ONE.dlShiftTo(2*t.t,this.r2),this.mu=this.r2.divide(t),this.m=t}function xg(t){if(t.s<0||t.t>2*this.m.t)return t.mod(this.m);if(t.compareTo(this.m)<0)return t;var r=wa();return t.copyTo(r),this.reduce(r),r}function yg(t){return t}function zg(t){for(t.drShiftTo(this.m.t-1,this.r2),t.t>this.m.t+1&&(t.t=this.m.t+1,t.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);t.compareTo(this.r2)<0;)t.dAddOffset(1,this.m.t+1);for(t.subTo(this.r2,t);t.compareTo(this.m)>=0;)t.subTo(this.m,t)}function Ag(t,r){t.squareTo(r),this.reduce(r)}function Bg(t,r,$){t.multiplyTo(r,$),this.reduce($)}function Cg(t,r){var $,v,a=t.bitLength(),i=fb(1);if(a<=0)return i;$=a<18?1:a<48?3:a<144?4:a<768?5:6,v=a<8?new lb(r):r.isEven()?new wb(r):new mb(r);var e=new Array,n=3,u=$-1,o=(1<<$)-1;if(e[1]=v.convert(this),$>1){var s=wa();for(v.sqrTo(e[1],s);n<=o;)e[n]=wa(),v.mulTo(s,e[n-2],e[n]),n+=2}var h,F,p=t.t-1,f=!0,d=wa();for(a=_b(t.data[p])-1;p>=0;){for(a>=u?h=t.data[p]>>a-u&o:(h=(t.data[p]&(1<<a+1)-1)<<u-a,p>0&&(h|=t.data[p-1]>>this.DB+a-u)),n=$;0==(1&h);)h>>=1,--n;if((a-=n)<0&&(a+=this.DB,--p),f)e[h].copyTo(i),f=!1;else{for(;n>1;)v.sqrTo(i,d),v.sqrTo(d,i),n-=2;n>0?v.sqrTo(i,d):(F=i,i=d,d=F),v.mulTo(d,e[h],i)}for(;p>=0&&0==(t.data[p]&1<<a);)v.sqrTo(i,d),F=i,i=d,d=F,--a<0&&(a=this.DB-1,--p)}return v.revert(i)}function Dg(t){var r=this.s<0?this.negate():this.clone(),$=t.s<0?t.negate():t.clone();if(r.compareTo($)<0){var v=r;r=$,$=v}var a=r.getLowestSetBit(),i=$.getLowestSetBit();if(i<0)return r;for(a<i&&(i=a),i>0&&(r.rShiftTo(i,r),$.rShiftTo(i,$));r.signum()>0;)(a=r.getLowestSetBit())>0&&r.rShiftTo(a,r),(a=$.getLowestSetBit())>0&&$.rShiftTo(a,$),r.compareTo($)>=0?(r.subTo($,r),r.rShiftTo(1,r)):($.subTo(r,$),$.rShiftTo(1,$));return i>0&&$.lShiftTo(i,$),$}function Eg(t){if(t<=0)return 0;var r=this.DV%t,$=this.s<0?t-1:0;if(this.t>0)if(0==r)$=this.data[0]%t;else for(var v=this.t-1;v>=0;--v)$=(r*$+this.data[v])%t;return $}function Fg(t){var r=t.isEven();if(this.isEven()&&r||0==t.signum())return ja.ZERO;for(var $=t.clone(),v=this.clone(),a=fb(1),i=fb(0),e=fb(0),n=fb(1);0!=$.signum();){for(;$.isEven();)$.rShiftTo(1,$),r?(a.isEven()&&i.isEven()||(a.addTo(this,a),i.subTo(t,i)),a.rShiftTo(1,a)):i.isEven()||i.subTo(t,i),i.rShiftTo(1,i);for(;v.isEven();)v.rShiftTo(1,v),r?(e.isEven()&&n.isEven()||(e.addTo(this,e),n.subTo(t,n)),e.rShiftTo(1,e)):n.isEven()||n.subTo(t,n),n.rShiftTo(1,n);$.compareTo(v)>=0?($.subTo(v,$),r&&a.subTo(e,a),i.subTo(n,i)):(v.subTo($,v),r&&e.subTo(a,e),n.subTo(i,n))}return 0!=v.compareTo(ja.ONE)?ja.ZERO:n.compareTo(t)>=0?n.subtract(t):n.signum()<0?(n.addTo(t,n),n.signum()<0?n.add(t):n):n}lb.prototype.convert=sf,lb.prototype.revert=tf,lb.prototype.reduce=uf,lb.prototype.mulTo=vf,lb.prototype.sqrTo=wf,mb.prototype.convert=yf,mb.prototype.revert=zf,mb.prototype.reduce=Af,mb.prototype.mulTo=Cf,mb.prototype.sqrTo=Bf,ja.prototype.copyTo=_e,ja.prototype.fromInt=af,ja.prototype.fromString=bf,ja.prototype.clamp=cf,ja.prototype.dlShiftTo=jf,ja.prototype.drShiftTo=kf,ja.prototype.lShiftTo=lf,ja.prototype.rShiftTo=mf,ja.prototype.subTo=nf,ja.prototype.multiplyTo=of,ja.prototype.squareTo=pf,ja.prototype.divRemTo=qf,ja.prototype.invDigit=xf,ja.prototype.isEven=Df,ja.prototype.exp=Ef,ja.prototype.toString=df,ja.prototype.negate=ef,ja.prototype.abs=ff,ja.prototype.compareTo=gf,ja.prototype.bitLength=hf,ja.prototype.mod=rf,ja.prototype.modPowInt=Ff,ja.ZERO=fb(0),ja.ONE=fb(1),Lb.prototype.convert=wd,Lb.prototype.revert=wd,Lb.prototype.mulTo=sg,Lb.prototype.sqrTo=tg,wb.prototype.convert=xg,wb.prototype.revert=yg,wb.prototype.reduce=zg,wb.prototype.mulTo=Bg,wb.prototype.sqrTo=Ag;var Ta=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509],Gg=(1<<26)/Ta[Ta.length-1];function Hg(t){var r,$=this.abs();if(1==$.t&&$.data[0]<=Ta[Ta.length-1]){for(r=0;r<Ta.length;++r)if($.data[0]==Ta[r])return!0;return!1}if($.isEven())return!1;for(r=1;r<Ta.length;){for(var v=Ta[r],a=r+1;a<Ta.length&&v<Gg;)v*=Ta[a++];for(v=$.modInt(v);r<a;)if(v%Ta[r++]==0)return!1}return $.millerRabin(t)}function Ig(t){var r=this.subtract(ja.ONE),$=r.getLowestSetBit();if($<=0)return!1;for(var v,a=r.shiftRight($),i=Jg(),e=0;e<t;++e){do{v=new ja(this.bitLength(),i)}while(v.compareTo(ja.ONE)<=0||v.compareTo(r)>=0);var n=v.modPow(a,this);if(0!=n.compareTo(ja.ONE)&&0!=n.compareTo(r)){for(var u=1;u++<$&&0!=n.compareTo(r);)if(0==(n=n.modPowInt(2,this)).compareTo(ja.ONE))return!1;if(0!=n.compareTo(r))return!1}}return!0}function Jg(){return{nextBytes:function(t){for(var r=0;r<t.length;++r)t[r]=Math.floor(256*Math.random())}}}ja.prototype.chunkSize=Kf,ja.prototype.toRadix=Mf,ja.prototype.fromRadix=Nf,ja.prototype.fromNumber=Of,ja.prototype.bitwiseTo=Tf,ja.prototype.changeBit=fg,ja.prototype.addTo=jg,ja.prototype.dMultiply=qg,ja.prototype.dAddOffset=rg,ja.prototype.multiplyLowerTo=vg,ja.prototype.multiplyUpperTo=wg,ja.prototype.modInt=Eg,ja.prototype.millerRabin=Ig,ja.prototype.clone=Gf,ja.prototype.intValue=Hf,ja.prototype.byteValue=If,ja.prototype.shortValue=Jf,ja.prototype.signum=Lf,ja.prototype.toByteArray=Pf,ja.prototype.equals=Qf,ja.prototype.min=Rf,ja.prototype.max=Sf,ja.prototype.and=Vf,ja.prototype.or=Wf,ja.prototype.xor=Xf,ja.prototype.andNot=Yf,ja.prototype.not=Zf,ja.prototype.shiftLeft=$f,ja.prototype.shiftRight=_f,ja.prototype.getLowestSetBit=bg,ja.prototype.bitCount=dg,ja.prototype.testBit=eg,ja.prototype.setBit=gg,ja.prototype.clearBit=hg,ja.prototype.flipBit=ig,ja.prototype.add=kg,ja.prototype.subtract=lg,ja.prototype.multiply=mg,ja.prototype.divide=ng,ja.prototype.remainder=og,ja.prototype.divideAndRemainder=pg,ja.prototype.modPow=Cg,ja.prototype.modInverse=Fg,ja.prototype.pow=ug,ja.prototype.gcd=Dg,ja.prototype.isProbablePrime=Hg;var xd=aa.sha1=aa.sha1||{};aa.md.sha1=aa.md.algorithms.sha1=xd,xd.create=function(){Lg||Mg();var e=null,a=aa.util.createBuffer(),r=new Array(80),t={algorithm:"sha1",blockLength:64,digestLength:20,messageLength:0,fullMessageLength:null,messageLengthSize:8,start:function(){t.messageLength=0,t.fullMessageLength=t.messageLength64=[];for(var r=t.messageLengthSize/4,$=0;$<r;++$)t.fullMessageLength.push(0);return a=aa.util.createBuffer(),e={h0:1732584193,h1:4023233417,h2:2562383102,h3:271733878,h4:3285377520},t}};return t.start(),t.update=function($,h){"utf8"===h&&($=aa.util.encodeUtf8($));var g=$.length;t.messageLength+=g,g=[g/4294967296>>>0,g>>>0];for(var n=t.fullMessageLength.length-1;n>=0;--n)t.fullMessageLength[n]+=g[1],g[1]=g[0]+(t.fullMessageLength[n]/4294967296>>>0),t.fullMessageLength[n]=t.fullMessageLength[n]>>>0,g[0]=g[1]/4294967296>>>0;return a.putBytes($),yd(e,r,a),(a.read>2048||0===a.length())&&a.compact(),t},t.digest=function(){var $=aa.util.createBuffer();$.putBytes(a.bytes());var h,g=t.fullMessageLength[t.fullMessageLength.length-1]+t.messageLengthSize&t.blockLength-1;$.putBytes(Kg.substr(0,t.blockLength-g));for(var n=8*t.fullMessageLength[0],s=0;s<t.fullMessageLength.length-1;++s)n+=(h=8*t.fullMessageLength[s+1])/4294967296>>>0,$.putInt32(n>>>0),n=h>>>0;$.putInt32(n);var l={h0:e.h0,h1:e.h1,h2:e.h2,h3:e.h3,h4:e.h4};yd(l,r,$);var u=aa.util.createBuffer();return u.putInt32(l.h0),u.putInt32(l.h1),u.putInt32(l.h2),u.putInt32(l.h3),u.putInt32(l.h4),u},t};var Kg=null,Lg=!1;function Mg(){Kg=String.fromCharCode(128),Kg+=aa.util.fillString(String.fromCharCode(0),64),Lg=!0}function yd(e,a,r){for(var t,$,h,g,n,s,l,u=r.length();u>=64;){for($=e.h0,h=e.h1,g=e.h2,n=e.h3,s=e.h4,l=0;l<16;++l)t=r.getInt32(),a[l]=t,t=($<<5|$>>>27)+(n^h&(g^n))+s+1518500249+t,s=n,n=g,g=(h<<30|h>>>2)>>>0,h=$,$=t;for(;l<20;++l)t=(t=a[l-3]^a[l-8]^a[l-14]^a[l-16])<<1|t>>>31,a[l]=t,t=($<<5|$>>>27)+(n^h&(g^n))+s+1518500249+t,s=n,n=g,g=(h<<30|h>>>2)>>>0,h=$,$=t;for(;l<32;++l)t=(t=a[l-3]^a[l-8]^a[l-14]^a[l-16])<<1|t>>>31,a[l]=t,t=($<<5|$>>>27)+(h^g^n)+s+1859775393+t,s=n,n=g,g=(h<<30|h>>>2)>>>0,h=$,$=t;for(;l<40;++l)t=(t=a[l-6]^a[l-16]^a[l-28]^a[l-32])<<2|t>>>30,a[l]=t,t=($<<5|$>>>27)+(h^g^n)+s+1859775393+t,s=n,n=g,g=(h<<30|h>>>2)>>>0,h=$,$=t;for(;l<60;++l)t=(t=a[l-6]^a[l-16]^a[l-28]^a[l-32])<<2|t>>>30,a[l]=t,t=($<<5|$>>>27)+(h&g|n&(h^g))+s+2400959708+t,s=n,n=g,g=(h<<30|h>>>2)>>>0,h=$,$=t;for(;l<80;++l)t=(t=a[l-6]^a[l-16]^a[l-28]^a[l-32])<<2|t>>>30,a[l]=t,t=($<<5|$>>>27)+(h^g^n)+s+3395469782+t,s=n,n=g,g=(h<<30|h>>>2)>>>0,h=$,$=t;e.h0=e.h0+$|0,e.h1=e.h1+h|0,e.h2=e.h2+g|0,e.h3=e.h3+n|0,e.h4=e.h4+s|0,u-=64}}var zd=aa.pkcs1=aa.pkcs1||{};function ac(e,t,r){r||(r=aa.md.sha1.create());for(var g="",a=Math.ceil(t/r.digestLength),s=0;s<a;++s){var n=String.fromCharCode(s>>24&255,s>>16&255,s>>8&255,255&s);r.start(),r.update(e+n),g+=r.digest().getBytes()}return g.substring(0,t)}zd.encode_rsa_oaep=function(e,t,r){var g,a,s,n;"string"==typeof r?(g=r,a=arguments[3]||void 0,s=arguments[4]||void 0):r&&(g=r.label||void 0,a=r.seed||void 0,s=r.md||void 0,r.mgf1&&r.mgf1.md&&(n=r.mgf1.md)),s?s.start():s=aa.md.sha1.create(),n||(n=s);var i=Math.ceil(e.n.bitLength()/8),$=i-2*s.digestLength-2;if(t.length>$)throw(l=new Error("RSAES-OAEP input message length is too long.")).length=t.length,l.maxLength=$,l;g||(g=""),s.update(g,"raw");for(var h=s.digest(),o="",d=$-t.length,v=0;v<d;v++)o+="\0";var f=h.getBytes()+o+"\x01"+t;if(a){if(a.length!==s.digestLength){var l;throw(l=new Error("Invalid RSAES-OAEP seed. The seed length must match the digest length.")).seedLength=a.length,l.digestLength=s.digestLength,l}}else a=aa.random.getBytes(s.digestLength);var S=ac(a,i-s.digestLength-1,n),P=aa.util.xorBytes(f,S,f.length),c=ac(P,s.digestLength,n);return"\0"+aa.util.xorBytes(a,c,a.length)+P},zd.decode_rsa_oaep=function(e,t,r){var g,a,s;"string"==typeof r?(g=r,a=arguments[3]||void 0):r&&(g=r.label||void 0,a=r.md||void 0,r.mgf1&&r.mgf1.md&&(s=r.mgf1.md));var n=Math.ceil(e.n.bitLength()/8);if(t.length!==n)throw(S=new Error("RSAES-OAEP encoded message length is invalid.")).length=t.length,S.expectedLength=n,S;if(void 0===a?a=aa.md.sha1.create():a.start(),s||(s=a),n<2*a.digestLength+2)throw new Error("RSAES-OAEP key is too short for the hash function.");g||(g=""),a.update(g,"raw");for(var i=a.digest().getBytes(),$=t.charAt(0),h=t.substring(1,a.digestLength+1),o=t.substring(1+a.digestLength),d=ac(o,a.digestLength,s),v=ac(aa.util.xorBytes(h,d,h.length),n-a.digestLength-1,s),f=aa.util.xorBytes(o,v,o.length),l=f.substring(0,a.digestLength),S="\0"!==$,P=0;P<a.digestLength;++P)S|=i.charAt(P)!==l.charAt(P);for(var c=1,m=a.digestLength,u=a.digestLength;u<f.length;u++){var V=f.charCodeAt(u);S|=V&(c?65534:0),m+=c&=1&V^1}if(S||1!==f.charCodeAt(m))throw new Error("Invalid RSAES-OAEP padding.");return f.substring(m+1)};(function(){if(aa.prime){}else{var r=aa.prime=aa.prime||{},e=aa.jsbn.BigInteger,t=[6,4,2,4,2,4,6,2],n=new e(null);n.fromInt(30);var i=function(r,e){return r|e};r.generateProbablePrime=function(r,t,n){"function"==typeof t&&(n=t,t={});var i=(t=t||{}).algorithm||"PRIMEINC";"string"==typeof i&&(i={name:i}),i.options=i.options||{};var f=t.prng||aa.random,$={nextBytes:function(r){for(var e=f.getBytesSync(r.length),t=0;t<r.length;++t)r[t]=e.charCodeAt(t)}};if("PRIMEINC"===i.name)return function(r,t,n,i){if("workers"in n)return function(r,t,n,i){if("undefined"==typeof Worker)return o(r,t,n,i);var f=a(r,t),$=n.workers,u=n.workLoad||100,s=30*u/8,g=n.workerScript||"forge/prime.worker.js";if(-1===$)return aa.util.estimateCores(function(r,e){r&&(e=2),$=e-1,l()});function l(){$=Math.max(1,$);for(var n=[],o=0;o<$;++o)n[o]=new Worker(g);for(var o=0;o<$;++o)n[o].addEventListener("message",m);var l=!1;function m(o){if(!l){0;var $=o.data;if($.found){for(var g=0;g<n.length;++g)n[g].terminate();return l=!0,i(null,new e($.prime,16))}f.bitLength()>r&&(f=a(r,t));var m=f.toString(16);o.target.postMessage({hex:m,workLoad:u}),f.dAddOffset(s,0)}}}l()}(r,t,n,i);return o(r,t,n,i)}(r,$,i.options,n);throw new Error("Invalid prime generation algorithm: "+i.name)}}function o(r,e,n,i){var o=a(r,e),f=function(r){return r<=100?27:r<=150?18:r<=200?15:r<=250?12:r<=300?9:r<=350?8:r<=400?7:r<=500?6:r<=600?5:r<=800?4:r<=1250?3:2}(o.bitLength());"millerRabinTests"in n&&(f=n.millerRabinTests);var $=10;"maxBlockTime"in n&&($=n.maxBlockTime),function r(e,n,i,o,f,$,u){var s=+new Date;do{if(e.bitLength()>n&&(e=a(n,i)),e.isProbablePrime(f))return u(null,e);e.dAddOffset(t[o++%8],0)}while($<0||+new Date-s<$);aa.util.setImmediate(function(){r(e,n,i,o,f,$,u)})}(o,r,e,0,f,$,i)}function a(r,t){var o=new e(r,t),a=r-1;return o.testBit(a)||o.bitwiseTo(e.ONE.shiftLeft(a),i,o),o.dAddOffset(31-o.mod(n).byteValue(),0),o}})();if(void 0===xa)var xa=aa.jsbn.BigInteger;var Bc=aa.util.isNodejs?(ab(),{}):null,ha=aa.asn1,Oa=aa.util;aa.pki=aa.pki||{};var qa=aa.pki,Ng=[6,4,2,4,2,4,6,2],Og={name:"PrivateKeyInfo",tagClass:ha.Class.UNIVERSAL,type:ha.Type.SEQUENCE,constructed:!0,value:[{name:"PrivateKeyInfo.version",tagClass:ha.Class.UNIVERSAL,type:ha.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"PrivateKeyInfo.privateKeyAlgorithm",tagClass:ha.Class.UNIVERSAL,type:ha.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:ha.Class.UNIVERSAL,type:ha.Type.OID,constructed:!1,capture:"privateKeyOid"}]},{name:"PrivateKeyInfo",tagClass:ha.Class.UNIVERSAL,type:ha.Type.OCTETSTRING,constructed:!1,capture:"privateKey"}]},Pg={name:"RSAPrivateKey",tagClass:ha.Class.UNIVERSAL,type:ha.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPrivateKey.version",tagClass:ha.Class.UNIVERSAL,type:ha.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"RSAPrivateKey.modulus",tagClass:ha.Class.UNIVERSAL,type:ha.Type.INTEGER,constructed:!1,capture:"privateKeyModulus"},{name:"RSAPrivateKey.publicExponent",tagClass:ha.Class.UNIVERSAL,type:ha.Type.INTEGER,constructed:!1,capture:"privateKeyPublicExponent"},{name:"RSAPrivateKey.privateExponent",tagClass:ha.Class.UNIVERSAL,type:ha.Type.INTEGER,constructed:!1,capture:"privateKeyPrivateExponent"},{name:"RSAPrivateKey.prime1",tagClass:ha.Class.UNIVERSAL,type:ha.Type.INTEGER,constructed:!1,capture:"privateKeyPrime1"},{name:"RSAPrivateKey.prime2",tagClass:ha.Class.UNIVERSAL,type:ha.Type.INTEGER,constructed:!1,capture:"privateKeyPrime2"},{name:"RSAPrivateKey.exponent1",tagClass:ha.Class.UNIVERSAL,type:ha.Type.INTEGER,constructed:!1,capture:"privateKeyExponent1"},{name:"RSAPrivateKey.exponent2",tagClass:ha.Class.UNIVERSAL,type:ha.Type.INTEGER,constructed:!1,capture:"privateKeyExponent2"},{name:"RSAPrivateKey.coefficient",tagClass:ha.Class.UNIVERSAL,type:ha.Type.INTEGER,constructed:!1,capture:"privateKeyCoefficient"}]},Qg={name:"RSAPublicKey",tagClass:ha.Class.UNIVERSAL,type:ha.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPublicKey.modulus",tagClass:ha.Class.UNIVERSAL,type:ha.Type.INTEGER,constructed:!1,capture:"publicKeyModulus"},{name:"RSAPublicKey.exponent",tagClass:ha.Class.UNIVERSAL,type:ha.Type.INTEGER,constructed:!1,capture:"publicKeyExponent"}]},Rg=aa.pki.rsa.publicKeyValidator={name:"SubjectPublicKeyInfo",tagClass:ha.Class.UNIVERSAL,type:ha.Type.SEQUENCE,constructed:!0,captureAsn1:"subjectPublicKeyInfo",value:[{name:"SubjectPublicKeyInfo.AlgorithmIdentifier",tagClass:ha.Class.UNIVERSAL,type:ha.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:ha.Class.UNIVERSAL,type:ha.Type.OID,constructed:!1,capture:"publicKeyOid"}]},{name:"SubjectPublicKeyInfo.subjectPublicKey",tagClass:ha.Class.UNIVERSAL,type:ha.Type.BITSTRING,constructed:!1,value:[{name:"SubjectPublicKeyInfo.subjectPublicKey.RSAPublicKey",tagClass:ha.Class.UNIVERSAL,type:ha.Type.SEQUENCE,constructed:!0,optional:!0,captureAsn1:"rsaPublicKey"}]}]},Sg=function(e){var r;if(!(e.algorithm in qa.oids)){var a=new Error("Unknown message digest algorithm.");throw a.algorithm=e.algorithm,a}r=qa.oids[e.algorithm];var $=ha.oidToDer(r).getBytes(),t=ha.create(ha.Class.UNIVERSAL,ha.Type.SEQUENCE,!0,[]),n=ha.create(ha.Class.UNIVERSAL,ha.Type.SEQUENCE,!0,[]);n.value.push(ha.create(ha.Class.UNIVERSAL,ha.Type.OID,!1,$)),n.value.push(ha.create(ha.Class.UNIVERSAL,ha.Type.NULL,!1,""));var i=ha.create(ha.Class.UNIVERSAL,ha.Type.OCTETSTRING,!1,e.digest().getBytes());return t.value.push(n),t.value.push(i),ha.toDer(t).getBytes()},Ad=function(e,r,a){if(a)return e.modPow(r.e,r.n);if(!r.p||!r.q)return e.modPow(r.d,r.n);var $;r.dP||(r.dP=r.d.mod(r.p.subtract(xa.ONE))),r.dQ||(r.dQ=r.d.mod(r.q.subtract(xa.ONE))),r.qInv||(r.qInv=r.q.modInverse(r.p));do{$=new xa(aa.util.bytesToHex(aa.random.getBytes(r.n.bitLength()/8)),16)}while($.compareTo(r.n)>=0||!$.gcd(r.n).equals(xa.ONE));for(var t=(e=e.multiply($.modPow(r.e,r.n)).mod(r.n)).mod(r.p).modPow(r.dP,r.p),n=e.mod(r.q).modPow(r.dQ,r.q);t.compareTo(n)<0;)t=t.add(r.p);var i=t.subtract(n).multiply(r.qInv).mod(r.p).multiply(r.q).add(n);return i=i.multiply($.modInverse(r.n)).mod(r.n)};function Bd(e,r,a){var $=aa.util.createBuffer(),t=Math.ceil(r.n.bitLength()/8);if(e.length>t-11){var n=new Error("Message is too long for PKCS#1 v1.5 padding.");throw n.length=e.length,n.max=t-11,n}$.putByte(0),$.putByte(a);var i,s=t-3-e.length;if(0===a||1===a){i=0===a?0:255;for(var o=0;o<s;++o)$.putByte(i)}else for(;s>0;){var v=0,S=aa.random.getBytes(s);for(o=0;o<s;++o)0===(i=S.charCodeAt(o))?++v:$.putByte(i);s=v}return $.putByte(0),$.putBytes(e),$}function bc(e,r,a,$){var t=Math.ceil(r.n.bitLength()/8),n=aa.util.createBuffer(e),i=n.getByte(),s=n.getByte();if(0!==i||a&&0!==s&&1!==s||!a&&2!=s||a&&0===s&&void 0===$)throw new Error("Encryption block is invalid.");var o=0;if(0===s){o=t-3-$;for(var v=0;v<o;++v)if(0!==n.getByte())throw new Error("Encryption block is invalid.")}else if(1===s)for(o=0;n.length()>1;){if(255!==n.getByte()){--n.read;break}++o}else if(2===s)for(o=0;n.length()>1;){if(0===n.getByte()){--n.read;break}++o}if(0!==n.getByte()||o!==t-3-n.length())throw new Error("Encryption block is invalid.");return n.getBytes()}function Tg(e,r,a){"function"==typeof r&&(a=r,r={});var $={algorithm:{name:(r=r||{}).algorithm||"PRIMEINC",options:{workers:r.workers||2,workLoad:r.workLoad||100,workerScript:r.workerScript}}};function t(){n(e.pBits,function(r,$){return r?a(r):(e.p=$,null!==e.q?i(r,e.q):void n(e.qBits,i))})}function n(e,r){aa.prime.generateProbablePrime(e,$,r)}function i(r,$){if(r)return a(r);if(e.q=$,e.p.compareTo(e.q)<0){var s=e.p;e.p=e.q,e.q=s}if(0!==e.p.subtract(xa.ONE).gcd(e.e).compareTo(xa.ONE))return e.p=null,void t();if(0!==e.q.subtract(xa.ONE).gcd(e.e).compareTo(xa.ONE))return e.q=null,void n(e.qBits,i);if(e.p1=e.p.subtract(xa.ONE),e.q1=e.q.subtract(xa.ONE),e.phi=e.p1.multiply(e.q1),0!==e.phi.gcd(e.e).compareTo(xa.ONE))return e.p=e.q=null,void t();if(e.n=e.p.multiply(e.q),e.n.bitLength()!==e.bits)return e.q=null,void n(e.qBits,i);var o=e.e.modInverse(e.phi);e.keys={privateKey:qa.rsa.setPrivateKey(e.n,e.e,o,e.p,e.q,o.mod(e.p1),o.mod(e.q1),e.q.modInverse(e.p)),publicKey:qa.rsa.setPublicKey(e.n,e.e)},a(null,e.keys)}"prng"in r&&($.prng=r.prng),t()}function Za(e){var r=e.toString(16);r[0]>="8"&&(r="00"+r);var a=aa.util.hexToBytes(r);return a.length>1&&(0===a.charCodeAt(0)&&0==(128&a.charCodeAt(1))||255===a.charCodeAt(0)&&128==(128&a.charCodeAt(1)))?a.substr(1):a}function Ug(e){return e<=100?27:e<=150?18:e<=200?15:e<=250?12:e<=300?9:e<=350?8:e<=400?7:e<=500?6:e<=600?5:e<=800?4:e<=1250?3:2}function Cd(e){return aa.util.isNodejs&&"function"==typeof Bc[e]}function Dd(e){return void 0!==Oa.globalScope&&"object"==typeof Oa.globalScope.crypto&&"object"==typeof Oa.globalScope.crypto.subtle&&"function"==typeof Oa.globalScope.crypto.subtle[e]}function Ed(e){return void 0!==Oa.globalScope&&"object"==typeof Oa.globalScope.msCrypto&&"object"==typeof Oa.globalScope.msCrypto.subtle&&"function"==typeof Oa.globalScope.msCrypto.subtle[e]}function Fd(e){for(var r=aa.util.hexToBytes(e.toString(16)),a=new Uint8Array(r.length),$=0;$<r.length;++$)a[$]=r.charCodeAt($);return a}qa.rsa.encrypt=function(e,r,a){var $,t=a,n=Math.ceil(r.n.bitLength()/8);!1!==a&&!0!==a?(t=2===a,$=Bd(e,r,a)):($=aa.util.createBuffer()).putBytes(e);for(var i=new xa($.toHex(),16),s=Ad(i,r,t).toString(16),o=aa.util.createBuffer(),v=n-Math.ceil(s.length/2);v>0;)o.putByte(0),--v;return o.putBytes(aa.util.hexToBytes(s)),o.getBytes()},qa.rsa.decrypt=function(e,r,a,$){var t=Math.ceil(r.n.bitLength()/8);if(e.length!==t){var n=new Error("Encrypted message length is invalid.");throw n.length=e.length,n.expected=t,n}var i=new xa(aa.util.createBuffer(e).toHex(),16);if(i.compareTo(r.n)>=0)throw new Error("Encrypted message is invalid.");for(var s=Ad(i,r,a).toString(16),o=aa.util.createBuffer(),v=t-Math.ceil(s.length/2);v>0;)o.putByte(0),--v;return o.putBytes(aa.util.hexToBytes(s)),!1!==$?bc(o.getBytes(),r,a):o.getBytes()},qa.rsa.createKeyPairGenerationState=function(e,r,a){"string"==typeof e&&(e=parseInt(e,10)),e=e||2048;var $,t=(a=a||{}).prng||aa.random,n={nextBytes:function(e){for(var r=t.getBytesSync(e.length),a=0;a<e.length;++a)e[a]=r.charCodeAt(a)}},i=a.algorithm||"PRIMEINC";if("PRIMEINC"!==i)throw new Error("Invalid key generation algorithm: "+i);return($={algorithm:i,state:0,bits:e,rng:n,eInt:r||65537,e:new xa(null),p:null,q:null,qBits:e>>1,pBits:e-(e>>1),pqState:0,num:null,keys:null}).e.fromInt($.eInt),$},qa.rsa.stepKeyPairGenerationState=function(e,r){"algorithm"in e||(e.algorithm="PRIMEINC");var a=new xa(null);a.fromInt(30);for(var $,t=0,n=function(e,r){return e|r},i=+new Date,s=0;null===e.keys&&(r<=0||s<r);){if(0===e.state){var o=null===e.p?e.pBits:e.qBits,v=o-1;0===e.pqState?(e.num=new xa(o,e.rng),e.num.testBit(v)||e.num.bitwiseTo(xa.ONE.shiftLeft(v),n,e.num),e.num.dAddOffset(31-e.num.mod(a).byteValue(),0),t=0,++e.pqState):1===e.pqState?e.num.bitLength()>o?e.pqState=0:e.num.isProbablePrime(Ug(e.num.bitLength()))?++e.pqState:e.num.dAddOffset(Ng[t++%8],0):2===e.pqState?e.pqState=0===e.num.subtract(xa.ONE).gcd(e.e).compareTo(xa.ONE)?3:0:3===e.pqState&&(e.pqState=0,null===e.p?e.p=e.num:e.q=e.num,null!==e.p&&null!==e.q&&++e.state,e.num=null)}else if(1===e.state)e.p.compareTo(e.q)<0&&(e.num=e.p,e.p=e.q,e.q=e.num),++e.state;else if(2===e.state)e.p1=e.p.subtract(xa.ONE),e.q1=e.q.subtract(xa.ONE),e.phi=e.p1.multiply(e.q1),++e.state;else if(3===e.state)0===e.phi.gcd(e.e).compareTo(xa.ONE)?++e.state:(e.p=null,e.q=null,e.state=0);else if(4===e.state)e.n=e.p.multiply(e.q),e.n.bitLength()===e.bits?++e.state:(e.q=null,e.state=0);else if(5===e.state){var S=e.e.modInverse(e.phi);e.keys={privateKey:qa.rsa.setPrivateKey(e.n,e.e,S,e.p,e.q,S.mod(e.p1),S.mod(e.q1),e.q.modInverse(e.p)),publicKey:qa.rsa.setPublicKey(e.n,e.e)}}s+=($=+new Date)-i,i=$}return null!==e.keys},qa.rsa.generateKeyPair=function(e,r,a,$){if(1===arguments.length?"object"==typeof e?(a=e,e=void 0):"function"==typeof e&&($=e,e=void 0):2===arguments.length?"number"==typeof e?"function"==typeof r?($=r,r=void 0):"number"!=typeof r&&(a=r,r=void 0):(a=e,$=r,e=void 0,r=void 0):3===arguments.length&&("number"==typeof r?"function"==typeof a&&($=a,a=void 0):($=a,a=r,r=void 0)),a=a||{},void 0===e&&(e=a.bits||2048),void 0===r&&(r=a.e||65537),!aa.options.usePureJavaScript&&!a.prng&&e>=256&&e<=16384&&(65537===r||3===r))if($){if(Cd("generateKeyPair"))return Bc.generateKeyPair("rsa",{modulusLength:e,publicExponent:r,publicKeyEncoding:{type:"spki",format:"pem"},privateKeyEncoding:{type:"pkcs8",format:"pem"}},function(e,r,a){if(e)return $(e);$(null,{privateKey:qa.privateKeyFromPem(a),publicKey:qa.publicKeyFromPem(r)})});if(Dd("generateKey")&&Dd("exportKey"))return Oa.globalScope.crypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:Fd(r),hash:{name:"SHA-256"}},!0,["sign","verify"]).then(function(e){return Oa.globalScope.crypto.subtle.exportKey("pkcs8",e.privateKey)}).then(void 0,function(e){$(e)}).then(function(e){if(e){var r=qa.privateKeyFromAsn1(ha.fromDer(aa.util.createBuffer(e)));$(null,{privateKey:r,publicKey:qa.setRsaPublicKey(r.n,r.e)})}});if(Ed("generateKey")&&Ed("exportKey")){var t=Oa.globalScope.msCrypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:Fd(r),hash:{name:"SHA-256"}},!0,["sign","verify"]);return t.oncomplete=function(e){var r=e.target.result,a=Oa.globalScope.msCrypto.subtle.exportKey("pkcs8",r.privateKey);a.oncomplete=function(e){var r=e.target.result,a=qa.privateKeyFromAsn1(ha.fromDer(aa.util.createBuffer(r)));$(null,{privateKey:a,publicKey:qa.setRsaPublicKey(a.n,a.e)})},a.onerror=function(e){$(e)}},void(t.onerror=function(e){$(e)})}}else if(Cd("generateKeyPairSync")){var n=Bc.generateKeyPairSync("rsa",{modulusLength:e,publicExponent:r,publicKeyEncoding:{type:"spki",format:"pem"},privateKeyEncoding:{type:"pkcs8",format:"pem"}});return{privateKey:qa.privateKeyFromPem(n.privateKey),publicKey:qa.publicKeyFromPem(n.publicKey)}}var i=qa.rsa.createKeyPairGenerationState(e,r,a);if(!$)return qa.rsa.stepKeyPairGenerationState(i,0),i.keys;Tg(i,a,$)},qa.setRsaPublicKey=qa.rsa.setPublicKey=function(e,r){var a={n:e,e:r,encrypt:function(e,r,$){if("string"==typeof r?r=r.toUpperCase():void 0===r&&(r="RSAES-PKCS1-V1_5"),"RSAES-PKCS1-V1_5"===r)r={encode:function(e,r,a){return Bd(e,r,2).getBytes()}};else if("RSA-OAEP"===r||"RSAES-OAEP"===r)r={encode:function(e,r){return aa.pkcs1.encode_rsa_oaep(r,e,$)}};else if(-1!==["RAW","NONE","NULL",null].indexOf(r))r={encode:function(e){return e}};else if("string"==typeof r)throw new Error("Unsupported encryption scheme: \""+r+"\".");var t=r.encode(e,a,!0);return qa.rsa.encrypt(t,a,!0)},verify:function(e,r,$){"string"==typeof $?$=$.toUpperCase():void 0===$&&($="RSASSA-PKCS1-V1_5"),"RSASSA-PKCS1-V1_5"===$?$={verify:function(e,r){return r=bc(r,a,!0),e===ha.fromDer(r).value[1].value}}:"NONE"!==$&&"NULL"!==$&&null!==$||($={verify:function(e,r){return e===(r=bc(r,a,!0))}});var t=qa.rsa.decrypt(r,a,!0,!1);return $.verify(e,t,a.n.bitLength())}};return a},qa.setRsaPrivateKey=qa.rsa.setPrivateKey=function(e,r,a,$,t,n,i,s){var o={n:e,e:r,d:a,p:$,q:t,dP:n,dQ:i,qInv:s,decrypt:function(e,r,a){"string"==typeof r?r=r.toUpperCase():void 0===r&&(r="RSAES-PKCS1-V1_5");var $=qa.rsa.decrypt(e,o,!1,!1);if("RSAES-PKCS1-V1_5"===r)r={decode:bc};else if("RSA-OAEP"===r||"RSAES-OAEP"===r)r={decode:function(e,r){return aa.pkcs1.decode_rsa_oaep(r,e,a)}};else{if(-1===["RAW","NONE","NULL",null].indexOf(r))throw new Error("Unsupported encryption scheme: \""+r+"\".");r={decode:function(e){return e}}}return r.decode($,o,!1)},sign:function(e,r){var a=!1;"string"==typeof r&&(r=r.toUpperCase()),void 0===r||"RSASSA-PKCS1-V1_5"===r?(r={encode:Sg},a=1):"NONE"!==r&&"NULL"!==r&&null!==r||(r={encode:function(){return e}},a=1);var $=r.encode(e,o.n.bitLength());return qa.rsa.encrypt($,o,a)}};return o},qa.wrapRsaPrivateKey=function(e){return ha.create(ha.Class.UNIVERSAL,ha.Type.SEQUENCE,!0,[ha.create(ha.Class.UNIVERSAL,ha.Type.INTEGER,!1,ha.integerToDer(0).getBytes()),ha.create(ha.Class.UNIVERSAL,ha.Type.SEQUENCE,!0,[ha.create(ha.Class.UNIVERSAL,ha.Type.OID,!1,ha.oidToDer(qa.oids.rsaEncryption).getBytes()),ha.create(ha.Class.UNIVERSAL,ha.Type.NULL,!1,"")]),ha.create(ha.Class.UNIVERSAL,ha.Type.OCTETSTRING,!1,ha.toDer(e).getBytes())])},qa.privateKeyFromAsn1=function(e){var r,a,$,t,n,i,s,o,v={},S=[];if(ha.validate(e,Og,v,S)&&(e=ha.fromDer(aa.util.createBuffer(v.privateKey))),v={},S=[],!ha.validate(e,Pg,v,S)){var p=new Error("Cannot read private key. ASN.1 object does not contain an RSAPrivateKey.");throw p.errors=S,p}return r=aa.util.createBuffer(v.privateKeyModulus).toHex(),a=aa.util.createBuffer(v.privateKeyPublicExponent).toHex(),$=aa.util.createBuffer(v.privateKeyPrivateExponent).toHex(),t=aa.util.createBuffer(v.privateKeyPrime1).toHex(),n=aa.util.createBuffer(v.privateKeyPrime2).toHex(),i=aa.util.createBuffer(v.privateKeyExponent1).toHex(),s=aa.util.createBuffer(v.privateKeyExponent2).toHex(),o=aa.util.createBuffer(v.privateKeyCoefficient).toHex(),qa.setRsaPrivateKey(new xa(r,16),new xa(a,16),new xa($,16),new xa(t,16),new xa(n,16),new xa(i,16),new xa(s,16),new xa(o,16))},qa.privateKeyToAsn1=qa.privateKeyToRSAPrivateKey=function(e){return ha.create(ha.Class.UNIVERSAL,ha.Type.SEQUENCE,!0,[ha.create(ha.Class.UNIVERSAL,ha.Type.INTEGER,!1,ha.integerToDer(0).getBytes()),ha.create(ha.Class.UNIVERSAL,ha.Type.INTEGER,!1,Za(e.n)),ha.create(ha.Class.UNIVERSAL,ha.Type.INTEGER,!1,Za(e.e)),ha.create(ha.Class.UNIVERSAL,ha.Type.INTEGER,!1,Za(e.d)),ha.create(ha.Class.UNIVERSAL,ha.Type.INTEGER,!1,Za(e.p)),ha.create(ha.Class.UNIVERSAL,ha.Type.INTEGER,!1,Za(e.q)),ha.create(ha.Class.UNIVERSAL,ha.Type.INTEGER,!1,Za(e.dP)),ha.create(ha.Class.UNIVERSAL,ha.Type.INTEGER,!1,Za(e.dQ)),ha.create(ha.Class.UNIVERSAL,ha.Type.INTEGER,!1,Za(e.qInv))])},qa.publicKeyFromAsn1=function(e){var r={},a=[];if(ha.validate(e,Rg,r,a)){var $,t=ha.derToOid(r.publicKeyOid);if(t!==qa.oids.rsaEncryption)throw($=new Error("Cannot read public key. Unknown OID.")).oid=t,$;e=r.rsaPublicKey}if(a=[],!ha.validate(e,Qg,r,a))throw($=new Error("Cannot read public key. ASN.1 object does not contain an RSAPublicKey.")).errors=a,$;var n=aa.util.createBuffer(r.publicKeyModulus).toHex(),i=aa.util.createBuffer(r.publicKeyExponent).toHex();return qa.setRsaPublicKey(new xa(n,16),new xa(i,16))},qa.publicKeyToAsn1=qa.publicKeyToSubjectPublicKeyInfo=function(e){return ha.create(ha.Class.UNIVERSAL,ha.Type.SEQUENCE,!0,[ha.create(ha.Class.UNIVERSAL,ha.Type.SEQUENCE,!0,[ha.create(ha.Class.UNIVERSAL,ha.Type.OID,!1,ha.oidToDer(qa.oids.rsaEncryption).getBytes()),ha.create(ha.Class.UNIVERSAL,ha.Type.NULL,!1,"")]),ha.create(ha.Class.UNIVERSAL,ha.Type.BITSTRING,!1,[qa.publicKeyToRSAPublicKey(e)])])},qa.publicKeyToRSAPublicKey=function(e){return ha.create(ha.Class.UNIVERSAL,ha.Type.SEQUENCE,!0,[ha.create(ha.Class.UNIVERSAL,ha.Type.INTEGER,!1,Za(e.n)),ha.create(ha.Class.UNIVERSAL,ha.Type.INTEGER,!1,Za(e.e))])};if(void 0===Vg)var Vg=aa.jsbn.BigInteger;var ia=aa.asn1,ra=aa.pki=aa.pki||{};var nb=ra.oids,Wg={name:"EncryptedPrivateKeyInfo",tagClass:ia.Class.UNIVERSAL,type:ia.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedPrivateKeyInfo.encryptionAlgorithm",tagClass:ia.Class.UNIVERSAL,type:ia.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:ia.Class.UNIVERSAL,type:ia.Type.OID,constructed:!1,capture:"encryptionOid"},{name:"AlgorithmIdentifier.parameters",tagClass:ia.Class.UNIVERSAL,type:ia.Type.SEQUENCE,constructed:!0,captureAsn1:"encryptionParams"}]},{name:"EncryptedPrivateKeyInfo.encryptedData",tagClass:ia.Class.UNIVERSAL,type:ia.Type.OCTETSTRING,constructed:!1,capture:"encryptedData"}]},Xg={name:"PBES2Algorithms",tagClass:ia.Class.UNIVERSAL,type:ia.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc",tagClass:ia.Class.UNIVERSAL,type:ia.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc.oid",tagClass:ia.Class.UNIVERSAL,type:ia.Type.OID,constructed:!1,capture:"kdfOid"},{name:"PBES2Algorithms.params",tagClass:ia.Class.UNIVERSAL,type:ia.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.params.salt",tagClass:ia.Class.UNIVERSAL,type:ia.Type.OCTETSTRING,constructed:!1,capture:"kdfSalt"},{name:"PBES2Algorithms.params.iterationCount",tagClass:ia.Class.UNIVERSAL,type:ia.Type.INTEGER,constructed:!1,capture:"kdfIterationCount"},{name:"PBES2Algorithms.params.keyLength",tagClass:ia.Class.UNIVERSAL,type:ia.Type.INTEGER,constructed:!1,optional:!0,capture:"keyLength"},{name:"PBES2Algorithms.params.prf",tagClass:ia.Class.UNIVERSAL,type:ia.Type.SEQUENCE,constructed:!0,optional:!0,value:[{name:"PBES2Algorithms.params.prf.algorithm",tagClass:ia.Class.UNIVERSAL,type:ia.Type.OID,constructed:!1,capture:"prfOid"}]}]}]},{name:"PBES2Algorithms.encryptionScheme",tagClass:ia.Class.UNIVERSAL,type:ia.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.encryptionScheme.oid",tagClass:ia.Class.UNIVERSAL,type:ia.Type.OID,constructed:!1,capture:"encOid"},{name:"PBES2Algorithms.encryptionScheme.iv",tagClass:ia.Class.UNIVERSAL,type:ia.Type.OCTETSTRING,constructed:!1,capture:"encIv"}]}]},Yg={name:"pkcs-12PbeParams",tagClass:ia.Class.UNIVERSAL,type:ia.Type.SEQUENCE,constructed:!0,value:[{name:"pkcs-12PbeParams.salt",tagClass:ia.Class.UNIVERSAL,type:ia.Type.OCTETSTRING,constructed:!1,capture:"salt"},{name:"pkcs-12PbeParams.iterations",tagClass:ia.Class.UNIVERSAL,type:ia.Type.INTEGER,constructed:!1,capture:"iterations"}]};function Gd(e,r){return e.start().update(r).digest().getBytes()}function Hd(e){var r;if(e){if(!(r=ra.oids[ia.derToOid(e)])){var a=new Error("Unsupported PRF OID.");throw a.oid=e,a.supported=["hmacWithSHA1","hmacWithSHA224","hmacWithSHA256","hmacWithSHA384","hmacWithSHA512"],a}}else r="hmacWithSHA1";return Id(r)}function Id(e){var r=aa.md;switch(e){case"hmacWithSHA224":r=aa.md.sha512;case"hmacWithSHA1":case"hmacWithSHA256":case"hmacWithSHA384":case"hmacWithSHA512":e=e.substr(8).toLowerCase();break;default:var a=new Error("Unsupported PRF algorithm.");throw a.algorithm=e,a.supported=["hmacWithSHA1","hmacWithSHA224","hmacWithSHA256","hmacWithSHA384","hmacWithSHA512"],a;}if(!(r&&e in r))throw new Error("Unknown hash algorithm: "+e);return r[e].create()}function Zg(e,r,a,$){var t=ia.create(ia.Class.UNIVERSAL,ia.Type.SEQUENCE,!0,[ia.create(ia.Class.UNIVERSAL,ia.Type.OCTETSTRING,!1,e),ia.create(ia.Class.UNIVERSAL,ia.Type.INTEGER,!1,r.getBytes())]);return"hmacWithSHA1"!==$&&t.value.push(ia.create(ia.Class.UNIVERSAL,ia.Type.INTEGER,!1,aa.util.hexToBytes(a.toString(16))),ia.create(ia.Class.UNIVERSAL,ia.Type.SEQUENCE,!0,[ia.create(ia.Class.UNIVERSAL,ia.Type.OID,!1,ia.oidToDer(ra.oids[$]).getBytes()),ia.create(ia.Class.UNIVERSAL,ia.Type.NULL,!1,"")])),t}ra.encryptPrivateKeyInfo=function(e,r,a){(a=a||{}).saltSize=a.saltSize||8,a.count=a.count||2048,a.algorithm=a.algorithm||"aes128",a.prfAlgorithm=a.prfAlgorithm||"sha1";var $,t,s,n=aa.random.getBytesSync(a.saltSize),C=a.count,o=ia.integerToDer(C);if(0===a.algorithm.indexOf("aes")||"des"===a.algorithm){var i,p,v;switch(a.algorithm){case"aes128":$=16,i=16,p=nb["aes128-CBC"],v=aa.aes.createEncryptionCipher;break;case"aes192":$=24,i=16,p=nb["aes192-CBC"],v=aa.aes.createEncryptionCipher;break;case"aes256":$=32,i=16,p=nb["aes256-CBC"],v=aa.aes.createEncryptionCipher;break;case"des":$=8,i=8,p=nb.desCBC,v=aa.des.createEncryptionCipher;break;default:throw(E=new Error("Cannot encrypt private key. Unknown encryption algorithm.")).algorithm=a.algorithm,E;}var D="hmacWith"+a.prfAlgorithm.toUpperCase(),c=Id(D),W=aa.pkcs5.pbkdf2(r,n,C,$,c),y=aa.random.getBytesSync(i);(l=v(W)).start(y),l.update(ia.toDer(e)),l.finish(),s=l.output.getBytes();var d=Zg(n,o,$,D);t=ia.create(ia.Class.UNIVERSAL,ia.Type.SEQUENCE,!0,[ia.create(ia.Class.UNIVERSAL,ia.Type.OID,!1,ia.oidToDer(nb.pkcs5PBES2).getBytes()),ia.create(ia.Class.UNIVERSAL,ia.Type.SEQUENCE,!0,[ia.create(ia.Class.UNIVERSAL,ia.Type.SEQUENCE,!0,[ia.create(ia.Class.UNIVERSAL,ia.Type.OID,!1,ia.oidToDer(nb.pkcs5PBKDF2).getBytes()),d]),ia.create(ia.Class.UNIVERSAL,ia.Type.SEQUENCE,!0,[ia.create(ia.Class.UNIVERSAL,ia.Type.OID,!1,ia.oidToDer(p).getBytes()),ia.create(ia.Class.UNIVERSAL,ia.Type.OCTETSTRING,!1,y)])])])}else{var E;if("3des"!==a.algorithm)throw(E=new Error("Cannot encrypt private key. Unknown encryption algorithm.")).algorithm=a.algorithm,E;$=24;var l,f=new aa.util.ByteBuffer(n);W=ra.pbe.generatePkcs12Key(r,f,1,C,$),y=ra.pbe.generatePkcs12Key(r,f,2,C,$);(l=aa.des.createEncryptionCipher(W)).start(y),l.update(ia.toDer(e)),l.finish(),s=l.output.getBytes(),t=ia.create(ia.Class.UNIVERSAL,ia.Type.SEQUENCE,!0,[ia.create(ia.Class.UNIVERSAL,ia.Type.OID,!1,ia.oidToDer(nb["pbeWithSHAAnd3-KeyTripleDES-CBC"]).getBytes()),ia.create(ia.Class.UNIVERSAL,ia.Type.SEQUENCE,!0,[ia.create(ia.Class.UNIVERSAL,ia.Type.OCTETSTRING,!1,n),ia.create(ia.Class.UNIVERSAL,ia.Type.INTEGER,!1,o.getBytes())])])}return ia.create(ia.Class.UNIVERSAL,ia.Type.SEQUENCE,!0,[t,ia.create(ia.Class.UNIVERSAL,ia.Type.OCTETSTRING,!1,s)])},ra.decryptPrivateKeyInfo=function(e,r){var a=null,$={},t=[];if(!ia.validate(e,Wg,$,t)){var s=new Error("Cannot read encrypted private key. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw s.errors=t,s}var n=ia.derToOid($.encryptionOid),C=ra.pbe.getCipher(n,$.encryptionParams,r),o=aa.util.createBuffer($.encryptedData);return C.update(o),C.finish()&&(a=ia.fromDer(C.output)),a},ra.encryptedPrivateKeyToPem=function(e,r){var a={type:"ENCRYPTED PRIVATE KEY",body:ia.toDer(e).getBytes()};return aa.pem.encode(a,{maxline:r})},ra.encryptedPrivateKeyFromPem=function(e){var r=aa.pem.decode(e)[0];if("ENCRYPTED PRIVATE KEY"!==r.type){var a=new Error("Could not convert encrypted private key from PEM; PEM header type is \"ENCRYPTED PRIVATE KEY\".");throw a.headerType=r.type,a}if(r.procType&&"ENCRYPTED"===r.procType.type)throw new Error("Could not convert encrypted private key from PEM; PEM is encrypted.");return ia.fromDer(r.body)},ra.encryptRsaPrivateKey=function(e,r,a){if(!(a=a||{}).legacy){var $=ra.wrapRsaPrivateKey(ra.privateKeyToAsn1(e));return $=ra.encryptPrivateKeyInfo($,r,a),ra.encryptedPrivateKeyToPem($)}var t,s,n,C;switch(a.algorithm){case"aes128":t="AES-128-CBC",n=16,s=aa.random.getBytesSync(16),C=aa.aes.createEncryptionCipher;break;case"aes192":t="AES-192-CBC",n=24,s=aa.random.getBytesSync(16),C=aa.aes.createEncryptionCipher;break;case"aes256":t="AES-256-CBC",n=32,s=aa.random.getBytesSync(16),C=aa.aes.createEncryptionCipher;break;case"3des":t="DES-EDE3-CBC",n=24,s=aa.random.getBytesSync(8),C=aa.des.createEncryptionCipher;break;case"des":t="DES-CBC",n=8,s=aa.random.getBytesSync(8),C=aa.des.createEncryptionCipher;break;default:var o=new Error("Could not encrypt RSA private key; unsupported encryption algorithm \""+a.algorithm+"\".");throw o.algorithm=a.algorithm,o;}var i=C(aa.pbe.opensslDeriveBytes(r,s.substr(0,8),n));i.start(s),i.update(ia.toDer(ra.privateKeyToAsn1(e))),i.finish();var p={type:"RSA PRIVATE KEY",procType:{version:"4",type:"ENCRYPTED"},dekInfo:{algorithm:t,parameters:aa.util.bytesToHex(s).toUpperCase()},body:i.output.getBytes()};return aa.pem.encode(p)},ra.decryptRsaPrivateKey=function(e,r){var a=null,$=aa.pem.decode(e)[0];if("ENCRYPTED PRIVATE KEY"!==$.type&&"PRIVATE KEY"!==$.type&&"RSA PRIVATE KEY"!==$.type)throw(n=new Error("Could not convert private key from PEM; PEM header type is not \"ENCRYPTED PRIVATE KEY\", \"PRIVATE KEY\", or \"RSA PRIVATE KEY\".")).headerType=n,n;if($.procType&&"ENCRYPTED"===$.procType.type){var t,s;switch($.dekInfo.algorithm){case"DES-CBC":t=8,s=aa.des.createDecryptionCipher;break;case"DES-EDE3-CBC":t=24,s=aa.des.createDecryptionCipher;break;case"AES-128-CBC":t=16,s=aa.aes.createDecryptionCipher;break;case"AES-192-CBC":t=24,s=aa.aes.createDecryptionCipher;break;case"AES-256-CBC":t=32,s=aa.aes.createDecryptionCipher;break;case"RC2-40-CBC":t=5,s=function(e){return aa.rc2.createDecryptionCipher(e,40)};break;case"RC2-64-CBC":t=8,s=function(e){return aa.rc2.createDecryptionCipher(e,64)};break;case"RC2-128-CBC":t=16,s=function(e){return aa.rc2.createDecryptionCipher(e,128)};break;default:var n;throw(n=new Error("Could not decrypt private key; unsupported encryption algorithm \""+$.dekInfo.algorithm+"\".")).algorithm=$.dekInfo.algorithm,n;}var C=aa.util.hexToBytes($.dekInfo.parameters),o=s(aa.pbe.opensslDeriveBytes(r,C.substr(0,8),t));if(o.start(C),o.update(aa.util.createBuffer($.body)),!o.finish())return a;a=o.output.getBytes()}else a=$.body;return null!==(a="ENCRYPTED PRIVATE KEY"===$.type?ra.decryptPrivateKeyInfo(ia.fromDer(a),r):ia.fromDer(a))&&(a=ra.privateKeyFromAsn1(a)),a},ra.pbe.generatePkcs12Key=function(e,r,a,$,t,s){var n,C;if(null==s){if(!("sha1"in aa.md))throw new Error("\"sha1\" hash algorithm unavailable.");s=aa.md.sha1.create()}var o=s.digestLength,i=s.blockLength,p=new aa.util.ByteBuffer,v=new aa.util.ByteBuffer;if(null!=e){for(C=0;C<e.length;C++)v.putInt16(e.charCodeAt(C));v.putInt16(0)}var D=v.length(),c=r.length(),W=new aa.util.ByteBuffer;W.fillWithByte(a,i);var y=i*Math.ceil(c/i),d=new aa.util.ByteBuffer;for(C=0;C<y;C++)d.putByte(r.at(C%c));var E=i*Math.ceil(D/i),l=new aa.util.ByteBuffer;for(C=0;C<E;C++)l.putByte(v.at(C%D));var f=d;f.putBuffer(l);for(var g=Math.ceil(t/o),u=1;u<=g;u++){var h=new aa.util.ByteBuffer;h.putBytes(W.bytes()),h.putBytes(f.bytes());for(var m=0;m<$;m++)s.start(),s.update(h.getBytes()),h=s.digest();var S=new aa.util.ByteBuffer;for(C=0;C<i;C++)S.putByte(h.at(C%o));var B=Math.ceil(c/i)+Math.ceil(D/i),A=new aa.util.ByteBuffer;for(n=0;n<B;n++){var T=new aa.util.ByteBuffer(f.getBytes(i)),k=511;for(C=S.length()-1;C>=0;C--)k>>=8,k+=S.at(C)+T.at(C),T.setAt(C,255&k);A.putBuffer(T)}f=A,p.putBuffer(h)}return p.truncate(p.length()-t),p},ra.pbe.getCipher=function(e,r,a){switch(e){case ra.oids.pkcs5PBES2:return ra.pbe.getCipherForPBES2(e,r,a);case ra.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:case ra.oids["pbewithSHAAnd40BitRC2-CBC"]:return ra.pbe.getCipherForPKCS12PBE(e,r,a);default:var $=new Error("Cannot read encrypted PBE data block. Unsupported OID.");throw $.oid=e,$.supportedOids=["pkcs5PBES2","pbeWithSHAAnd3-KeyTripleDES-CBC","pbewithSHAAnd40BitRC2-CBC"],$;}},ra.pbe.getCipherForPBES2=function(e,r,a){var $,t={},s=[];if(!ia.validate(r,Xg,t,s))throw($=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.")).errors=s,$;if((e=ia.derToOid(t.kdfOid))!==ra.oids.pkcs5PBKDF2)throw($=new Error("Cannot read encrypted private key. Unsupported key derivation function OID.")).oid=e,$.supportedOids=["pkcs5PBKDF2"],$;if((e=ia.derToOid(t.encOid))!==ra.oids["aes128-CBC"]&&e!==ra.oids["aes192-CBC"]&&e!==ra.oids["aes256-CBC"]&&e!==ra.oids["des-EDE3-CBC"]&&e!==ra.oids.desCBC)throw($=new Error("Cannot read encrypted private key. Unsupported encryption scheme OID.")).oid=e,$.supportedOids=["aes128-CBC","aes192-CBC","aes256-CBC","des-EDE3-CBC","desCBC"],$;var n,C,o=t.kdfSalt,i=aa.util.createBuffer(t.kdfIterationCount);switch(i=i.getInt(i.length()<<3),ra.oids[e]){case"aes128-CBC":n=16,C=aa.aes.createDecryptionCipher;break;case"aes192-CBC":n=24,C=aa.aes.createDecryptionCipher;break;case"aes256-CBC":n=32,C=aa.aes.createDecryptionCipher;break;case"des-EDE3-CBC":n=24,C=aa.des.createDecryptionCipher;break;case"desCBC":n=8,C=aa.des.createDecryptionCipher;}var p=Hd(t.prfOid),v=aa.pkcs5.pbkdf2(a,o,i,n,p),D=t.encIv,c=C(v);return c.start(D),c},ra.pbe.getCipherForPKCS12PBE=function(e,r,a){var $={},t=[];if(!ia.validate(r,Yg,$,t))throw(p=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.")).errors=t,p;var s,n,C,o=aa.util.createBuffer($.salt),i=aa.util.createBuffer($.iterations);switch(i=i.getInt(i.length()<<3),e){case ra.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:s=24,n=8,C=aa.des.startDecrypting;break;case ra.oids["pbewithSHAAnd40BitRC2-CBC"]:s=5,n=8,C=function(e,r){var a=aa.rc2.createDecryptionCipher(e,40);return a.start(r,null),a};break;default:var p;throw(p=new Error("Cannot read PKCS #12 PBE data block. Unsupported OID.")).oid=e,p;}var v=Hd($.prfOid),D=ra.pbe.generatePkcs12Key(a,o,1,i,s,v);return v.start(),C(D,ra.pbe.generatePkcs12Key(a,o,2,i,n,v))},ra.pbe.opensslDeriveBytes=function(e,r,a,$){if(null==$){if(!("md5"in aa.md))throw new Error("\"md5\" hash algorithm unavailable.");$=aa.md.md5.create()}null===r&&(r="");for(var t=[Gd($,e+r)],s=16,n=1;s<a;++n,s+=16)t.push(Gd($,t[n-1]+e+r));return t.join("").substr(0,a)};var na=aa.asn1,xb=aa.pkcs7asn1=aa.pkcs7asn1||{};aa.pkcs7=aa.pkcs7||{},aa.pkcs7.asn1=xb;var Jd={name:"ContentInfo",tagClass:na.Class.UNIVERSAL,type:na.Type.SEQUENCE,constructed:!0,value:[{name:"ContentInfo.ContentType",tagClass:na.Class.UNIVERSAL,type:na.Type.OID,constructed:!1,capture:"contentType"},{name:"ContentInfo.content",tagClass:na.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,captureAsn1:"content"}]};xb.contentInfoValidator=Jd;var Kd={name:"EncryptedContentInfo",tagClass:na.Class.UNIVERSAL,type:na.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedContentInfo.contentType",tagClass:na.Class.UNIVERSAL,type:na.Type.OID,constructed:!1,capture:"contentType"},{name:"EncryptedContentInfo.contentEncryptionAlgorithm",tagClass:na.Class.UNIVERSAL,type:na.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedContentInfo.contentEncryptionAlgorithm.algorithm",tagClass:na.Class.UNIVERSAL,type:na.Type.OID,constructed:!1,capture:"encAlgorithm"},{name:"EncryptedContentInfo.contentEncryptionAlgorithm.parameter",tagClass:na.Class.UNIVERSAL,captureAsn1:"encParameter"}]},{name:"EncryptedContentInfo.encryptedContent",tagClass:na.Class.CONTEXT_SPECIFIC,type:0,capture:"encryptedContent",captureAsn1:"encryptedContentAsn1"}]};xb.envelopedDataValidator={name:"EnvelopedData",tagClass:na.Class.UNIVERSAL,type:na.Type.SEQUENCE,constructed:!0,value:[{name:"EnvelopedData.Version",tagClass:na.Class.UNIVERSAL,type:na.Type.INTEGER,constructed:!1,capture:"version"},{name:"EnvelopedData.RecipientInfos",tagClass:na.Class.UNIVERSAL,type:na.Type.SET,constructed:!0,captureAsn1:"recipientInfos"}].concat(Kd)},xb.encryptedDataValidator={name:"EncryptedData",tagClass:na.Class.UNIVERSAL,type:na.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedData.Version",tagClass:na.Class.UNIVERSAL,type:na.Type.INTEGER,constructed:!1,capture:"version"}].concat(Kd)};var $g={name:"SignerInfo",tagClass:na.Class.UNIVERSAL,type:na.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.version",tagClass:na.Class.UNIVERSAL,type:na.Type.INTEGER,constructed:!1},{name:"SignerInfo.issuerAndSerialNumber",tagClass:na.Class.UNIVERSAL,type:na.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.issuerAndSerialNumber.issuer",tagClass:na.Class.UNIVERSAL,type:na.Type.SEQUENCE,constructed:!0,captureAsn1:"issuer"},{name:"SignerInfo.issuerAndSerialNumber.serialNumber",tagClass:na.Class.UNIVERSAL,type:na.Type.INTEGER,constructed:!1,capture:"serial"}]},{name:"SignerInfo.digestAlgorithm",tagClass:na.Class.UNIVERSAL,type:na.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.digestAlgorithm.algorithm",tagClass:na.Class.UNIVERSAL,type:na.Type.OID,constructed:!1,capture:"digestAlgorithm"},{name:"SignerInfo.digestAlgorithm.parameter",tagClass:na.Class.UNIVERSAL,constructed:!1,captureAsn1:"digestParameter",optional:!0}]},{name:"SignerInfo.authenticatedAttributes",tagClass:na.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"authenticatedAttributes"},{name:"SignerInfo.digestEncryptionAlgorithm",tagClass:na.Class.UNIVERSAL,type:na.Type.SEQUENCE,constructed:!0,capture:"signatureAlgorithm"},{name:"SignerInfo.encryptedDigest",tagClass:na.Class.UNIVERSAL,type:na.Type.OCTETSTRING,constructed:!1,capture:"signature"},{name:"SignerInfo.unauthenticatedAttributes",tagClass:na.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,capture:"unauthenticatedAttributes"}]};xb.signedDataValidator={name:"SignedData",tagClass:na.Class.UNIVERSAL,type:na.Type.SEQUENCE,constructed:!0,value:[{name:"SignedData.Version",tagClass:na.Class.UNIVERSAL,type:na.Type.INTEGER,constructed:!1,capture:"version"},{name:"SignedData.DigestAlgorithms",tagClass:na.Class.UNIVERSAL,type:na.Type.SET,constructed:!0,captureAsn1:"digestAlgorithms"},Jd,{name:"SignedData.Certificates",tagClass:na.Class.CONTEXT_SPECIFIC,type:0,optional:!0,captureAsn1:"certificates"},{name:"SignedData.CertificateRevocationLists",tagClass:na.Class.CONTEXT_SPECIFIC,type:1,optional:!0,captureAsn1:"crls"},{name:"SignedData.SignerInfos",tagClass:na.Class.UNIVERSAL,type:na.Type.SET,capture:"signerInfos",optional:!0,value:[$g]}]},xb.recipientInfoValidator={name:"RecipientInfo",tagClass:na.Class.UNIVERSAL,type:na.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.version",tagClass:na.Class.UNIVERSAL,type:na.Type.INTEGER,constructed:!1,capture:"version"},{name:"RecipientInfo.issuerAndSerial",tagClass:na.Class.UNIVERSAL,type:na.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.issuerAndSerial.issuer",tagClass:na.Class.UNIVERSAL,type:na.Type.SEQUENCE,constructed:!0,captureAsn1:"issuer"},{name:"RecipientInfo.issuerAndSerial.serialNumber",tagClass:na.Class.UNIVERSAL,type:na.Type.INTEGER,constructed:!1,capture:"serial"}]},{name:"RecipientInfo.keyEncryptionAlgorithm",tagClass:na.Class.UNIVERSAL,type:na.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.keyEncryptionAlgorithm.algorithm",tagClass:na.Class.UNIVERSAL,type:na.Type.OID,constructed:!1,capture:"encAlgorithm"},{name:"RecipientInfo.keyEncryptionAlgorithm.parameter",tagClass:na.Class.UNIVERSAL,constructed:!1,captureAsn1:"encParameter"}]},{name:"RecipientInfo.encryptedKey",tagClass:na.Class.UNIVERSAL,type:na.Type.OCTETSTRING,constructed:!1,capture:"encKey"}]};aa.mgf=aa.mgf||{};var _g=aa.mgf.mgf1=aa.mgf1=aa.mgf1||{};_g.create=function(r){return{generate:function(e,$){for(var t=new aa.util.ByteBuffer,v=Math.ceil($/r.digestLength),f=0;f<v;f++){var g=new aa.util.ByteBuffer;g.putInt32(f),r.start(),r.update(e+g.getBytes()),t.putBuffer(r.digest())}return t.truncate(t.length()-$),t.getBytes()}}};aa.mgf.mgf1=aa.mgf1;var ah=aa.pss=aa.pss||{};ah.create=function(e){3===arguments.length&&(e={md:arguments[0],mgf:arguments[1],saltLength:arguments[2]});var r,t=e.md,o=e.mgf,n=t.digestLength,a=e.salt||null;if("string"==typeof a&&(a=aa.util.createBuffer(a)),"saltLength"in e)r=e.saltLength;else{if(null===a)throw new Error("Salt length not specified or specific salt not given.");r=a.length()}if(null!==a&&a.length()!==r)throw new Error("Given salt length does not match length of given salt.");var s=e.prng||aa.random,i={encode:function(e,i){var u,f,c=i-1,g=Math.ceil(c/8),l=e.digest().getBytes();if(g<n+r+2)throw new Error("Message is too long to encrypt.");f=null===a?s.getBytesSync(r):a.bytes();var $=new aa.util.ByteBuffer;$.fillWithByte(0,8),$.putBytes(l),$.putBytes(f),t.start(),t.update($.getBytes());var h=t.digest().getBytes(),d=new aa.util.ByteBuffer;d.fillWithByte(0,g-r-n-2),d.putByte(1),d.putBytes(f);var v=d.getBytes(),y=g-n-1,p=o.generate(h,y),B="";for(u=0;u<y;u++)B+=String.fromCharCode(v.charCodeAt(u)^p.charCodeAt(u));var C=65280>>8*g-c&255;return(B=String.fromCharCode(B.charCodeAt(0)&~C)+B.substr(1))+h+String.fromCharCode(188)},verify:function(e,a,s){var i,u=s-1,f=Math.ceil(u/8);if(a=a.substr(-f),f<n+r+2)throw new Error("Inconsistent parameters to PSS signature verification.");if(188!==a.charCodeAt(f-1))throw new Error("Encoded message does not end in 0xBC.");var c=f-n-1,g=a.substr(0,c),l=a.substr(c,n),$=65280>>8*f-u&255;if(0!=(g.charCodeAt(0)&$))throw new Error("Bits beyond keysize not zero as expected.");var h=o.generate(l,c),d="";for(i=0;i<c;i++)d+=String.fromCharCode(g.charCodeAt(i)^h.charCodeAt(i));d=String.fromCharCode(d.charCodeAt(0)&~$)+d.substr(1);var v=f-n-r-2;for(i=0;i<v;i++)if(0!==d.charCodeAt(i))throw new Error("Leftmost octets not zero as expected");if(1!==d.charCodeAt(v))throw new Error("Inconsistent PSS signature, 0x01 marker not found");var y=d.substr(-r),p=new aa.util.ByteBuffer;return p.fillWithByte(0,8),p.putBytes(e),p.putBytes(y),t.start(),t.update(p.getBytes()),l===t.digest().getBytes()}};return i};var ba=aa.asn1,la=aa.pki=aa.pki||{},pa=la.oids,Aa={};Aa.CN=pa.commonName,Aa.commonName="CN",Aa.C=pa.countryName,Aa.countryName="C",Aa.L=pa.localityName,Aa.localityName="L",Aa.ST=pa.stateOrProvinceName,Aa.stateOrProvinceName="ST",Aa.O=pa.organizationName,Aa.organizationName="O",Aa.OU=pa.organizationalUnitName,Aa.organizationalUnitName="OU",Aa.E=pa.emailAddress,Aa.emailAddress="E";var Ld=aa.pki.rsa.publicKeyValidator,bh={name:"Certificate",tagClass:ba.Class.UNIVERSAL,type:ba.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate",tagClass:ba.Class.UNIVERSAL,type:ba.Type.SEQUENCE,constructed:!0,captureAsn1:"tbsCertificate",value:[{name:"Certificate.TBSCertificate.version",tagClass:ba.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.version.integer",tagClass:ba.Class.UNIVERSAL,type:ba.Type.INTEGER,constructed:!1,capture:"certVersion"}]},{name:"Certificate.TBSCertificate.serialNumber",tagClass:ba.Class.UNIVERSAL,type:ba.Type.INTEGER,constructed:!1,capture:"certSerialNumber"},{name:"Certificate.TBSCertificate.signature",tagClass:ba.Class.UNIVERSAL,type:ba.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.signature.algorithm",tagClass:ba.Class.UNIVERSAL,type:ba.Type.OID,constructed:!1,capture:"certinfoSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:ba.Class.UNIVERSAL,optional:!0,captureAsn1:"certinfoSignatureParams"}]},{name:"Certificate.TBSCertificate.issuer",tagClass:ba.Class.UNIVERSAL,type:ba.Type.SEQUENCE,constructed:!0,captureAsn1:"certIssuer"},{name:"Certificate.TBSCertificate.validity",tagClass:ba.Class.UNIVERSAL,type:ba.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.validity.notBefore (utc)",tagClass:ba.Class.UNIVERSAL,type:ba.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity1UTCTime"},{name:"Certificate.TBSCertificate.validity.notBefore (generalized)",tagClass:ba.Class.UNIVERSAL,type:ba.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity2GeneralizedTime"},{name:"Certificate.TBSCertificate.validity.notAfter (utc)",tagClass:ba.Class.UNIVERSAL,type:ba.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity3UTCTime"},{name:"Certificate.TBSCertificate.validity.notAfter (generalized)",tagClass:ba.Class.UNIVERSAL,type:ba.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity4GeneralizedTime"}]},{name:"Certificate.TBSCertificate.subject",tagClass:ba.Class.UNIVERSAL,type:ba.Type.SEQUENCE,constructed:!0,captureAsn1:"certSubject"},Ld,{name:"Certificate.TBSCertificate.issuerUniqueID",tagClass:ba.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.issuerUniqueID.id",tagClass:ba.Class.UNIVERSAL,type:ba.Type.BITSTRING,constructed:!1,captureBitStringValue:"certIssuerUniqueId"}]},{name:"Certificate.TBSCertificate.subjectUniqueID",tagClass:ba.Class.CONTEXT_SPECIFIC,type:2,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.subjectUniqueID.id",tagClass:ba.Class.UNIVERSAL,type:ba.Type.BITSTRING,constructed:!1,captureBitStringValue:"certSubjectUniqueId"}]},{name:"Certificate.TBSCertificate.extensions",tagClass:ba.Class.CONTEXT_SPECIFIC,type:3,constructed:!0,captureAsn1:"certExtensions",optional:!0}]},{name:"Certificate.signatureAlgorithm",tagClass:ba.Class.UNIVERSAL,type:ba.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.signatureAlgorithm.algorithm",tagClass:ba.Class.UNIVERSAL,type:ba.Type.OID,constructed:!1,capture:"certSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:ba.Class.UNIVERSAL,optional:!0,captureAsn1:"certSignatureParams"}]},{name:"Certificate.signatureValue",tagClass:ba.Class.UNIVERSAL,type:ba.Type.BITSTRING,constructed:!1,captureBitStringValue:"certSignature"}]},ch={name:"rsapss",tagClass:ba.Class.UNIVERSAL,type:ba.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.hashAlgorithm",tagClass:ba.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier",tagClass:ba.Class.UNIVERSAL,type:ba.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier.algorithm",tagClass:ba.Class.UNIVERSAL,type:ba.Type.OID,constructed:!1,capture:"hashOid"}]}]},{name:"rsapss.maskGenAlgorithm",tagClass:ba.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier",tagClass:ba.Class.UNIVERSAL,type:ba.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.algorithm",tagClass:ba.Class.UNIVERSAL,type:ba.Type.OID,constructed:!1,capture:"maskGenOid"},{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params",tagClass:ba.Class.UNIVERSAL,type:ba.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params.algorithm",tagClass:ba.Class.UNIVERSAL,type:ba.Type.OID,constructed:!1,capture:"maskGenHashOid"}]}]}]},{name:"rsapss.saltLength",tagClass:ba.Class.CONTEXT_SPECIFIC,type:2,optional:!0,value:[{name:"rsapss.saltLength.saltLength",tagClass:ba.Class.UNIVERSAL,type:ba.Class.INTEGER,constructed:!1,capture:"saltLength"}]},{name:"rsapss.trailerField",tagClass:ba.Class.CONTEXT_SPECIFIC,type:3,optional:!0,value:[{name:"rsapss.trailer.trailer",tagClass:ba.Class.UNIVERSAL,type:ba.Class.INTEGER,constructed:!1,capture:"trailer"}]}]},dh={name:"CertificationRequestInfo",tagClass:ba.Class.UNIVERSAL,type:ba.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfo",value:[{name:"CertificationRequestInfo.integer",tagClass:ba.Class.UNIVERSAL,type:ba.Type.INTEGER,constructed:!1,capture:"certificationRequestInfoVersion"},{name:"CertificationRequestInfo.subject",tagClass:ba.Class.UNIVERSAL,type:ba.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfoSubject"},Ld,{name:"CertificationRequestInfo.attributes",tagClass:ba.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"certificationRequestInfoAttributes",value:[{name:"CertificationRequestInfo.attributes",tagClass:ba.Class.UNIVERSAL,type:ba.Type.SEQUENCE,constructed:!0,value:[{name:"CertificationRequestInfo.attributes.type",tagClass:ba.Class.UNIVERSAL,type:ba.Type.OID,constructed:!1},{name:"CertificationRequestInfo.attributes.value",tagClass:ba.Class.UNIVERSAL,type:ba.Type.SET,constructed:!0}]}]}]},eh={name:"CertificationRequest",tagClass:ba.Class.UNIVERSAL,type:ba.Type.SEQUENCE,constructed:!0,captureAsn1:"csr",value:[dh,{name:"CertificationRequest.signatureAlgorithm",tagClass:ba.Class.UNIVERSAL,type:ba.Type.SEQUENCE,constructed:!0,value:[{name:"CertificationRequest.signatureAlgorithm.algorithm",tagClass:ba.Class.UNIVERSAL,type:ba.Type.OID,constructed:!1,capture:"csrSignatureOid"},{name:"CertificationRequest.signatureAlgorithm.parameters",tagClass:ba.Class.UNIVERSAL,optional:!0,captureAsn1:"csrSignatureParams"}]},{name:"CertificationRequest.signature",tagClass:ba.Class.UNIVERSAL,type:ba.Type.BITSTRING,constructed:!1,captureBitStringValue:"csrSignature"}]};function gb(e,a){"string"==typeof a&&(a={shortName:a});for(var r,t=null,s=0;null===t&&s<e.attributes.length;++s)r=e.attributes[s],a.type&&a.type===r.type?t=r:a.name&&a.name===r.name?t=r:a.shortName&&a.shortName===r.shortName&&(t=r);return t}la.RDNAttributesAsArray=function(e,a){for(var r,t,s,$=[],i=0;i<e.value.length;++i){r=e.value[i];for(var n=0;n<r.value.length;++n)s={},t=r.value[n],s.type=ba.derToOid(t.value[0].value),s.value=t.value[1].value,s.valueTagClass=t.value[1].type,s.type in pa&&(s.name=pa[s.type],s.name in Aa&&(s.shortName=Aa[s.name])),a&&(a.update(s.type),a.update(s.value)),$.push(s)}return $},la.CRIAttributesAsArray=function(e){for(var a=[],r=0;r<e.length;++r)for(var t=e[r],s=ba.derToOid(t.value[0].value),$=t.value[1].value,i=0;i<$.length;++i){var n={};if(n.type=s,n.value=$[i].value,n.valueTagClass=$[i].type,n.type in pa&&(n.name=pa[n.type],n.name in Aa&&(n.shortName=Aa[n.name])),n.type===pa.extensionRequest){n.extensions=[];for(var C=0;C<n.value.length;++C)n.extensions.push(la.certificateExtensionFromAsn1(n.value[C]))}a.push(n)}return a};var cc=function(e,a,r){var t={};if(e!==pa["RSASSA-PSS"])return t;r&&(t={hash:{algorithmOid:pa.sha1},mgf:{algorithmOid:pa.mgf1,hash:{algorithmOid:pa.sha1}},saltLength:20});var s={},$=[];if(!ba.validate(a,ch,s,$)){var i=new Error("Cannot read RSASSA-PSS parameter block.");throw i.errors=$,i}return void 0!==s.hashOid&&(t.hash=t.hash||{},t.hash.algorithmOid=ba.derToOid(s.hashOid)),void 0!==s.maskGenOid&&(t.mgf=t.mgf||{},t.mgf.algorithmOid=ba.derToOid(s.maskGenOid),t.mgf.hash=t.mgf.hash||{},t.mgf.hash.algorithmOid=ba.derToOid(s.maskGenHashOid)),void 0!==s.saltLength&&(t.saltLength=s.saltLength.charCodeAt(0)),t};function yb(e){for(var a,r,t=ba.create(ba.Class.UNIVERSAL,ba.Type.SEQUENCE,!0,[]),s=e.attributes,$=0;$<s.length;++$){var i=(a=s[$]).value,n=ba.Type.PRINTABLESTRING;"valueTagClass"in a&&(n=a.valueTagClass)===ba.Type.UTF8&&(i=aa.util.encodeUtf8(i)),r=ba.create(ba.Class.UNIVERSAL,ba.Type.SET,!0,[ba.create(ba.Class.UNIVERSAL,ba.Type.SEQUENCE,!0,[ba.create(ba.Class.UNIVERSAL,ba.Type.OID,!1,ba.oidToDer(a.type).getBytes()),ba.create(ba.Class.UNIVERSAL,n,!1,i)])]),t.value.push(r)}return t}function Pa(e){for(var a,r=0;r<e.length;++r){if(void 0===(a=e[r]).name&&(a.type&&a.type in la.oids?a.name=la.oids[a.type]:a.shortName&&a.shortName in Aa&&(a.name=la.oids[Aa[a.shortName]])),void 0===a.type){if(!(a.name&&a.name in la.oids))throw(s=new Error("Attribute type not specified.")).attribute=a,s;a.type=la.oids[a.name]}if(void 0===a.shortName&&a.name&&a.name in Aa&&(a.shortName=Aa[a.name]),a.type===pa.extensionRequest&&(a.valueConstructed=!0,a.valueTagClass=ba.Type.SEQUENCE,!a.value&&a.extensions)){a.value=[];for(var t=0;t<a.extensions.length;++t)a.value.push(la.certificateExtensionToAsn1(Md(a.extensions[t])))}var s;if(void 0===a.value)throw(s=new Error("Attribute value not specified.")).attribute=a,s}}function Md(e,a){if(a=a||{},void 0===e.name&&e.id&&e.id in la.oids&&(e.name=la.oids[e.id]),void 0===e.id){if(!(e.name&&e.name in la.oids))throw(H=new Error("Extension ID not specified.")).extension=e,H;e.id=la.oids[e.name]}if(void 0!==e.value)return e;if("keyUsage"===e.name){var r=0,t=0,s=0;e.digitalSignature&&(t|=128,r=7),e.nonRepudiation&&(t|=64,r=6),e.keyEncipherment&&(t|=32,r=5),e.dataEncipherment&&(t|=16,r=4),e.keyAgreement&&(t|=8,r=3),e.keyCertSign&&(t|=4,r=2),e.cRLSign&&(t|=2,r=1),e.encipherOnly&&(t|=1,r=0),e.decipherOnly&&(s|=128,r=7);var $=String.fromCharCode(r);0!==s?$+=String.fromCharCode(t)+String.fromCharCode(s):0!==t&&($+=String.fromCharCode(t)),e.value=ba.create(ba.Class.UNIVERSAL,ba.Type.BITSTRING,!1,$)}else if("basicConstraints"===e.name)e.value=ba.create(ba.Class.UNIVERSAL,ba.Type.SEQUENCE,!0,[]),e.cA&&e.value.value.push(ba.create(ba.Class.UNIVERSAL,ba.Type.BOOLEAN,!1,String.fromCharCode(255))),"pathLenConstraint"in e&&e.value.value.push(ba.create(ba.Class.UNIVERSAL,ba.Type.INTEGER,!1,ba.integerToDer(e.pathLenConstraint).getBytes()));else if("extKeyUsage"===e.name){e.value=ba.create(ba.Class.UNIVERSAL,ba.Type.SEQUENCE,!0,[]);var i=e.value.value;for(var n in e)!0===e[n]&&(n in pa?i.push(ba.create(ba.Class.UNIVERSAL,ba.Type.OID,!1,ba.oidToDer(pa[n]).getBytes())):-1!==n.indexOf(".")&&i.push(ba.create(ba.Class.UNIVERSAL,ba.Type.OID,!1,ba.oidToDer(n).getBytes())))}else if("nsCertType"===e.name){r=0,t=0;e.client&&(t|=128,r=7),e.server&&(t|=64,r=6),e.email&&(t|=32,r=5),e.objsign&&(t|=16,r=4),e.reserved&&(t|=8,r=3),e.sslCA&&(t|=4,r=2),e.emailCA&&(t|=2,r=1),e.objCA&&(t|=1,r=0);$=String.fromCharCode(r);0!==t&&($+=String.fromCharCode(t)),e.value=ba.create(ba.Class.UNIVERSAL,ba.Type.BITSTRING,!1,$)}else if("subjectAltName"===e.name||"issuerAltName"===e.name){e.value=ba.create(ba.Class.UNIVERSAL,ba.Type.SEQUENCE,!0,[]);for(var C=0;C<e.altNames.length;++C){$=(l=e.altNames[C]).value;if(7===l.type&&l.ip){if(null===($=aa.util.bytesFromIP(l.ip)))throw(H=new Error("Extension \"ip\" value is not a valid IPv4 or IPv6 address.")).extension=e,H}else 8===l.type&&($=l.oid?ba.oidToDer(ba.oidToDer(l.oid)):ba.oidToDer($));e.value.value.push(ba.create(ba.Class.CONTEXT_SPECIFIC,l.type,!1,$))}}else if("nsComment"===e.name&&a.cert){if(!/^[\x00-\x7F]*$/.test(e.comment)||e.comment.length<1||e.comment.length>128)throw new Error("Invalid \"nsComment\" content.");e.value=ba.create(ba.Class.UNIVERSAL,ba.Type.IA5STRING,!1,e.comment)}else if("subjectKeyIdentifier"===e.name&&a.cert){var o=a.cert.generateSubjectKeyIdentifier();e.subjectKeyIdentifier=o.toHex(),e.value=ba.create(ba.Class.UNIVERSAL,ba.Type.OCTETSTRING,!1,o.getBytes())}else if("authorityKeyIdentifier"===e.name&&a.cert){e.value=ba.create(ba.Class.UNIVERSAL,ba.Type.SEQUENCE,!0,[]);i=e.value.value;if(e.keyIdentifier){var v=!0===e.keyIdentifier?a.cert.generateSubjectKeyIdentifier().getBytes():e.keyIdentifier;i.push(ba.create(ba.Class.CONTEXT_SPECIFIC,0,!1,v))}if(e.authorityCertIssuer){var u=[ba.create(ba.Class.CONTEXT_SPECIFIC,4,!0,[yb(!0===e.authorityCertIssuer?a.cert.issuer:e.authorityCertIssuer)])];i.push(ba.create(ba.Class.CONTEXT_SPECIFIC,1,!0,u))}if(e.serialNumber){var c=aa.util.hexToBytes(!0===e.serialNumber?a.cert.serialNumber:e.serialNumber);i.push(ba.create(ba.Class.CONTEXT_SPECIFIC,2,!1,c))}}else if("cRLDistributionPoints"===e.name){e.value=ba.create(ba.Class.UNIVERSAL,ba.Type.SEQUENCE,!0,[]);i=e.value.value;var l,G=ba.create(ba.Class.UNIVERSAL,ba.Type.SEQUENCE,!0,[]),d=ba.create(ba.Class.CONTEXT_SPECIFIC,0,!0,[]);for(C=0;C<e.altNames.length;++C){$=(l=e.altNames[C]).value;if(7===l.type&&l.ip){if(null===($=aa.util.bytesFromIP(l.ip)))throw(H=new Error("Extension \"ip\" value is not a valid IPv4 or IPv6 address.")).extension=e,H}else 8===l.type&&($=l.oid?ba.oidToDer(ba.oidToDer(l.oid)):ba.oidToDer($));d.value.push(ba.create(ba.Class.CONTEXT_SPECIFIC,l.type,!1,$))}G.value.push(ba.create(ba.Class.CONTEXT_SPECIFIC,0,!0,[d])),i.push(G)}var H;if(void 0===e.value)throw(H=new Error("Extension value not specified.")).extension=e,H;return e}function Cc(e,a){switch(e){case pa["RSASSA-PSS"]:var r=[];return void 0!==a.hash.algorithmOid&&r.push(ba.create(ba.Class.CONTEXT_SPECIFIC,0,!0,[ba.create(ba.Class.UNIVERSAL,ba.Type.SEQUENCE,!0,[ba.create(ba.Class.UNIVERSAL,ba.Type.OID,!1,ba.oidToDer(a.hash.algorithmOid).getBytes()),ba.create(ba.Class.UNIVERSAL,ba.Type.NULL,!1,"")])])),void 0!==a.mgf.algorithmOid&&r.push(ba.create(ba.Class.CONTEXT_SPECIFIC,1,!0,[ba.create(ba.Class.UNIVERSAL,ba.Type.SEQUENCE,!0,[ba.create(ba.Class.UNIVERSAL,ba.Type.OID,!1,ba.oidToDer(a.mgf.algorithmOid).getBytes()),ba.create(ba.Class.UNIVERSAL,ba.Type.SEQUENCE,!0,[ba.create(ba.Class.UNIVERSAL,ba.Type.OID,!1,ba.oidToDer(a.mgf.hash.algorithmOid).getBytes()),ba.create(ba.Class.UNIVERSAL,ba.Type.NULL,!1,"")])])])),void 0!==a.saltLength&&r.push(ba.create(ba.Class.CONTEXT_SPECIFIC,2,!0,[ba.create(ba.Class.UNIVERSAL,ba.Type.INTEGER,!1,ba.integerToDer(a.saltLength).getBytes())])),ba.create(ba.Class.UNIVERSAL,ba.Type.SEQUENCE,!0,r);default:return ba.create(ba.Class.UNIVERSAL,ba.Type.NULL,!1,"");}}function fh(e){var a=ba.create(ba.Class.CONTEXT_SPECIFIC,0,!0,[]);if(0===e.attributes.length)return a;for(var r=e.attributes,t=0;t<r.length;++t){var s=r[t],$=s.value,i=ba.Type.UTF8;"valueTagClass"in s&&(i=s.valueTagClass),i===ba.Type.UTF8&&($=aa.util.encodeUtf8($));var n=!1;"valueConstructed"in s&&(n=s.valueConstructed);var C=ba.create(ba.Class.UNIVERSAL,ba.Type.SEQUENCE,!0,[ba.create(ba.Class.UNIVERSAL,ba.Type.OID,!1,ba.oidToDer(s.type).getBytes()),ba.create(ba.Class.UNIVERSAL,ba.Type.SET,!0,[ba.create(ba.Class.UNIVERSAL,i,n,$)])]);a.value.push(C)}return a}la.certificateFromPem=function(e,a,r){var t=aa.pem.decode(e)[0];if("CERTIFICATE"!==t.type&&"X509 CERTIFICATE"!==t.type&&"TRUSTED CERTIFICATE"!==t.type){var s=new Error("Could not convert certificate from PEM; PEM header type is not \"CERTIFICATE\", \"X509 CERTIFICATE\", or \"TRUSTED CERTIFICATE\".");throw s.headerType=t.type,s}if(t.procType&&"ENCRYPTED"===t.procType.type)throw new Error("Could not convert certificate from PEM; PEM is encrypted.");var $=ba.fromDer(t.body,r);return la.certificateFromAsn1($,a)},la.certificateToPem=function(e,a){var r={type:"CERTIFICATE",body:ba.toDer(la.certificateToAsn1(e)).getBytes()};return aa.pem.encode(r,{maxline:a})},la.publicKeyFromPem=function(e){var a=aa.pem.decode(e)[0];if("PUBLIC KEY"!==a.type&&"RSA PUBLIC KEY"!==a.type){var r=new Error("Could not convert public key from PEM; PEM header type is not \"PUBLIC KEY\" or \"RSA PUBLIC KEY\".");throw r.headerType=a.type,r}if(a.procType&&"ENCRYPTED"===a.procType.type)throw new Error("Could not convert public key from PEM; PEM is encrypted.");var t=ba.fromDer(a.body);return la.publicKeyFromAsn1(t)},la.publicKeyToPem=function(e,a){var r={type:"PUBLIC KEY",body:ba.toDer(la.publicKeyToAsn1(e)).getBytes()};return aa.pem.encode(r,{maxline:a})},la.publicKeyToRSAPublicKeyPem=function(e,a){var r={type:"RSA PUBLIC KEY",body:ba.toDer(la.publicKeyToRSAPublicKey(e)).getBytes()};return aa.pem.encode(r,{maxline:a})},la.getPublicKeyFingerprint=function(e,a){var r,t=(a=a||{}).md||aa.md.sha1.create();switch(a.type||"RSAPublicKey"){case"RSAPublicKey":r=ba.toDer(la.publicKeyToRSAPublicKey(e)).getBytes();break;case"SubjectPublicKeyInfo":r=ba.toDer(la.publicKeyToAsn1(e)).getBytes();break;default:throw new Error("Unknown fingerprint type \""+a.type+"\".");}t.start(),t.update(r);var s=t.digest();if("hex"===a.encoding){var $=s.toHex();return a.delimiter?$.match(/.{2}/g).join(a.delimiter):$}if("binary"===a.encoding)return s.getBytes();if(a.encoding)throw new Error("Unknown encoding \""+a.encoding+"\".");return s},la.certificationRequestFromPem=function(e,a,r){var t=aa.pem.decode(e)[0];if("CERTIFICATE REQUEST"!==t.type){var s=new Error("Could not convert certification request from PEM; PEM header type is not \"CERTIFICATE REQUEST\".");throw s.headerType=t.type,s}if(t.procType&&"ENCRYPTED"===t.procType.type)throw new Error("Could not convert certification request from PEM; PEM is encrypted.");var $=ba.fromDer(t.body,r);return la.certificationRequestFromAsn1($,a)},la.certificationRequestToPem=function(e,a){var r={type:"CERTIFICATE REQUEST",body:ba.toDer(la.certificationRequestToAsn1(e)).getBytes()};return aa.pem.encode(r,{maxline:a})},la.createCertificate=function(){var e={version:2,serialNumber:"00",signatureOid:null,signature:null,siginfo:{}};return e.siginfo.algorithmOid=null,e.validity={},e.validity.notBefore=new Date,e.validity.notAfter=new Date,e.issuer={},e.issuer.getField=function(a){return gb(e.issuer,a)},e.issuer.addField=function(a){Pa([a]),e.issuer.attributes.push(a)},e.issuer.attributes=[],e.issuer.hash=null,e.subject={},e.subject.getField=function(a){return gb(e.subject,a)},e.subject.addField=function(a){Pa([a]),e.subject.attributes.push(a)},e.subject.attributes=[],e.subject.hash=null,e.extensions=[],e.publicKey=null,e.md=null,e.setSubject=function(a,r){Pa(a),e.subject.attributes=a,delete e.subject.uniqueId,r&&(e.subject.uniqueId=r),e.subject.hash=null},e.setIssuer=function(a,r){Pa(a),e.issuer.attributes=a,delete e.issuer.uniqueId,r&&(e.issuer.uniqueId=r),e.issuer.hash=null},e.setExtensions=function(a){for(var r=0;r<a.length;++r)Md(a[r],{cert:e});e.extensions=a},e.getExtension=function(a){"string"==typeof a&&(a={name:a});for(var r,t=null,s=0;null===t&&s<e.extensions.length;++s)r=e.extensions[s],a.id&&r.id===a.id?t=r:a.name&&r.name===a.name&&(t=r);return t},e.sign=function(a,r){e.md=r||aa.md.sha1.create();var t=pa[e.md.algorithm+"WithRSAEncryption"];if(!t){var s=new Error("Could not compute certificate digest. Unknown message digest algorithm OID.");throw s.algorithm=e.md.algorithm,s}e.signatureOid=e.siginfo.algorithmOid=t,e.tbsCertificate=la.getTBSCertificate(e);var $=ba.toDer(e.tbsCertificate);e.md.update($.getBytes()),e.signature=a.sign(e.md)},e.verify=function(a){var r=!1;if(!e.issued(a)){var t=a.issuer,s=e.subject;throw(u=new Error("The parent certificate did not issue the given child certificate; the child certificate's issuer does not match the parent's subject.")).expectedIssuer=t.attributes,u.actualIssuer=s.attributes,u}var $=a.md;if(null===$){if(a.signatureOid in pa)switch(pa[a.signatureOid]){case"sha1WithRSAEncryption":$=aa.md.sha1.create();break;case"md5WithRSAEncryption":$=aa.md.md5.create();break;case"sha256WithRSAEncryption":$=aa.md.sha256.create();break;case"sha384WithRSAEncryption":$=aa.md.sha384.create();break;case"sha512WithRSAEncryption":$=aa.md.sha512.create();break;case"RSASSA-PSS":$=aa.md.sha256.create();}if(null===$)throw(u=new Error("Could not compute certificate digest. Unknown signature OID.")).signatureOid=a.signatureOid,u;var i=a.tbsCertificate||la.getTBSCertificate(a),n=ba.toDer(i);$.update(n.getBytes())}if(null!==$){var C;switch(a.signatureOid){case pa.sha1WithRSAEncryption:C=void 0;break;case pa["RSASSA-PSS"]:var o,v,u;if(void 0===(o=pa[a.signatureParameters.mgf.hash.algorithmOid])||void 0===aa.md[o])throw(u=new Error("Unsupported MGF hash function.")).oid=a.signatureParameters.mgf.hash.algorithmOid,u.name=o,u;if(void 0===(v=pa[a.signatureParameters.mgf.algorithmOid])||void 0===aa.mgf[v])throw(u=new Error("Unsupported MGF function.")).oid=a.signatureParameters.mgf.algorithmOid,u.name=v,u;if(v=aa.mgf[v].create(aa.md[o].create()),void 0===(o=pa[a.signatureParameters.hash.algorithmOid])||void 0===aa.md[o])throw{message:"Unsupported RSASSA-PSS hash function.",oid:a.signatureParameters.hash.algorithmOid,name:o};C=aa.pss.create(aa.md[o].create(),v,a.signatureParameters.saltLength);}r=e.publicKey.verify($.digest().getBytes(),a.signature,C)}return r},e.isIssuer=function(a){var r=!1,t=e.issuer,s=a.subject;if(t.hash&&s.hash)r=t.hash===s.hash;else if(t.attributes.length===s.attributes.length){var $,i;r=!0;for(var n=0;r&&n<t.attributes.length;++n)$=t.attributes[n],i=s.attributes[n],$.type===i.type&&$.value===i.value||(r=!1)}return r},e.issued=function(a){return a.isIssuer(e)},e.generateSubjectKeyIdentifier=function(){return la.getPublicKeyFingerprint(e.publicKey,{type:"RSAPublicKey"})},e.verifySubjectKeyIdentifier=function(){for(var a=pa.subjectKeyIdentifier,r=0;r<e.extensions.length;++r){var t=e.extensions[r];if(t.id===a){var s=e.generateSubjectKeyIdentifier().getBytes();return aa.util.hexToBytes(t.subjectKeyIdentifier)===s}}return!1},e},la.certificateFromAsn1=function(e,a){var r={},t=[];if(!ba.validate(e,bh,r,t))throw(n=new Error("Cannot read X.509 certificate. ASN.1 object is not an X509v3 Certificate.")).errors=t,n;if(ba.derToOid(r.publicKeyOid)!==la.oids.rsaEncryption)throw new Error("Cannot read public key. OID is not RSA.");var s=la.createCertificate();s.version=r.certVersion?r.certVersion.charCodeAt(0):0;var $=aa.util.createBuffer(r.certSerialNumber);s.serialNumber=$.toHex(),s.signatureOid=aa.asn1.derToOid(r.certSignatureOid),s.signatureParameters=cc(s.signatureOid,r.certSignatureParams,!0),s.siginfo.algorithmOid=aa.asn1.derToOid(r.certinfoSignatureOid),s.siginfo.parameters=cc(s.siginfo.algorithmOid,r.certinfoSignatureParams,!1),s.signature=r.certSignature;var i=[];if(void 0!==r.certValidity1UTCTime&&i.push(ba.utcTimeToDate(r.certValidity1UTCTime)),void 0!==r.certValidity2GeneralizedTime&&i.push(ba.generalizedTimeToDate(r.certValidity2GeneralizedTime)),void 0!==r.certValidity3UTCTime&&i.push(ba.utcTimeToDate(r.certValidity3UTCTime)),void 0!==r.certValidity4GeneralizedTime&&i.push(ba.generalizedTimeToDate(r.certValidity4GeneralizedTime)),i.length>2)throw new Error("Cannot read notBefore/notAfter validity times; more than two times were provided in the certificate.");if(i.length<2)throw new Error("Cannot read notBefore/notAfter validity times; they were not provided as either UTCTime or GeneralizedTime.");if(s.validity.notBefore=i[0],s.validity.notAfter=i[1],s.tbsCertificate=r.tbsCertificate,a){var n;if(s.md=null,s.signatureOid in pa)switch(pa[s.signatureOid]){case"sha1WithRSAEncryption":s.md=aa.md.sha1.create();break;case"md5WithRSAEncryption":s.md=aa.md.md5.create();break;case"sha256WithRSAEncryption":s.md=aa.md.sha256.create();break;case"sha384WithRSAEncryption":s.md=aa.md.sha384.create();break;case"sha512WithRSAEncryption":s.md=aa.md.sha512.create();break;case"RSASSA-PSS":s.md=aa.md.sha256.create();}if(null===s.md)throw(n=new Error("Could not compute certificate digest. Unknown signature OID.")).signatureOid=s.signatureOid,n;var C=ba.toDer(s.tbsCertificate);s.md.update(C.getBytes())}var o=aa.md.sha1.create();s.issuer.getField=function(e){return gb(s.issuer,e)},s.issuer.addField=function(e){Pa([e]),s.issuer.attributes.push(e)},s.issuer.attributes=la.RDNAttributesAsArray(r.certIssuer,o),r.certIssuerUniqueId&&(s.issuer.uniqueId=r.certIssuerUniqueId),s.issuer.hash=o.digest().toHex();var v=aa.md.sha1.create();return s.subject.getField=function(e){return gb(s.subject,e)},s.subject.addField=function(e){Pa([e]),s.subject.attributes.push(e)},s.subject.attributes=la.RDNAttributesAsArray(r.certSubject,v),r.certSubjectUniqueId&&(s.subject.uniqueId=r.certSubjectUniqueId),s.subject.hash=v.digest().toHex(),r.certExtensions?s.extensions=la.certificateExtensionsFromAsn1(r.certExtensions):s.extensions=[],s.publicKey=la.publicKeyFromAsn1(r.subjectPublicKeyInfo),s},la.certificateExtensionsFromAsn1=function(e){for(var a=[],r=0;r<e.value.length;++r)for(var t=e.value[r],s=0;s<t.value.length;++s)a.push(la.certificateExtensionFromAsn1(t.value[s]));return a},la.certificateExtensionFromAsn1=function(e){var a={};if(a.id=ba.derToOid(e.value[0].value),a.critical=!1,e.value[1].type===ba.Type.BOOLEAN?(a.critical=0!==e.value[1].value.charCodeAt(0),a.value=e.value[2].value):a.value=e.value[1].value,a.id in pa)if(a.name=pa[a.id],"keyUsage"===a.name){var r=0,t=0;($=ba.fromDer(a.value)).value.length>1&&(r=$.value.charCodeAt(1),t=$.value.length>2?$.value.charCodeAt(2):0),a.digitalSignature=128==(128&r),a.nonRepudiation=64==(64&r),a.keyEncipherment=32==(32&r),a.dataEncipherment=16==(16&r),a.keyAgreement=8==(8&r),a.keyCertSign=4==(4&r),a.cRLSign=2==(2&r),a.encipherOnly=1==(1&r),a.decipherOnly=128==(128&t)}else if("basicConstraints"===a.name){($=ba.fromDer(a.value)).value.length>0&&$.value[0].type===ba.Type.BOOLEAN?a.cA=0!==$.value[0].value.charCodeAt(0):a.cA=!1;var s=null;$.value.length>0&&$.value[0].type===ba.Type.INTEGER?s=$.value[0].value:$.value.length>1&&(s=$.value[1].value),null!==s&&(a.pathLenConstraint=ba.derToInteger(s))}else if("extKeyUsage"===a.name)for(var $=ba.fromDer(a.value),i=0;i<$.value.length;++i){var n=ba.derToOid($.value[i].value);n in pa?a[pa[n]]=!0:a[n]=!0}else if("nsCertType"===a.name){r=0;($=ba.fromDer(a.value)).value.length>1&&(r=$.value.charCodeAt(1)),a.client=128==(128&r),a.server=64==(64&r),a.email=32==(32&r),a.objsign=16==(16&r),a.reserved=8==(8&r),a.sslCA=4==(4&r),a.emailCA=2==(2&r),a.objCA=1==(1&r)}else if("subjectAltName"===a.name||"issuerAltName"===a.name){var C;a.altNames=[];$=ba.fromDer(a.value);for(var o=0;o<$.value.length;++o){var v={type:(C=$.value[o]).type,value:C.value};switch(a.altNames.push(v),C.type){case 1:case 2:case 6:break;case 7:v.ip=aa.util.bytesToIP(C.value);break;case 8:v.oid=ba.derToOid(C.value);}}}else if("subjectKeyIdentifier"===a.name){$=ba.fromDer(a.value);a.subjectKeyIdentifier=aa.util.bytesToHex($.value)}return a},la.certificationRequestFromAsn1=function(e,a){var r={},t=[];if(!ba.validate(e,eh,r,t))throw($=new Error("Cannot read PKCS#10 certificate request. ASN.1 object is not a PKCS#10 CertificationRequest.")).errors=t,$;if(ba.derToOid(r.publicKeyOid)!==la.oids.rsaEncryption)throw new Error("Cannot read public key. OID is not RSA.");var s=la.createCertificationRequest();if(s.version=r.csrVersion?r.csrVersion.charCodeAt(0):0,s.signatureOid=aa.asn1.derToOid(r.csrSignatureOid),s.signatureParameters=cc(s.signatureOid,r.csrSignatureParams,!0),s.siginfo.algorithmOid=aa.asn1.derToOid(r.csrSignatureOid),s.siginfo.parameters=cc(s.siginfo.algorithmOid,r.csrSignatureParams,!1),s.signature=r.csrSignature,s.certificationRequestInfo=r.certificationRequestInfo,a){var $;if(s.md=null,s.signatureOid in pa)switch(pa[s.signatureOid]){case"sha1WithRSAEncryption":s.md=aa.md.sha1.create();break;case"md5WithRSAEncryption":s.md=aa.md.md5.create();break;case"sha256WithRSAEncryption":s.md=aa.md.sha256.create();break;case"sha384WithRSAEncryption":s.md=aa.md.sha384.create();break;case"sha512WithRSAEncryption":s.md=aa.md.sha512.create();break;case"RSASSA-PSS":s.md=aa.md.sha256.create();}if(null===s.md)throw($=new Error("Could not compute certification request digest. Unknown signature OID.")).signatureOid=s.signatureOid,$;var i=ba.toDer(s.certificationRequestInfo);s.md.update(i.getBytes())}var n=aa.md.sha1.create();return s.subject.getField=function(e){return gb(s.subject,e)},s.subject.addField=function(e){Pa([e]),s.subject.attributes.push(e)},s.subject.attributes=la.RDNAttributesAsArray(r.certificationRequestInfoSubject,n),s.subject.hash=n.digest().toHex(),s.publicKey=la.publicKeyFromAsn1(r.subjectPublicKeyInfo),s.getAttribute=function(e){return gb(s,e)},s.addAttribute=function(e){Pa([e]),s.attributes.push(e)},s.attributes=la.CRIAttributesAsArray(r.certificationRequestInfoAttributes||[]),s},la.createCertificationRequest=function(){var e={version:0,signatureOid:null,signature:null,siginfo:{}};return e.siginfo.algorithmOid=null,e.subject={},e.subject.getField=function(a){return gb(e.subject,a)},e.subject.addField=function(a){Pa([a]),e.subject.attributes.push(a)},e.subject.attributes=[],e.subject.hash=null,e.publicKey=null,e.attributes=[],e.getAttribute=function(a){return gb(e,a)},e.addAttribute=function(a){Pa([a]),e.attributes.push(a)},e.md=null,e.setSubject=function(a){Pa(a),e.subject.attributes=a,e.subject.hash=null},e.setAttributes=function(a){Pa(a),e.attributes=a},e.sign=function(a,r){e.md=r||aa.md.sha1.create();var t=pa[e.md.algorithm+"WithRSAEncryption"];if(!t){var s=new Error("Could not compute certification request digest. Unknown message digest algorithm OID.");throw s.algorithm=e.md.algorithm,s}e.signatureOid=e.siginfo.algorithmOid=t,e.certificationRequestInfo=la.getCertificationRequestInfo(e);var $=ba.toDer(e.certificationRequestInfo);e.md.update($.getBytes()),e.signature=a.sign(e.md)},e.verify=function(){var a=!1,r=e.md;if(null===r){if(e.signatureOid in pa)switch(pa[e.signatureOid]){case"sha1WithRSAEncryption":r=aa.md.sha1.create();break;case"md5WithRSAEncryption":r=aa.md.md5.create();break;case"sha256WithRSAEncryption":r=aa.md.sha256.create();break;case"sha384WithRSAEncryption":r=aa.md.sha384.create();break;case"sha512WithRSAEncryption":r=aa.md.sha512.create();break;case"RSASSA-PSS":r=aa.md.sha256.create();}if(null===r)throw(C=new Error("Could not compute certification request digest. Unknown signature OID.")).signatureOid=e.signatureOid,C;var t=e.certificationRequestInfo||la.getCertificationRequestInfo(e),s=ba.toDer(t);r.update(s.getBytes())}if(null!==r){var $;switch(e.signatureOid){case pa.sha1WithRSAEncryption:break;case pa["RSASSA-PSS"]:var i,n,C;if(void 0===(i=pa[e.signatureParameters.mgf.hash.algorithmOid])||void 0===aa.md[i])throw(C=new Error("Unsupported MGF hash function.")).oid=e.signatureParameters.mgf.hash.algorithmOid,C.name=i,C;if(void 0===(n=pa[e.signatureParameters.mgf.algorithmOid])||void 0===aa.mgf[n])throw(C=new Error("Unsupported MGF function.")).oid=e.signatureParameters.mgf.algorithmOid,C.name=n,C;if(n=aa.mgf[n].create(aa.md[i].create()),void 0===(i=pa[e.signatureParameters.hash.algorithmOid])||void 0===aa.md[i])throw(C=new Error("Unsupported RSASSA-PSS hash function.")).oid=e.signatureParameters.hash.algorithmOid,C.name=i,C;$=aa.pss.create(aa.md[i].create(),n,e.signatureParameters.saltLength);}a=e.publicKey.verify(r.digest().getBytes(),e.signature,$)}return a},e};var gh=new Date("1950-01-01T00:00:00Z"),hh=new Date("2050-01-01T00:00:00Z");function Nd(e){return e>=gh&&e<hh?ba.create(ba.Class.UNIVERSAL,ba.Type.UTCTIME,!1,ba.dateToUtcTime(e)):ba.create(ba.Class.UNIVERSAL,ba.Type.GENERALIZEDTIME,!1,ba.dateToGeneralizedTime(e))}la.getTBSCertificate=function(e){var a=Nd(e.validity.notBefore),r=Nd(e.validity.notAfter),t=ba.create(ba.Class.UNIVERSAL,ba.Type.SEQUENCE,!0,[ba.create(ba.Class.CONTEXT_SPECIFIC,0,!0,[ba.create(ba.Class.UNIVERSAL,ba.Type.INTEGER,!1,ba.integerToDer(e.version).getBytes())]),ba.create(ba.Class.UNIVERSAL,ba.Type.INTEGER,!1,aa.util.hexToBytes(e.serialNumber)),ba.create(ba.Class.UNIVERSAL,ba.Type.SEQUENCE,!0,[ba.create(ba.Class.UNIVERSAL,ba.Type.OID,!1,ba.oidToDer(e.siginfo.algorithmOid).getBytes()),Cc(e.siginfo.algorithmOid,e.siginfo.parameters)]),yb(e.issuer),ba.create(ba.Class.UNIVERSAL,ba.Type.SEQUENCE,!0,[a,r]),yb(e.subject),la.publicKeyToAsn1(e.publicKey)]);return e.issuer.uniqueId&&t.value.push(ba.create(ba.Class.CONTEXT_SPECIFIC,1,!0,[ba.create(ba.Class.UNIVERSAL,ba.Type.BITSTRING,!1,String.fromCharCode(0)+e.issuer.uniqueId)])),e.subject.uniqueId&&t.value.push(ba.create(ba.Class.CONTEXT_SPECIFIC,2,!0,[ba.create(ba.Class.UNIVERSAL,ba.Type.BITSTRING,!1,String.fromCharCode(0)+e.subject.uniqueId)])),e.extensions.length>0&&t.value.push(la.certificateExtensionsToAsn1(e.extensions)),t},la.getCertificationRequestInfo=function(e){return ba.create(ba.Class.UNIVERSAL,ba.Type.SEQUENCE,!0,[ba.create(ba.Class.UNIVERSAL,ba.Type.INTEGER,!1,ba.integerToDer(e.version).getBytes()),yb(e.subject),la.publicKeyToAsn1(e.publicKey),fh(e)])},la.distinguishedNameToAsn1=function(e){return yb(e)},la.certificateToAsn1=function(e){var a=e.tbsCertificate||la.getTBSCertificate(e);return ba.create(ba.Class.UNIVERSAL,ba.Type.SEQUENCE,!0,[a,ba.create(ba.Class.UNIVERSAL,ba.Type.SEQUENCE,!0,[ba.create(ba.Class.UNIVERSAL,ba.Type.OID,!1,ba.oidToDer(e.signatureOid).getBytes()),Cc(e.signatureOid,e.signatureParameters)]),ba.create(ba.Class.UNIVERSAL,ba.Type.BITSTRING,!1,String.fromCharCode(0)+e.signature)])},la.certificateExtensionsToAsn1=function(e){var a=ba.create(ba.Class.CONTEXT_SPECIFIC,3,!0,[]),r=ba.create(ba.Class.UNIVERSAL,ba.Type.SEQUENCE,!0,[]);a.value.push(r);for(var t=0;t<e.length;++t)r.value.push(la.certificateExtensionToAsn1(e[t]));return a},la.certificateExtensionToAsn1=function(e){var a=ba.create(ba.Class.UNIVERSAL,ba.Type.SEQUENCE,!0,[]);a.value.push(ba.create(ba.Class.UNIVERSAL,ba.Type.OID,!1,ba.oidToDer(e.id).getBytes())),e.critical&&a.value.push(ba.create(ba.Class.UNIVERSAL,ba.Type.BOOLEAN,!1,String.fromCharCode(255)));var r=e.value;return"string"!=typeof e.value&&(r=ba.toDer(r).getBytes()),a.value.push(ba.create(ba.Class.UNIVERSAL,ba.Type.OCTETSTRING,!1,r)),a},la.certificationRequestToAsn1=function(e){var a=e.certificationRequestInfo||la.getCertificationRequestInfo(e);return ba.create(ba.Class.UNIVERSAL,ba.Type.SEQUENCE,!0,[a,ba.create(ba.Class.UNIVERSAL,ba.Type.SEQUENCE,!0,[ba.create(ba.Class.UNIVERSAL,ba.Type.OID,!1,ba.oidToDer(e.signatureOid).getBytes()),Cc(e.signatureOid,e.signatureParameters)]),ba.create(ba.Class.UNIVERSAL,ba.Type.BITSTRING,!1,String.fromCharCode(0)+e.signature)])},la.createCaStore=function(e){var a={certs:{}};function r(e){return t(e),a.certs[e.hash]||null}function t(e){if(!e.hash){var a=aa.md.sha1.create();e.attributes=la.RDNAttributesAsArray(yb(e),a),e.hash=a.digest().toHex()}}if(a.getIssuer=function(e){return r(e.issuer)},a.addCertificate=function(e){if("string"==typeof e&&(e=aa.pki.certificateFromPem(e)),t(e.subject),!a.hasCertificate(e))if(e.subject.hash in a.certs){var r=a.certs[e.subject.hash];aa.util.isArray(r)||(r=[r]),r.push(e),a.certs[e.subject.hash]=r}else a.certs[e.subject.hash]=e},a.hasCertificate=function(e){"string"==typeof e&&(e=aa.pki.certificateFromPem(e));var a=r(e.subject);if(!a)return!1;aa.util.isArray(a)||(a=[a]);for(var t=ba.toDer(la.certificateToAsn1(e)).getBytes(),s=0;s<a.length;++s){if(t===ba.toDer(la.certificateToAsn1(a[s])).getBytes())return!0}return!1},a.listAllCertificates=function(){var e=[];for(var r in a.certs)if(a.certs.hasOwnProperty(r)){var t=a.certs[r];if(aa.util.isArray(t))for(var s=0;s<t.length;++s)e.push(t[s]);else e.push(t)}return e},a.removeCertificate=function(e){var s;if("string"==typeof e&&(e=aa.pki.certificateFromPem(e)),t(e.subject),!a.hasCertificate(e))return null;var $=r(e.subject);if(!aa.util.isArray($))return s=a.certs[e.subject.hash],delete a.certs[e.subject.hash],s;for(var i=ba.toDer(la.certificateToAsn1(e)).getBytes(),n=0;n<$.length;++n){i===ba.toDer(la.certificateToAsn1($[n])).getBytes()&&(s=$[n],$.splice(n,1))}return 0===$.length&&delete a.certs[e.subject.hash],s},e)for(var s=0;s<e.length;++s){var $=e[s];a.addCertificate($)}return a},la.certificateError={bad_certificate:"forge.pki.BadCertificate",unsupported_certificate:"forge.pki.UnsupportedCertificate",certificate_revoked:"forge.pki.CertificateRevoked",certificate_expired:"forge.pki.CertificateExpired",certificate_unknown:"forge.pki.CertificateUnknown",unknown_ca:"forge.pki.UnknownCertificateAuthority"},la.verifyCertificateChain=function(e,a,r){"function"==typeof r&&(r={verify:r}),r=r||{};var t=(a=a.slice(0)).slice(0),s=r.validityCheckDate;void 0===s&&(s=new Date);var $=!0,i=null,n=0;do{var C=a.shift(),o=null,v=!1;if(s&&(s<C.validity.notBefore||s>C.validity.notAfter)&&(i={message:"Certificate is not valid yet or has expired.",error:la.certificateError.certificate_expired,notBefore:C.validity.notBefore,notAfter:C.validity.notAfter,now:s}),null===i){if(null===(o=a[0]||e.getIssuer(C))&&C.isIssuer(C)&&(v=!0,o=C),o){var u=o;aa.util.isArray(u)||(u=[u]);for(var c=!1;!c&&u.length>0;){o=u.shift();try{c=o.verify(C)}catch(g){}}c||(i={message:"Certificate signature is invalid.",error:la.certificateError.bad_certificate})}null!==i||o&&!v||e.hasCertificate(C)||(i={message:"Certificate is not trusted.",error:la.certificateError.unknown_ca})}if(null===i&&o&&!C.isIssuer(o)&&(i={message:"Certificate issuer is invalid.",error:la.certificateError.bad_certificate}),null===i)for(var l={keyUsage:!0,basicConstraints:!0},G=0;null===i&&G<C.extensions.length;++G){var d=C.extensions[G];!d.critical||d.name in l||(i={message:"Certificate has an unsupported critical extension.",error:la.certificateError.unsupported_certificate})}if(null===i&&(!$||0===a.length&&(!o||v))){var H=C.getExtension("basicConstraints"),J=C.getExtension("keyUsage");if(null!==J&&(J.keyCertSign&&null!==H||(i={message:"Certificate keyUsage or basicConstraints conflict or indicate that the certificate is not a CA. If the certificate is the only one in the chain or isn't the first then the certificate must be a valid CA.",error:la.certificateError.bad_certificate})),null!==i||null===H||H.cA||(i={message:"Certificate basicConstraints indicates the certificate is not a CA.",error:la.certificateError.bad_certificate}),null===i&&null!==J&&"pathLenConstraint"in H)n-1>H.pathLenConstraint&&(i={message:"Certificate basicConstraints pathLenConstraint violated.",error:la.certificateError.bad_certificate})}var f=null===i||i.error,p=r.verify?r.verify(f,n,t):f;if(!0!==p)throw!0===f&&(i={message:"The application rejected the certificate.",error:la.certificateError.bad_certificate}),(p||0===p)&&("object"!=typeof p||aa.util.isArray(p)?"string"==typeof p&&(i.error=p):(p.message&&(i.message=p.message),p.error&&(i.error=p.error))),i;i=null,$=!1,++n}while(a.length>0);return!0};var ea=aa.asn1,ua=aa.pki,Mb=aa.pkcs12=aa.pkcs12||{},Od={name:"ContentInfo",tagClass:ea.Class.UNIVERSAL,type:ea.Type.SEQUENCE,constructed:!0,value:[{name:"ContentInfo.contentType",tagClass:ea.Class.UNIVERSAL,type:ea.Type.OID,constructed:!1,capture:"contentType"},{name:"ContentInfo.content",tagClass:ea.Class.CONTEXT_SPECIFIC,constructed:!0,captureAsn1:"content"}]},ih={name:"PFX",tagClass:ea.Class.UNIVERSAL,type:ea.Type.SEQUENCE,constructed:!0,value:[{name:"PFX.version",tagClass:ea.Class.UNIVERSAL,type:ea.Type.INTEGER,constructed:!1,capture:"version"},Od,{name:"PFX.macData",tagClass:ea.Class.UNIVERSAL,type:ea.Type.SEQUENCE,constructed:!0,optional:!0,captureAsn1:"mac",value:[{name:"PFX.macData.mac",tagClass:ea.Class.UNIVERSAL,type:ea.Type.SEQUENCE,constructed:!0,value:[{name:"PFX.macData.mac.digestAlgorithm",tagClass:ea.Class.UNIVERSAL,type:ea.Type.SEQUENCE,constructed:!0,value:[{name:"PFX.macData.mac.digestAlgorithm.algorithm",tagClass:ea.Class.UNIVERSAL,type:ea.Type.OID,constructed:!1,capture:"macAlgorithm"},{name:"PFX.macData.mac.digestAlgorithm.parameters",tagClass:ea.Class.UNIVERSAL,captureAsn1:"macAlgorithmParameters"}]},{name:"PFX.macData.mac.digest",tagClass:ea.Class.UNIVERSAL,type:ea.Type.OCTETSTRING,constructed:!1,capture:"macDigest"}]},{name:"PFX.macData.macSalt",tagClass:ea.Class.UNIVERSAL,type:ea.Type.OCTETSTRING,constructed:!1,capture:"macSalt"},{name:"PFX.macData.iterations",tagClass:ea.Class.UNIVERSAL,type:ea.Type.INTEGER,constructed:!1,optional:!0,capture:"macIterations"}]}]},jh={name:"SafeBag",tagClass:ea.Class.UNIVERSAL,type:ea.Type.SEQUENCE,constructed:!0,value:[{name:"SafeBag.bagId",tagClass:ea.Class.UNIVERSAL,type:ea.Type.OID,constructed:!1,capture:"bagId"},{name:"SafeBag.bagValue",tagClass:ea.Class.CONTEXT_SPECIFIC,constructed:!0,captureAsn1:"bagValue"},{name:"SafeBag.bagAttributes",tagClass:ea.Class.UNIVERSAL,type:ea.Type.SET,constructed:!0,optional:!0,capture:"bagAttributes"}]},kh={name:"Attribute",tagClass:ea.Class.UNIVERSAL,type:ea.Type.SEQUENCE,constructed:!0,value:[{name:"Attribute.attrId",tagClass:ea.Class.UNIVERSAL,type:ea.Type.OID,constructed:!1,capture:"oid"},{name:"Attribute.attrValues",tagClass:ea.Class.UNIVERSAL,type:ea.Type.SET,constructed:!0,capture:"values"}]},lh={name:"CertBag",tagClass:ea.Class.UNIVERSAL,type:ea.Type.SEQUENCE,constructed:!0,value:[{name:"CertBag.certId",tagClass:ea.Class.UNIVERSAL,type:ea.Type.OID,constructed:!1,capture:"certId"},{name:"CertBag.certValue",tagClass:ea.Class.CONTEXT_SPECIFIC,constructed:!0,value:[{name:"CertBag.certValue[0]",tagClass:ea.Class.UNIVERSAL,type:ea.Class.OCTETSTRING,constructed:!1,capture:"cert"}]}]};function Nb(a,$,e,r){for(var o=[],s=0;s<a.length;s++)for(var t=0;t<a[s].safeBags.length;t++){var d=a[s].safeBags[t];void 0!==r&&d.type!==r||(null!==$?void 0!==d.attributes[$]&&d.attributes[$].indexOf(e)>=0&&o.push(d):o.push(d))}return o}function Dc(a){if(a.composed||a.constructed){for(var $=aa.util.createBuffer(),e=0;e<a.value.length;++e)$.putBytes(a.value[e].value);a.composed=a.constructed=!1,a.value=$.getBytes()}return a}function mh(a,$,e,r){if(($=ea.fromDer($,e)).tagClass!==ea.Class.UNIVERSAL||$.type!==ea.Type.SEQUENCE||!0!==$.constructed)throw new Error("PKCS#12 AuthenticatedSafe expected to be a SEQUENCE OF ContentInfo");for(var o=0;o<$.value.length;o++){var s=$.value[o],t={},d=[];if(!ea.validate(s,Od,t,d))throw(H=new Error("Cannot read ContentInfo.")).errors=d,H;var n={encrypted:!1},y=null,v=t.content.value[0];switch(ea.derToOid(t.contentType)){case ua.oids.data:if(v.tagClass!==ea.Class.UNIVERSAL||v.type!==ea.Type.OCTETSTRING)throw new Error("PKCS#12 SafeContents Data is not an OCTET STRING.");y=Dc(v).value;break;case ua.oids.encryptedData:y=nh(v,r),n.encrypted=!0;break;default:var H;throw(H=new Error("Unsupported PKCS#12 contentType.")).contentType=ea.derToOid(t.contentType),H;}n.safeBags=oh(y,e,r),a.safeContents.push(n)}}function nh(a,$){var e={},r=[];if(!ea.validate(a,aa.pkcs7.asn1.encryptedDataValidator,e,r))throw(o=new Error("Cannot read EncryptedContentInfo.")).errors=r,o;var o,s=ea.derToOid(e.contentType);if(s!==ua.oids.data)throw(o=new Error("PKCS#12 EncryptedContentInfo ContentType is not Data.")).oid=s,o;s=ea.derToOid(e.encAlgorithm);var t=ua.pbe.getCipher(s,e.encParameter,$),d=Dc(e.encryptedContentAsn1),n=aa.util.createBuffer(d.value);if(t.update(n),!t.finish())throw new Error("Failed to decrypt PKCS#12 SafeContents.");return t.output.getBytes()}function oh(a,$,e){if(!$&&0===a.length)return[];if((a=ea.fromDer(a,$)).tagClass!==ea.Class.UNIVERSAL||a.type!==ea.Type.SEQUENCE||!0!==a.constructed)throw new Error("PKCS#12 SafeContents expected to be a SEQUENCE OF SafeBag.");for(var r=[],o=0;o<a.value.length;o++){var s=a.value[o],t={},d=[];if(!ea.validate(s,jh,t,d))throw(c=new Error("Cannot read SafeBag.")).errors=d,c;var n,y,v={type:ea.derToOid(t.bagId),attributes:ph(t.bagAttributes)};r.push(v);var H=t.bagValue.value[0];switch(v.type){case ua.oids.pkcs8ShroudedKeyBag:if(null===(H=ua.decryptPrivateKeyInfo(H,e)))throw new Error("Unable to decrypt PKCS#8 ShroudedKeyBag, wrong password?");case ua.oids.keyBag:try{v.key=ua.privateKeyFromAsn1(H)}catch(i){v.key=null,v.asn1=H}continue;case ua.oids.certBag:n=lh,y=function(){if(ea.derToOid(t.certId)!==ua.oids.x509Certificate){var a=new Error("Unsupported certificate type, only X.509 supported.");throw a.oid=ea.derToOid(t.certId),a}var e=ea.fromDer(t.cert,$);try{v.cert=ua.certificateFromAsn1(e,!0)}catch(i){v.cert=null,v.asn1=e}};break;default:var c;throw(c=new Error("Unsupported PKCS#12 SafeBag type.")).oid=v.type,c;}if(void 0!==n&&!ea.validate(H,n,t,d))throw(c=new Error("Cannot read PKCS#12 "+n.name)).errors=d,c;y()}return r}function ph(a){var $={};if(void 0!==a)for(var e=0;e<a.length;++e){var r={},o=[];if(!ea.validate(a[e],kh,r,o)){var s=new Error("Cannot read PKCS#12 BagAttribute.");throw s.errors=o,s}var t=ea.derToOid(r.oid);if(void 0!==ua.oids[t]){$[ua.oids[t]]=[];for(var d=0;d<r.values.length;++d)$[ua.oids[t]].push(r.values[d].value)}}return $}Mb.pkcs12FromAsn1=function(a,$,e){"string"==typeof $?(e=$,$=!0):void 0===$&&($=!0);var r={};if(!ea.validate(a,ih,r,[]))throw(o=new Error("Cannot read PKCS#12 PFX. ASN.1 object is not an PKCS#12 PFX.")).errors=o,o;var o,s={version:r.version.charCodeAt(0),safeContents:[],getBags:function(a){var $,e={};return"localKeyId"in a?$=a.localKeyId:"localKeyIdHex"in a&&($=aa.util.hexToBytes(a.localKeyIdHex)),void 0===$&&!("friendlyName"in a)&&"bagType"in a&&(e[a.bagType]=Nb(s.safeContents,null,null,a.bagType)),void 0!==$&&(e.localKeyId=Nb(s.safeContents,"localKeyId",$,a.bagType)),"friendlyName"in a&&(e.friendlyName=Nb(s.safeContents,"friendlyName",a.friendlyName,a.bagType)),e},getBagsByFriendlyName:function(a,$){return Nb(s.safeContents,"friendlyName",a,$)},getBagsByLocalKeyId:function(a,$){return Nb(s.safeContents,"localKeyId",a,$)}};if(3!==r.version.charCodeAt(0))throw(o=new Error("PKCS#12 PFX of version other than 3 not supported.")).version=r.version.charCodeAt(0),o;if(ea.derToOid(r.contentType)!==ua.oids.data)throw(o=new Error("Only PKCS#12 PFX in password integrity mode supported.")).oid=ea.derToOid(r.contentType),o;var t=r.content.value[0];if(t.tagClass!==ea.Class.UNIVERSAL||t.type!==ea.Type.OCTETSTRING)throw new Error("PKCS#12 authSafe content data is not an OCTET STRING.");if(t=Dc(t),r.mac){var d=null,n=0,y=ea.derToOid(r.macAlgorithm);switch(y){case ua.oids.sha1:d=aa.md.sha1.create(),n=20;break;case ua.oids.sha256:d=aa.md.sha256.create(),n=32;break;case ua.oids.sha384:d=aa.md.sha384.create(),n=48;break;case ua.oids.sha512:d=aa.md.sha512.create(),n=64;break;case ua.oids.md5:d=aa.md.md5.create(),n=16;}if(null===d)throw new Error("PKCS#12 uses unsupported MAC algorithm: "+y);var v=new aa.util.ByteBuffer(r.macSalt),H="macIterations"in r?parseInt(aa.util.bytesToHex(r.macIterations),16):1,c=Mb.generateKey(e,v,3,H,n,d),i=aa.hmac.create();if(i.start(d,c),i.update(t.value),i.getMac().getBytes()!==r.macDigest)throw new Error("PKCS#12 MAC could not be verified. Invalid password?")}return mh(s,t.value,$,e),s},Mb.toPkcs12Asn1=function(a,$,e,r){(r=r||{}).saltSize=r.saltSize||8,r.count=r.count||2048,r.algorithm=r.algorithm||r.encAlgorithm||"aes128","useMac"in r||(r.useMac=!0),"localKeyId"in r||(r.localKeyId=null),"generateLocalKeyId"in r||(r.generateLocalKeyId=!0);var o,s=r.localKeyId;if(null!==s)s=aa.util.hexToBytes(s);else if(r.generateLocalKeyId)if($){var t=aa.util.isArray($)?$[0]:$;"string"==typeof t&&(t=ua.certificateFromPem(t)),(f=aa.md.sha1.create()).update(ea.toDer(ua.certificateToAsn1(t)).getBytes()),s=f.digest().getBytes()}else s=aa.random.getBytes(20);var d=[];null!==s&&d.push(ea.create(ea.Class.UNIVERSAL,ea.Type.SEQUENCE,!0,[ea.create(ea.Class.UNIVERSAL,ea.Type.OID,!1,ea.oidToDer(ua.oids.localKeyId).getBytes()),ea.create(ea.Class.UNIVERSAL,ea.Type.SET,!0,[ea.create(ea.Class.UNIVERSAL,ea.Type.OCTETSTRING,!1,s)])])),"friendlyName"in r&&d.push(ea.create(ea.Class.UNIVERSAL,ea.Type.SEQUENCE,!0,[ea.create(ea.Class.UNIVERSAL,ea.Type.OID,!1,ea.oidToDer(ua.oids.friendlyName).getBytes()),ea.create(ea.Class.UNIVERSAL,ea.Type.SET,!0,[ea.create(ea.Class.UNIVERSAL,ea.Type.BMPSTRING,!1,r.friendlyName)])])),d.length>0&&(o=ea.create(ea.Class.UNIVERSAL,ea.Type.SET,!0,d));var n=[],y=[];null!==$&&(y=aa.util.isArray($)?$:[$]);for(var v=[],H=0;H<y.length;++H){"string"==typeof($=y[H])&&($=ua.certificateFromPem($));var c=0===H?o:void 0,i=ua.certificateToAsn1($),l=ea.create(ea.Class.UNIVERSAL,ea.Type.SEQUENCE,!0,[ea.create(ea.Class.UNIVERSAL,ea.Type.OID,!1,ea.oidToDer(ua.oids.certBag).getBytes()),ea.create(ea.Class.CONTEXT_SPECIFIC,0,!0,[ea.create(ea.Class.UNIVERSAL,ea.Type.SEQUENCE,!0,[ea.create(ea.Class.UNIVERSAL,ea.Type.OID,!1,ea.oidToDer(ua.oids.x509Certificate).getBytes()),ea.create(ea.Class.CONTEXT_SPECIFIC,0,!0,[ea.create(ea.Class.UNIVERSAL,ea.Type.OCTETSTRING,!1,ea.toDer(i).getBytes())])])]),c]);v.push(l)}if(v.length>0){var p=ea.create(ea.Class.UNIVERSAL,ea.Type.SEQUENCE,!0,v),C=ea.create(ea.Class.UNIVERSAL,ea.Type.SEQUENCE,!0,[ea.create(ea.Class.UNIVERSAL,ea.Type.OID,!1,ea.oidToDer(ua.oids.data).getBytes()),ea.create(ea.Class.CONTEXT_SPECIFIC,0,!0,[ea.create(ea.Class.UNIVERSAL,ea.Type.OCTETSTRING,!1,ea.toDer(p).getBytes())])]);n.push(C)}var E=null;if(null!==a){var u=ua.wrapRsaPrivateKey(ua.privateKeyToAsn1(a));E=null===e?ea.create(ea.Class.UNIVERSAL,ea.Type.SEQUENCE,!0,[ea.create(ea.Class.UNIVERSAL,ea.Type.OID,!1,ea.oidToDer(ua.oids.keyBag).getBytes()),ea.create(ea.Class.CONTEXT_SPECIFIC,0,!0,[u]),o]):ea.create(ea.Class.UNIVERSAL,ea.Type.SEQUENCE,!0,[ea.create(ea.Class.UNIVERSAL,ea.Type.OID,!1,ea.oidToDer(ua.oids.pkcs8ShroudedKeyBag).getBytes()),ea.create(ea.Class.CONTEXT_SPECIFIC,0,!0,[ua.encryptPrivateKeyInfo(u,e,r)]),o]);var g=ea.create(ea.Class.UNIVERSAL,ea.Type.SEQUENCE,!0,[E]),T=ea.create(ea.Class.UNIVERSAL,ea.Type.SEQUENCE,!0,[ea.create(ea.Class.UNIVERSAL,ea.Type.OID,!1,ea.oidToDer(ua.oids.data).getBytes()),ea.create(ea.Class.CONTEXT_SPECIFIC,0,!0,[ea.create(ea.Class.UNIVERSAL,ea.Type.OCTETSTRING,!1,ea.toDer(g).getBytes())])]);n.push(T)}var S,I=ea.create(ea.Class.UNIVERSAL,ea.Type.SEQUENCE,!0,n);if(r.useMac){var f=aa.md.sha1.create(),N=new aa.util.ByteBuffer(aa.random.getBytes(r.saltSize)),A=r.count,m=(a=Mb.generateKey(e,N,3,A,20),aa.hmac.create());m.start(f,a),m.update(ea.toDer(I).getBytes());var U=m.getMac();S=ea.create(ea.Class.UNIVERSAL,ea.Type.SEQUENCE,!0,[ea.create(ea.Class.UNIVERSAL,ea.Type.SEQUENCE,!0,[ea.create(ea.Class.UNIVERSAL,ea.Type.SEQUENCE,!0,[ea.create(ea.Class.UNIVERSAL,ea.Type.OID,!1,ea.oidToDer(ua.oids.sha1).getBytes()),ea.create(ea.Class.UNIVERSAL,ea.Type.NULL,!1,"")]),ea.create(ea.Class.UNIVERSAL,ea.Type.OCTETSTRING,!1,U.getBytes())]),ea.create(ea.Class.UNIVERSAL,ea.Type.OCTETSTRING,!1,N.getBytes()),ea.create(ea.Class.UNIVERSAL,ea.Type.INTEGER,!1,ea.integerToDer(A).getBytes())])}return ea.create(ea.Class.UNIVERSAL,ea.Type.SEQUENCE,!0,[ea.create(ea.Class.UNIVERSAL,ea.Type.INTEGER,!1,ea.integerToDer(3).getBytes()),ea.create(ea.Class.UNIVERSAL,ea.Type.SEQUENCE,!0,[ea.create(ea.Class.UNIVERSAL,ea.Type.OID,!1,ea.oidToDer(ua.oids.data).getBytes()),ea.create(ea.Class.CONTEXT_SPECIFIC,0,!0,[ea.create(ea.Class.UNIVERSAL,ea.Type.OCTETSTRING,!1,ea.toDer(I).getBytes())])]),S])},Mb.generateKey=aa.pbe.generatePkcs12Key;var Ec=aa.asn1,zb=aa.pki=aa.pki||{};zb.pemToDer=function(r){var e=aa.pem.decode(r)[0];if(e.procType&&"ENCRYPTED"===e.procType.type)throw new Error("Could not convert PEM to DER; PEM is encrypted.");return aa.util.createBuffer(e.body)},zb.privateKeyFromPem=function(r){var e=aa.pem.decode(r)[0];if("PRIVATE KEY"!==e.type&&"RSA PRIVATE KEY"!==e.type){var $=new Error("Could not convert private key from PEM; PEM header type is not \"PRIVATE KEY\" or \"RSA PRIVATE KEY\".");throw $.headerType=e.type,$}if(e.procType&&"ENCRYPTED"===e.procType.type)throw new Error("Could not convert private key from PEM; PEM is encrypted.");var o=Ec.fromDer(e.body);return zb.privateKeyFromAsn1(o)},zb.privateKeyToPem=function(r,e){var $={type:"RSA PRIVATE KEY",body:Ec.toDer(zb.privateKeyToAsn1(r)).getBytes()};return aa.pem.encode($,{maxline:e})},zb.privateKeyInfoToPem=function(r,e){var $={type:"PRIVATE KEY",body:Ec.toDer(r).getBytes()};return aa.pem.encode($,{maxline:e})};var dc=function(e,r,$,t){var a=aa.util.createBuffer(),c=e.length>>1,s=c+(1&e.length),n=e.substr(0,s),i=e.substr(c,s),v=aa.util.createBuffer(),l=aa.hmac.create();$=r+$;var o=Math.ceil(t/16),A=Math.ceil(t/20);l.start("MD5",n);var T=aa.util.createBuffer();v.putBytes($);for(var _=0;_<o;++_)l.start(null,null),l.update(v.getBytes()),v.putBuffer(l.digest()),l.start(null,null),l.update(v.bytes()+$),T.putBuffer(l.digest());l.start("SHA1",i);var W=aa.util.createBuffer();v.clear(),v.putBytes($);for(_=0;_<A;++_)l.start(null,null),l.update(v.getBytes()),v.putBuffer(l.digest()),l.start(null,null),l.update(v.bytes()+$),W.putBuffer(l.digest());return a.putBytes(aa.util.xorBytes(T.getBytes(),W.getBytes(),t)),a},qh=function(e,r,$){var t=aa.hmac.create();t.start("SHA1",e);var a=aa.util.createBuffer();return a.putInt32(r[0]),a.putInt32(r[1]),a.putByte($.type),a.putByte($.version.major),a.putByte($.version.minor),a.putInt16($.length),a.putBytes($.fragment.bytes()),t.update(a.getBytes()),t.digest().getBytes()},rh=function(e,r,$){var t=!1;try{var a=e.deflate(r.fragment.getBytes());r.fragment=aa.util.createBuffer(a),r.length=a.length,t=!0}catch(c){}return t},sh=function(e,r,$){var t=!1;try{var a=e.inflate(r.fragment.getBytes());r.fragment=aa.util.createBuffer(a),r.length=a.length,t=!0}catch(c){}return t},Na=function(e,r){var $=0;switch(r){case 1:$=e.getByte();break;case 2:$=e.getInt16();break;case 3:$=e.getInt24();break;case 4:$=e.getInt32();}return aa.util.createBuffer(e.getBytes($))},Qa=function(e,r,$){e.putInt($.length(),r<<3),e.putBuffer($)},da={Versions:{TLS_1_0:{major:3,minor:1},TLS_1_1:{major:3,minor:2},TLS_1_2:{major:3,minor:3}}};da.SupportedVersions=[da.Versions.TLS_1_1,da.Versions.TLS_1_0],da.Version=da.SupportedVersions[0],da.MaxFragment=15360,da.ConnectionEnd={server:0,client:1},da.PRFAlgorithm={tls_prf_sha256:0},da.BulkCipherAlgorithm={none:null,rc4:0,des3:1,aes:2},da.CipherType={stream:0,block:1,aead:2},da.MACAlgorithm={none:null,hmac_md5:0,hmac_sha1:1,hmac_sha256:2,hmac_sha384:3,hmac_sha512:4},da.CompressionMethod={none:0,deflate:1},da.ContentType={change_cipher_spec:20,alert:21,handshake:22,application_data:23,heartbeat:24},da.HandshakeType={hello_request:0,client_hello:1,server_hello:2,certificate:11,server_key_exchange:12,certificate_request:13,server_hello_done:14,certificate_verify:15,client_key_exchange:16,finished:20},da.Alert={},da.Alert.Level={warning:1,fatal:2},da.Alert.Description={close_notify:0,unexpected_message:10,bad_record_mac:20,decryption_failed:21,record_overflow:22,decompression_failure:30,handshake_failure:40,bad_certificate:42,unsupported_certificate:43,certificate_revoked:44,certificate_expired:45,certificate_unknown:46,illegal_parameter:47,unknown_ca:48,access_denied:49,decode_error:50,decrypt_error:51,export_restriction:60,protocol_version:70,insufficient_security:71,internal_error:80,user_canceled:90,no_renegotiation:100},da.HeartbeatMessageType={heartbeat_request:1,heartbeat_response:2},da.CipherSuites={},da.getCipherSuite=function(e){var r=null;for(var $ in da.CipherSuites){var t=da.CipherSuites[$];if(t.id[0]===e.charCodeAt(0)&&t.id[1]===e.charCodeAt(1)){r=t;break}}return r},da.handleUnexpected=function(e,r){!e.open&&e.entity===da.ConnectionEnd.client||e.error(e,{message:"Unexpected message. Received TLS record out of order.",send:!0,alert:{level:da.Alert.Level.fatal,description:da.Alert.Description.unexpected_message}})},da.handleHelloRequest=function(e,r,$){!e.handshaking&&e.handshakes>0&&(da.queue(e,da.createAlert(e,{level:da.Alert.Level.warning,description:da.Alert.Description.no_renegotiation})),da.flush(e)),e.process()},da.parseHelloMessage=function(e,r,$){var t=null,a=e.entity===da.ConnectionEnd.client;if($<38)e.error(e,{message:a?"Invalid ServerHello message. Message too short.":"Invalid ClientHello message. Message too short.",send:!0,alert:{level:da.Alert.Level.fatal,description:da.Alert.Description.illegal_parameter}});else{var c=r.fragment,s=c.length();if(t={version:{major:c.getByte(),minor:c.getByte()},random:aa.util.createBuffer(c.getBytes(32)),session_id:Na(c,1),extensions:[]},a?(t.cipher_suite=c.getBytes(2),t.compression_method=c.getByte()):(t.cipher_suites=Na(c,2),t.compression_methods=Na(c,1)),(s=$-(s-c.length()))>0){for(var n=Na(c,2);n.length()>0;)t.extensions.push({type:[n.getByte(),n.getByte()],data:Na(n,2)});if(!a)for(var i=0;i<t.extensions.length;++i){var v=t.extensions[i];if(0===v.type[0]&&0===v.type[1])for(var l=Na(v.data,2);l.length()>0;){if(0!==l.getByte())break;e.session.extensions.server_name.serverNameList.push(Na(l,2).getBytes())}}}if(e.session.version&&(t.version.major!==e.session.version.major||t.version.minor!==e.session.version.minor))return e.error(e,{message:"TLS version change is disallowed during renegotiation.",send:!0,alert:{level:da.Alert.Level.fatal,description:da.Alert.Description.protocol_version}});if(a)e.session.cipherSuite=da.getCipherSuite(t.cipher_suite);else for(var o=aa.util.createBuffer(t.cipher_suites.bytes());o.length()>0&&(e.session.cipherSuite=da.getCipherSuite(o.getBytes(2)),null===e.session.cipherSuite););if(null===e.session.cipherSuite)return e.error(e,{message:"No cipher suites in common.",send:!0,alert:{level:da.Alert.Level.fatal,description:da.Alert.Description.handshake_failure},cipherSuite:aa.util.bytesToHex(t.cipher_suite)});e.session.compressionMethod=a?t.compression_method:da.CompressionMethod.none}return t},da.createSecurityParameters=function(e,r){var $=e.entity===da.ConnectionEnd.client,t=r.random.bytes(),a=$?e.session.sp.client_random:t,c=$?t:da.createRandom().getBytes();e.session.sp={entity:e.entity,prf_algorithm:da.PRFAlgorithm.tls_prf_sha256,bulk_cipher_algorithm:null,cipher_type:null,enc_key_length:null,block_length:null,fixed_iv_length:null,record_iv_length:null,mac_algorithm:null,mac_length:null,mac_key_length:null,compression_algorithm:e.session.compressionMethod,pre_master_secret:null,master_secret:null,client_random:a,server_random:c}},da.handleServerHello=function(e,r,$){var t=da.parseHelloMessage(e,r,$);if(!e.fail){if(!(t.version.minor<=e.version.minor))return e.error(e,{message:"Incompatible TLS version.",send:!0,alert:{level:da.Alert.Level.fatal,description:da.Alert.Description.protocol_version}});e.version.minor=t.version.minor,e.session.version=e.version;var a=t.session_id.bytes();a.length>0&&a===e.session.id?(e.expect=Qd,e.session.resuming=!0,e.session.sp.server_random=t.random.bytes()):(e.expect=uh,e.session.resuming=!1,da.createSecurityParameters(e,t)),e.session.id=a,e.process()}},da.handleClientHello=function(e,r,$){var t=da.parseHelloMessage(e,r,$);if(!e.fail){var a=t.session_id.bytes(),c=null;if(e.sessionCache&&(null===(c=e.sessionCache.getSession(a))?a="":(c.version.major!==t.version.major||c.version.minor>t.version.minor)&&(c=null,a="")),0===a.length&&(a=aa.random.getBytes(32)),e.session.id=a,e.session.clientHelloVersion=t.version,e.session.sp={},c)e.version=e.session.version=c.version,e.session.sp=c.sp;else{for(var s,n=1;n<da.SupportedVersions.length&&!((s=da.SupportedVersions[n]).minor<=t.version.minor);++n);e.version={major:s.major,minor:s.minor},e.session.version=e.version}null!==c?(e.expect=Gc,e.session.resuming=!0,e.session.sp.client_random=t.random.bytes()):(e.expect=!1!==e.verifyClient?Bh:Fc,e.session.resuming=!1,da.createSecurityParameters(e,t)),e.open=!0,da.queue(e,da.createRecord(e,{type:da.ContentType.handshake,data:da.createServerHello(e)})),e.session.resuming?(da.queue(e,da.createRecord(e,{type:da.ContentType.change_cipher_spec,data:da.createChangeCipherSpec()})),e.state.pending=da.createConnectionState(e),e.state.current.write=e.state.pending.write,da.queue(e,da.createRecord(e,{type:da.ContentType.handshake,data:da.createFinished(e)}))):(da.queue(e,da.createRecord(e,{type:da.ContentType.handshake,data:da.createCertificate(e)})),e.fail||(da.queue(e,da.createRecord(e,{type:da.ContentType.handshake,data:da.createServerKeyExchange(e)})),!1!==e.verifyClient&&da.queue(e,da.createRecord(e,{type:da.ContentType.handshake,data:da.createCertificateRequest(e)})),da.queue(e,da.createRecord(e,{type:da.ContentType.handshake,data:da.createServerHelloDone(e)})))),da.flush(e),e.process()}},da.handleCertificate=function(e,r,$){if($<3)return e.error(e,{message:"Invalid Certificate message. Message too short.",send:!0,alert:{level:da.Alert.Level.fatal,description:da.Alert.Description.illegal_parameter}});var t,a,c=r.fragment,s={certificate_list:Na(c,3)},n=[];try{for(;s.certificate_list.length()>0;)t=Na(s.certificate_list,3),a=aa.asn1.fromDer(t),t=aa.pki.certificateFromAsn1(a,!0),n.push(t)}catch(v){return e.error(e,{message:"Could not parse certificate list.",cause:v,send:!0,alert:{level:da.Alert.Level.fatal,description:da.Alert.Description.bad_certificate}})}var i=e.entity===da.ConnectionEnd.client;!i&&!0!==e.verifyClient||0!==n.length?0===n.length?e.expect=i?Pd:Fc:(i?e.session.serverCertificate=n[0]:e.session.clientCertificate=n[0],da.verifyCertificateChain(e,n)&&(e.expect=i?Pd:Fc)):e.error(e,{message:i?"No server certificate provided.":"No client certificate provided.",send:!0,alert:{level:da.Alert.Level.fatal,description:da.Alert.Description.illegal_parameter}}),e.process()},da.handleServerKeyExchange=function(e,r,$){if($>0)return e.error(e,{message:"Invalid key parameters. Only RSA is supported.",send:!0,alert:{level:da.Alert.Level.fatal,description:da.Alert.Description.unsupported_certificate}});e.expect=vh,e.process()},da.handleClientKeyExchange=function(e,r,$){if($<48)return e.error(e,{message:"Invalid key parameters. Only RSA is supported.",send:!0,alert:{level:da.Alert.Level.fatal,description:da.Alert.Description.unsupported_certificate}});var t=r.fragment,a={enc_pre_master_secret:Na(t,2).getBytes()},c=null;if(e.getPrivateKey)try{c=e.getPrivateKey(e,e.session.serverCertificate),c=aa.pki.privateKeyFromPem(c)}catch(i){e.error(e,{message:"Could not get private key.",cause:i,send:!0,alert:{level:da.Alert.Level.fatal,description:da.Alert.Description.internal_error}})}if(null===c)return e.error(e,{message:"No private key set.",send:!0,alert:{level:da.Alert.Level.fatal,description:da.Alert.Description.internal_error}});try{var s=e.session.sp;s.pre_master_secret=c.decrypt(a.enc_pre_master_secret);var n=e.session.clientHelloVersion;if(n.major!==s.pre_master_secret.charCodeAt(0)||n.minor!==s.pre_master_secret.charCodeAt(1))throw new Error("TLS version rollback attack detected.")}catch(i){s.pre_master_secret=aa.random.getBytes(48)}e.expect=Gc,null!==e.session.clientCertificate&&(e.expect=Ch),e.process()},da.handleCertificateRequest=function(e,r,$){if($<3)return e.error(e,{message:"Invalid CertificateRequest. Message too short.",send:!0,alert:{level:da.Alert.Level.fatal,description:da.Alert.Description.illegal_parameter}});var t=r.fragment,a={certificate_types:Na(t,1),certificate_authorities:Na(t,2)};e.session.certificateRequest=a,e.expect=wh,e.process()},da.handleCertificateVerify=function(e,r,$){if($<2)return e.error(e,{message:"Invalid CertificateVerify. Message too short.",send:!0,alert:{level:da.Alert.Level.fatal,description:da.Alert.Description.illegal_parameter}});var t=r.fragment;t.read-=4;var a=t.bytes();t.read+=4;var c={signature:Na(t,2).getBytes()},s=aa.util.createBuffer();s.putBuffer(e.session.md5.digest()),s.putBuffer(e.session.sha1.digest()),s=s.getBytes();try{if(!e.session.clientCertificate.publicKey.verify(s,c.signature,"NONE"))throw new Error("CertificateVerify signature does not match.");e.session.md5.update(a),e.session.sha1.update(a)}catch(n){return e.error(e,{message:"Bad signature in CertificateVerify.",send:!0,alert:{level:da.Alert.Level.fatal,description:da.Alert.Description.handshake_failure}})}e.expect=Gc,e.process()},da.handleServerHelloDone=function(e,r,$){if($>0)return e.error(e,{message:"Invalid ServerHelloDone message. Invalid length.",send:!0,alert:{level:da.Alert.Level.fatal,description:da.Alert.Description.record_overflow}});if(null===e.serverCertificate){var t={message:"No server certificate provided. Not enough security.",send:!0,alert:{level:da.Alert.Level.fatal,description:da.Alert.Description.insufficient_security}},a=e.verify(e,t.alert.description,0,[]);if(!0!==a)return(a||0===a)&&("object"!=typeof a||aa.util.isArray(a)?"number"==typeof a&&(t.alert.description=a):(a.message&&(t.message=a.message),a.alert&&(t.alert.description=a.alert))),e.error(e,t)}null!==e.session.certificateRequest&&(r=da.createRecord(e,{type:da.ContentType.handshake,data:da.createCertificate(e)}),da.queue(e,r)),r=da.createRecord(e,{type:da.ContentType.handshake,data:da.createClientKeyExchange(e)}),da.queue(e,r),e.expect=zh;var c=function(e,r){null!==e.session.certificateRequest&&null!==e.session.clientCertificate&&da.queue(e,da.createRecord(e,{type:da.ContentType.handshake,data:da.createCertificateVerify(e,r)})),da.queue(e,da.createRecord(e,{type:da.ContentType.change_cipher_spec,data:da.createChangeCipherSpec()})),e.state.pending=da.createConnectionState(e),e.state.current.write=e.state.pending.write,da.queue(e,da.createRecord(e,{type:da.ContentType.handshake,data:da.createFinished(e)})),e.expect=Qd,da.flush(e),e.process()};if(null===e.session.certificateRequest||null===e.session.clientCertificate)return c(e,null);da.getClientSignature(e,c)},da.handleChangeCipherSpec=function(e,r){if(1!==r.fragment.getByte())return e.error(e,{message:"Invalid ChangeCipherSpec message received.",send:!0,alert:{level:da.Alert.Level.fatal,description:da.Alert.Description.illegal_parameter}});var $=e.entity===da.ConnectionEnd.client;(e.session.resuming&&$||!e.session.resuming&&!$)&&(e.state.pending=da.createConnectionState(e)),e.state.current.read=e.state.pending.read,(!e.session.resuming&&$||e.session.resuming&&!$)&&(e.state.pending=null),e.expect=$?xh:Dh,e.process()},da.handleFinished=function(e,r,$){var t=r.fragment;t.read-=4;var a=t.bytes();t.read+=4;var c=r.fragment.getBytes();(t=aa.util.createBuffer()).putBuffer(e.session.md5.digest()),t.putBuffer(e.session.sha1.digest());var s=e.entity===da.ConnectionEnd.client,n=s?"server finished":"client finished",i=e.session.sp;if((t=dc(i.master_secret,n,t.getBytes(),12)).getBytes()!==c)return e.error(e,{message:"Invalid verify_data in Finished message.",send:!0,alert:{level:da.Alert.Level.fatal,description:da.Alert.Description.decrypt_error}});e.session.md5.update(a),e.session.sha1.update(a),(e.session.resuming&&s||!e.session.resuming&&!s)&&(da.queue(e,da.createRecord(e,{type:da.ContentType.change_cipher_spec,data:da.createChangeCipherSpec()})),e.state.current.write=e.state.pending.write,e.state.pending=null,da.queue(e,da.createRecord(e,{type:da.ContentType.handshake,data:da.createFinished(e)}))),e.expect=s?yh:Eh,e.handshaking=!1,++e.handshakes,e.peerCertificate=s?e.session.serverCertificate:e.session.clientCertificate,da.flush(e),e.isConnected=!0,e.connected(e),e.process()},da.handleAlert=function(e,r){var $,t=r.fragment,a={level:t.getByte(),description:t.getByte()};switch(a.description){case da.Alert.Description.close_notify:$="Connection closed.";break;case da.Alert.Description.unexpected_message:$="Unexpected message.";break;case da.Alert.Description.bad_record_mac:$="Bad record MAC.";break;case da.Alert.Description.decryption_failed:$="Decryption failed.";break;case da.Alert.Description.record_overflow:$="Record overflow.";break;case da.Alert.Description.decompression_failure:$="Decompression failed.";break;case da.Alert.Description.handshake_failure:$="Handshake failure.";break;case da.Alert.Description.bad_certificate:$="Bad certificate.";break;case da.Alert.Description.unsupported_certificate:$="Unsupported certificate.";break;case da.Alert.Description.certificate_revoked:$="Certificate revoked.";break;case da.Alert.Description.certificate_expired:$="Certificate expired.";break;case da.Alert.Description.certificate_unknown:$="Certificate unknown.";break;case da.Alert.Description.illegal_parameter:$="Illegal parameter.";break;case da.Alert.Description.unknown_ca:$="Unknown certificate authority.";break;case da.Alert.Description.access_denied:$="Access denied.";break;case da.Alert.Description.decode_error:$="Decode error.";break;case da.Alert.Description.decrypt_error:$="Decrypt error.";break;case da.Alert.Description.export_restriction:$="Export restriction.";break;case da.Alert.Description.protocol_version:$="Unsupported protocol version.";break;case da.Alert.Description.insufficient_security:$="Insufficient security.";break;case da.Alert.Description.internal_error:$="Internal error.";break;case da.Alert.Description.user_canceled:$="User canceled.";break;case da.Alert.Description.no_renegotiation:$="Renegotiation not supported.";break;default:$="Unknown error.";}if(a.description===da.Alert.Description.close_notify)return e.close();e.error(e,{message:$,send:!1,origin:e.entity===da.ConnectionEnd.client?"server":"client",alert:a}),e.process()},da.handleHandshake=function(e,r){var $=r.fragment,t=$.getByte(),a=$.getInt24();if(a>$.length())return e.fragmented=r,r.fragment=aa.util.createBuffer(),$.read-=4,e.process();e.fragmented=null,$.read-=4;var c=$.bytes(a+4);$.read+=4,t in fc[e.entity][e.expect]?(e.entity!==da.ConnectionEnd.server||e.open||e.fail||(e.handshaking=!0,e.session={version:null,extensions:{server_name:{serverNameList:[]}},cipherSuite:null,compressionMethod:null,serverCertificate:null,clientCertificate:null,md5:aa.md.md5.create(),sha1:aa.md.sha1.create()}),t!==da.HandshakeType.hello_request&&t!==da.HandshakeType.certificate_verify&&t!==da.HandshakeType.finished&&(e.session.md5.update(c),e.session.sha1.update(c)),fc[e.entity][e.expect][t](e,r,a)):da.handleUnexpected(e,r)},da.handleApplicationData=function(e,r){e.data.putBuffer(r.fragment),e.dataReady(e),e.process()},da.handleHeartbeat=function(e,r){var $=r.fragment,t=$.getByte(),a=$.getInt16(),c=$.getBytes(a);if(t===da.HeartbeatMessageType.heartbeat_request){if(e.handshaking||a>c.length)return e.process();da.queue(e,da.createRecord(e,{type:da.ContentType.heartbeat,data:da.createHeartbeat(da.HeartbeatMessageType.heartbeat_response,c)})),da.flush(e)}else if(t===da.HeartbeatMessageType.heartbeat_response){if(c!==e.expectedHeartbeatPayload)return e.process();e.heartbeatReceived&&e.heartbeatReceived(e,aa.util.createBuffer(c))}e.process()};var th=0,uh=1,Pd=2,vh=3,wh=4,Qd=5,xh=6,yh=7,zh=8,Ah=0,Bh=1,Fc=2,Ch=3,Gc=4,Dh=5,Eh=6,ca=da.handleUnexpected,Rd=da.handleChangeCipherSpec,Ca=da.handleAlert,Ga=da.handleHandshake,Sd=da.handleApplicationData,Da=da.handleHeartbeat,Hc=[];Hc[da.ConnectionEnd.client]=[[ca,Ca,Ga,ca,Da],[ca,Ca,Ga,ca,Da],[ca,Ca,Ga,ca,Da],[ca,Ca,Ga,ca,Da],[ca,Ca,Ga,ca,Da],[Rd,Ca,ca,ca,Da],[ca,Ca,Ga,ca,Da],[ca,Ca,Ga,Sd,Da],[ca,Ca,Ga,ca,Da]],Hc[da.ConnectionEnd.server]=[[ca,Ca,Ga,ca,Da],[ca,Ca,Ga,ca,Da],[ca,Ca,Ga,ca,Da],[ca,Ca,Ga,ca,Da],[Rd,Ca,ca,ca,Da],[ca,Ca,Ga,ca,Da],[ca,Ca,Ga,Sd,Da],[ca,Ca,Ga,ca,Da]];var hb=da.handleHelloRequest,Fh=da.handleServerHello,Td=da.handleCertificate,Ud=da.handleServerKeyExchange,Ic=da.handleCertificateRequest,ec=da.handleServerHelloDone,Vd=da.handleFinished,fc=[];fc[da.ConnectionEnd.client]=[[ca,ca,Fh,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca],[hb,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,Td,Ud,Ic,ec,ca,ca,ca,ca,ca,ca],[hb,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,Ud,Ic,ec,ca,ca,ca,ca,ca,ca],[hb,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,Ic,ec,ca,ca,ca,ca,ca,ca],[hb,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ec,ca,ca,ca,ca,ca,ca],[hb,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca],[hb,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,Vd],[hb,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca],[hb,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca]];var Gh=da.handleClientHello,Hh=da.handleClientKeyExchange,Ih=da.handleCertificateVerify;fc[da.ConnectionEnd.server]=[[ca,Gh,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca],[ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,Td,ca,ca,ca,ca,ca,ca,ca,ca,ca],[ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,Hh,ca,ca,ca,ca],[ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,Ih,ca,ca,ca,ca,ca],[ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca],[ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,Vd],[ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca],[ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca,ca]],da.generateKeys=function(e,r){var $=dc,t=r.client_random+r.server_random;e.session.resuming||(r.master_secret=$(r.pre_master_secret,"master secret",t,48).bytes(),r.pre_master_secret=null),t=r.server_random+r.client_random;var a=2*r.mac_key_length+2*r.enc_key_length,c=e.version.major===da.Versions.TLS_1_0.major&&e.version.minor===da.Versions.TLS_1_0.minor;c&&(a+=2*r.fixed_iv_length);var s=$(r.master_secret,"key expansion",t,a),n={client_write_MAC_key:s.getBytes(r.mac_key_length),server_write_MAC_key:s.getBytes(r.mac_key_length),client_write_key:s.getBytes(r.enc_key_length),server_write_key:s.getBytes(r.enc_key_length)};return c&&(n.client_write_IV=s.getBytes(r.fixed_iv_length),n.server_write_IV=s.getBytes(r.fixed_iv_length)),n},da.createConnectionState=function(e){var r=e.entity===da.ConnectionEnd.client,$=function(){var e={sequenceNumber:[0,0],macKey:null,macLength:0,macFunction:null,cipherState:null,cipherFunction:function(e){return!0},compressionState:null,compressFunction:function(e){return!0},updateSequenceNumber:function(){4294967295===e.sequenceNumber[1]?(e.sequenceNumber[1]=0,++e.sequenceNumber[0]):++e.sequenceNumber[1]}};return e},t={read:$(),write:$()};if(t.read.update=function(e,r){return t.read.cipherFunction(r,t.read)?t.read.compressFunction(e,r,t.read)||e.error(e,{message:"Could not decompress record.",send:!0,alert:{level:da.Alert.Level.fatal,description:da.Alert.Description.decompression_failure}}):e.error(e,{message:"Could not decrypt record or bad MAC.",send:!0,alert:{level:da.Alert.Level.fatal,description:da.Alert.Description.bad_record_mac}}),!e.fail},t.write.update=function(e,r){return t.write.compressFunction(e,r,t.write)?t.write.cipherFunction(r,t.write)||e.error(e,{message:"Could not encrypt record.",send:!1,alert:{level:da.Alert.Level.fatal,description:da.Alert.Description.internal_error}}):e.error(e,{message:"Could not compress record.",send:!1,alert:{level:da.Alert.Level.fatal,description:da.Alert.Description.internal_error}}),!e.fail},e.session){var a=e.session.sp;switch(e.session.cipherSuite.initSecurityParameters(a),a.keys=da.generateKeys(e,a),t.read.macKey=r?a.keys.server_write_MAC_key:a.keys.client_write_MAC_key,t.write.macKey=r?a.keys.client_write_MAC_key:a.keys.server_write_MAC_key,e.session.cipherSuite.initConnectionState(t,e,a),a.compression_algorithm){case da.CompressionMethod.none:break;case da.CompressionMethod.deflate:t.read.compressFunction=sh,t.write.compressFunction=rh;break;default:throw new Error("Unsupported compression algorithm.");}}return t},da.createRandom=function(){var e=new Date,r=+e+6e4*e.getTimezoneOffset(),$=aa.util.createBuffer();return $.putInt32(r),$.putBytes(aa.random.getBytes(28)),$},da.createRecord=function(e,r){return r.data?{type:r.type,version:{major:e.version.major,minor:e.version.minor},length:r.data.length(),fragment:r.data}:null},da.createAlert=function(e,r){var $=aa.util.createBuffer();return $.putByte(r.level),$.putByte(r.description),da.createRecord(e,{type:da.ContentType.alert,data:$})},da.createClientHello=function(e){e.session.clientHelloVersion={major:e.version.major,minor:e.version.minor};for(var r=aa.util.createBuffer(),$=0;$<e.cipherSuites.length;++$){var t=e.cipherSuites[$];r.putByte(t.id[0]),r.putByte(t.id[1])}var a=r.length(),c=aa.util.createBuffer();c.putByte(da.CompressionMethod.none);var s=c.length(),n=aa.util.createBuffer();if(e.virtualHost){var i=aa.util.createBuffer();i.putByte(0),i.putByte(0);var v=aa.util.createBuffer();v.putByte(0),Qa(v,2,aa.util.createBuffer(e.virtualHost));var l=aa.util.createBuffer();Qa(l,2,v),Qa(i,2,l),n.putBuffer(i)}var o=n.length();o>0&&(o+=2);var A=e.session.id,T=A.length+1+2+4+28+2+a+1+s+o,_=aa.util.createBuffer();return _.putByte(da.HandshakeType.client_hello),_.putInt24(T),_.putByte(e.version.major),_.putByte(e.version.minor),_.putBytes(e.session.sp.client_random),Qa(_,1,aa.util.createBuffer(A)),Qa(_,2,r),Qa(_,1,c),o>0&&Qa(_,2,n),_},da.createServerHello=function(e){var r=e.session.id,$=r.length+1+2+4+28+2+1,t=aa.util.createBuffer();return t.putByte(da.HandshakeType.server_hello),t.putInt24($),t.putByte(e.version.major),t.putByte(e.version.minor),t.putBytes(e.session.sp.server_random),Qa(t,1,aa.util.createBuffer(r)),t.putByte(e.session.cipherSuite.id[0]),t.putByte(e.session.cipherSuite.id[1]),t.putByte(e.session.compressionMethod),t},da.createCertificate=function(e){var r,$=e.entity===da.ConnectionEnd.client,t=null;e.getCertificate&&(r=$?e.session.certificateRequest:e.session.extensions.server_name.serverNameList,t=e.getCertificate(e,r));var a=aa.util.createBuffer();if(null!==t)try{aa.util.isArray(t)||(t=[t]);for(var c=null,s=0;s<t.length;++s){var n=aa.pem.decode(t[s])[0];if("CERTIFICATE"!==n.type&&"X509 CERTIFICATE"!==n.type&&"TRUSTED CERTIFICATE"!==n.type){var i=new Error("Could not convert certificate from PEM; PEM header type is not \"CERTIFICATE\", \"X509 CERTIFICATE\", or \"TRUSTED CERTIFICATE\".");throw i.headerType=n.type,i}if(n.procType&&"ENCRYPTED"===n.procType.type)throw new Error("Could not convert certificate from PEM; PEM is encrypted.");var v=aa.util.createBuffer(n.body);null===c&&(c=aa.asn1.fromDer(v.bytes(),!1));var l=aa.util.createBuffer();Qa(l,3,v),a.putBuffer(l)}t=aa.pki.certificateFromAsn1(c),$?e.session.clientCertificate=t:e.session.serverCertificate=t}catch(T){return e.error(e,{message:"Could not send certificate list.",cause:T,send:!0,alert:{level:da.Alert.Level.fatal,description:da.Alert.Description.bad_certificate}})}var o=3+a.length(),A=aa.util.createBuffer();return A.putByte(da.HandshakeType.certificate),A.putInt24(o),Qa(A,3,a),A},da.createClientKeyExchange=function(e){var r=aa.util.createBuffer();r.putByte(e.session.clientHelloVersion.major),r.putByte(e.session.clientHelloVersion.minor),r.putBytes(aa.random.getBytes(46));var $=e.session.sp;$.pre_master_secret=r.getBytes();var t=(r=e.session.serverCertificate.publicKey.encrypt($.pre_master_secret)).length+2,a=aa.util.createBuffer();return a.putByte(da.HandshakeType.client_key_exchange),a.putInt24(t),a.putInt16(r.length),a.putBytes(r),a},da.createServerKeyExchange=function(e){var r=aa.util.createBuffer();return r},da.getClientSignature=function(e,r){var $=aa.util.createBuffer();$.putBuffer(e.session.md5.digest()),$.putBuffer(e.session.sha1.digest()),$=$.getBytes(),e.getSignature=e.getSignature||function(e,r,$){var t=null;if(e.getPrivateKey)try{t=e.getPrivateKey(e,e.session.clientCertificate),t=aa.pki.privateKeyFromPem(t)}catch(a){e.error(e,{message:"Could not get private key.",cause:a,send:!0,alert:{level:da.Alert.Level.fatal,description:da.Alert.Description.internal_error}})}null===t?e.error(e,{message:"No private key set.",send:!0,alert:{level:da.Alert.Level.fatal,description:da.Alert.Description.internal_error}}):r=t.sign(r,null),$(e,r)},e.getSignature(e,$,r)},da.createCertificateVerify=function(e,r){var $=r.length+2,t=aa.util.createBuffer();return t.putByte(da.HandshakeType.certificate_verify),t.putInt24($),t.putInt16(r.length),t.putBytes(r),t},da.createCertificateRequest=function(e){var r=aa.util.createBuffer();r.putByte(1);var $=aa.util.createBuffer();for(var t in e.caStore.certs){var a=e.caStore.certs[t],c=aa.pki.distinguishedNameToAsn1(a.subject),s=aa.asn1.toDer(c);$.putInt16(s.length()),$.putBuffer(s)}var n=1+r.length()+2+$.length(),i=aa.util.createBuffer();return i.putByte(da.HandshakeType.certificate_request),i.putInt24(n),Qa(i,1,r),Qa(i,2,$),i},da.createServerHelloDone=function(e){var r=aa.util.createBuffer();return r.putByte(da.HandshakeType.server_hello_done),r.putInt24(0),r},da.createChangeCipherSpec=function(){var e=aa.util.createBuffer();return e.putByte(1),e},da.createFinished=function(e){var r=aa.util.createBuffer();r.putBuffer(e.session.md5.digest()),r.putBuffer(e.session.sha1.digest());var $=e.entity===da.ConnectionEnd.client,t=e.session.sp,a=$?"client finished":"server finished";r=dc(t.master_secret,a,r.getBytes(),12);var c=aa.util.createBuffer();return c.putByte(da.HandshakeType.finished),c.putInt24(r.length()),c.putBuffer(r),c},da.createHeartbeat=function(e,r,$){void 0===$&&($=r.length);var t=aa.util.createBuffer();t.putByte(e),t.putInt16($),t.putBytes(r);var a=t.length(),c=Math.max(16,a-$-3);return t.putBytes(aa.random.getBytes(c)),t},da.queue=function(e,r){if(r&&(0!==r.fragment.length()||r.type!==da.ContentType.handshake&&r.type!==da.ContentType.alert&&r.type!==da.ContentType.change_cipher_spec)){if(r.type===da.ContentType.handshake){var $=r.fragment.bytes();e.session.md5.update($),e.session.sha1.update($),$=null}var t;if(r.fragment.length()<=da.MaxFragment)t=[r];else{t=[];for(var a=r.fragment.bytes();a.length>da.MaxFragment;)t.push(da.createRecord(e,{type:r.type,data:aa.util.createBuffer(a.slice(0,da.MaxFragment))})),a=a.slice(da.MaxFragment);a.length>0&&t.push(da.createRecord(e,{type:r.type,data:aa.util.createBuffer(a)}))}for(var c=0;c<t.length&&!e.fail;++c){var s=t[c];e.state.current.write.update(e,s)&&e.records.push(s)}}},da.flush=function(e){for(var r=0;r<e.records.length;++r){var $=e.records[r];e.tlsData.putByte($.type),e.tlsData.putByte($.version.major),e.tlsData.putByte($.version.minor),e.tlsData.putInt16($.fragment.length()),e.tlsData.putBuffer(e.records[r].fragment)}return e.records=[],e.tlsDataReady(e)};var Jc=function(e){switch(e){case!0:return!0;case aa.pki.certificateError.bad_certificate:return da.Alert.Description.bad_certificate;case aa.pki.certificateError.unsupported_certificate:return da.Alert.Description.unsupported_certificate;case aa.pki.certificateError.certificate_revoked:return da.Alert.Description.certificate_revoked;case aa.pki.certificateError.certificate_expired:return da.Alert.Description.certificate_expired;case aa.pki.certificateError.certificate_unknown:return da.Alert.Description.certificate_unknown;case aa.pki.certificateError.unknown_ca:return da.Alert.Description.unknown_ca;default:return da.Alert.Description.bad_certificate;}},Jh=function(e){switch(e){case!0:return!0;case da.Alert.Description.bad_certificate:return aa.pki.certificateError.bad_certificate;case da.Alert.Description.unsupported_certificate:return aa.pki.certificateError.unsupported_certificate;case da.Alert.Description.certificate_revoked:return aa.pki.certificateError.certificate_revoked;case da.Alert.Description.certificate_expired:return aa.pki.certificateError.certificate_expired;case da.Alert.Description.certificate_unknown:return aa.pki.certificateError.certificate_unknown;case da.Alert.Description.unknown_ca:return aa.pki.certificateError.unknown_ca;default:return aa.pki.certificateError.bad_certificate;}};for(var Kc in da.verifyCertificateChain=function(e,r){try{var $={};for(var t in e.verifyOptions)$[t]=e.verifyOptions[t];$.verify=function(r,$,t){Jc(r);var a=e.verify(e,r,$,t);if(!0!==a){if("object"==typeof a&&!aa.util.isArray(a)){var c=new Error("The application rejected the certificate.");throw c.send=!0,c.alert={level:da.Alert.Level.fatal,description:da.Alert.Description.bad_certificate},a.message&&(c.message=a.message),a.alert&&(c.alert.description=a.alert),c}a!==r&&(a=Jh(a))}return a},aa.pki.verifyCertificateChain(e.caStore,r,$)}catch(c){var a=c;("object"!=typeof a||aa.util.isArray(a))&&(a={send:!0,alert:{level:da.Alert.Level.fatal,description:Jc(c)}}),"send"in a||(a.send=!0),"alert"in a||(a.alert={level:da.Alert.Level.fatal,description:Jc(a.error)}),e.error(e,a)}return!e.fail},da.createSessionCache=function(e,r){var $=null;if(e&&e.getSession&&e.setSession&&e.order)$=e;else{for(var t in($={}).cache=e||{},$.capacity=Math.max(r||100,1),$.order=[],e)$.order.length<=r?$.order.push(t):delete e[t];$.getSession=function(e){var r=null,t=null;if(e?t=aa.util.bytesToHex(e):$.order.length>0&&(t=$.order[0]),null!==t&&t in $.cache)for(var a in r=$.cache[t],delete $.cache[t],$.order)if($.order[a]===t){$.order.splice(a,1);break}return r},$.setSession=function(e,r){if($.order.length===$.capacity){var t=$.order.shift();delete $.cache[t]}t=aa.util.bytesToHex(e);$.order.push(t),$.cache[t]=r}}return $},da.createConnection=function(e){var r=null;r=e.caStore?aa.util.isArray(e.caStore)?aa.pki.createCaStore(e.caStore):e.caStore:aa.pki.createCaStore();var $=e.cipherSuites||null;if(null===$)for(var t in $=[],da.CipherSuites)$.push(da.CipherSuites[t]);var a=e.server?da.ConnectionEnd.server:da.ConnectionEnd.client,c=e.sessionCache?da.createSessionCache(e.sessionCache):null,s={version:{major:da.Version.major,minor:da.Version.minor},entity:a,sessionId:e.sessionId,caStore:r,sessionCache:c,cipherSuites:$,connected:e.connected,virtualHost:e.virtualHost||null,verifyClient:e.verifyClient||!1,verify:e.verify||function(e,r,$,t){return r},verifyOptions:e.verifyOptions||{},getCertificate:e.getCertificate||null,getPrivateKey:e.getPrivateKey||null,getSignature:e.getSignature||null,input:aa.util.createBuffer(),tlsData:aa.util.createBuffer(),data:aa.util.createBuffer(),tlsDataReady:e.tlsDataReady,dataReady:e.dataReady,heartbeatReceived:e.heartbeatReceived,closed:e.closed,error:function(r,$){$.origin=$.origin||(r.entity===da.ConnectionEnd.client?"client":"server"),$.send&&(da.queue(r,da.createAlert(r,$.alert)),da.flush(r));var t=!1!==$.fatal;t&&(r.fail=!0),e.error(r,$),t&&r.close(!1)},deflate:e.deflate||null,inflate:e.inflate||null,reset:function(e){s.version={major:da.Version.major,minor:da.Version.minor},s.record=null,s.session=null,s.peerCertificate=null,s.state={pending:null,current:null},s.expect=s.entity===da.ConnectionEnd.client?th:Ah,s.fragmented=null,s.records=[],s.open=!1,s.handshakes=0,s.handshaking=!1,s.isConnected=!1,s.fail=!(e||void 0===e),s.input.clear(),s.tlsData.clear(),s.data.clear(),s.state.current=da.createConnectionState(s)}};s.reset();return s.handshake=function(e){if(s.entity!==da.ConnectionEnd.client)s.error(s,{message:"Cannot initiate handshake as a server.",fatal:!1});else if(s.handshaking)s.error(s,{message:"Handshake already in progress.",fatal:!1});else{s.fail&&!s.open&&0===s.handshakes&&(s.fail=!1),s.handshaking=!0;var r=null;(e=e||"").length>0&&(s.sessionCache&&(r=s.sessionCache.getSession(e)),null===r&&(e="")),0===e.length&&s.sessionCache&&null!==(r=s.sessionCache.getSession())&&(e=r.id),s.session={id:e,version:null,cipherSuite:null,compressionMethod:null,serverCertificate:null,certificateRequest:null,clientCertificate:null,sp:{},md5:aa.md.md5.create(),sha1:aa.md.sha1.create()},r&&(s.version=r.version,s.session.sp=r.sp),s.session.sp.client_random=da.createRandom().getBytes(),s.open=!0,da.queue(s,da.createRecord(s,{type:da.ContentType.handshake,data:da.createClientHello(s)})),da.flush(s)}},s.process=function(e){var r=0;return e&&s.input.putBytes(e),s.fail||(null!==s.record&&s.record.ready&&s.record.fragment.isEmpty()&&(s.record=null),null===s.record&&(r=function(e){var r=0,$=e.input,t=$.length();if(t<5)r=5-t;else{e.record={type:$.getByte(),version:{major:$.getByte(),minor:$.getByte()},length:$.getInt16(),fragment:aa.util.createBuffer(),ready:!1};var a=e.record.version.major===e.version.major;a&&e.session&&e.session.version&&(a=e.record.version.minor===e.version.minor),a||e.error(e,{message:"Incompatible TLS version.",send:!0,alert:{level:da.Alert.Level.fatal,description:da.Alert.Description.protocol_version}})}return r}(s)),s.fail||null===s.record||s.record.ready||(r=function(e){var r=0,$=e.input,t=$.length();t<e.record.length?r=e.record.length-t:(e.record.fragment.putBytes($.getBytes(e.record.length)),$.compact(),e.state.current.read.update(e,e.record)&&(null!==e.fragmented&&(e.fragmented.type===e.record.type?(e.fragmented.fragment.putBuffer(e.record.fragment),e.record=e.fragmented):e.error(e,{message:"Invalid fragmented record.",send:!0,alert:{level:da.Alert.Level.fatal,description:da.Alert.Description.unexpected_message}})),e.record.ready=!0));return r}(s)),!s.fail&&null!==s.record&&s.record.ready&&function(e,r){var $=r.type-da.ContentType.change_cipher_spec,t=Hc[e.entity][e.expect];$ in t?t[$](e,r):da.handleUnexpected(e,r)}(s,s.record)),r},s.prepare=function(e){return da.queue(s,da.createRecord(s,{type:da.ContentType.application_data,data:aa.util.createBuffer(e)})),da.flush(s)},s.prepareHeartbeatRequest=function(e,r){return e instanceof aa.util.ByteBuffer&&(e=e.bytes()),void 0===r&&(r=e.length),s.expectedHeartbeatPayload=e,da.queue(s,da.createRecord(s,{type:da.ContentType.heartbeat,data:da.createHeartbeat(da.HeartbeatMessageType.heartbeat_request,e,r)})),da.flush(s)},s.close=function(e){if(!s.fail&&s.sessionCache&&s.session){var r={id:s.session.id,version:s.session.version,sp:s.session.sp};r.sp.keys=null,s.sessionCache.setSession(r.id,r)}s.open&&(s.open=!1,s.input.clear(),(s.isConnected||s.handshaking)&&(s.isConnected=s.handshaking=!1,da.queue(s,da.createAlert(s,{level:da.Alert.Level.warning,description:da.Alert.Description.close_notify})),da.flush(s)),s.closed(s)),s.reset(e)},s},da)"function"!=typeof da[Kc]&&(aa.tls[Kc]=da[Kc]);aa.tls.prf_tls1=dc,aa.tls.hmac_sha1=qh,aa.tls.createSessionCache=da.createSessionCache,aa.tls.createConnection=da.createConnection;var Ra=aa.tls;function Wd(e,t,r){var a=t.entity===aa.tls.ConnectionEnd.client;e.read.cipherState={init:!1,cipher:aa.cipher.createDecipher("AES-CBC",a?r.keys.server_write_key:r.keys.client_write_key),iv:a?r.keys.server_write_IV:r.keys.client_write_IV},e.write.cipherState={init:!1,cipher:aa.cipher.createCipher("AES-CBC",a?r.keys.client_write_key:r.keys.server_write_key),iv:a?r.keys.client_write_IV:r.keys.server_write_IV},e.read.cipherFunction=Nh,e.write.cipherFunction=Kh,e.read.macLength=e.write.macLength=r.mac_length,e.read.macFunction=e.write.macFunction=Ra.hmac_sha1}function Kh(e,t){var r,a=!1,i=t.macFunction(t.macKey,t.sequenceNumber,e);e.fragment.putBytes(i),t.updateSequenceNumber(),r=e.version.minor===Ra.Versions.TLS_1_0.minor?t.cipherState.init?null:t.cipherState.iv:aa.random.getBytesSync(16),t.cipherState.init=!0;var n=t.cipherState.cipher;return n.start({iv:r}),e.version.minor>=Ra.Versions.TLS_1_1.minor&&n.output.putBytes(r),n.update(e.fragment),n.finish(Lh)&&(e.fragment=n.output,e.length=e.fragment.length(),a=!0),a}function Lh(e,t,r){if(!r){var a=e-t.length()%e;t.fillWithByte(a-1,a)}return!0}function Mh(e,t,r){var a=!0;if(r){for(var i=t.length(),n=t.last(),c=i-1-n;c<i-1;++c)a=a&&t.at(c)==n;a&&t.truncate(n+1)}return a}function Nh(e,t){var r,a=!1;r=e.version.minor===Ra.Versions.TLS_1_0.minor?t.cipherState.init?null:t.cipherState.iv:e.fragment.getBytes(16),t.cipherState.init=!0;var i=t.cipherState.cipher;i.start({iv:r}),i.update(e.fragment),a=i.finish(Mh);var n=t.macLength,c=aa.random.getBytesSync(n),$=i.output.length();$>=n?(e.fragment=i.output.getBytes($-n),c=i.output.getBytes(n)):e.fragment=i.output.getBytes(),e.fragment=aa.util.createBuffer(e.fragment),e.length=e.fragment.length();var _=t.macFunction(t.macKey,t.sequenceNumber,e);return t.updateSequenceNumber(),a=Oh(t.macKey,c,_)&&a}function Oh(e,t,r){var a=aa.hmac.create();return a.start("SHA1",e),a.update(t),t=a.digest().getBytes(),a.start(null,null),a.update(r),t===(r=a.digest().getBytes())}Ra.CipherSuites.TLS_RSA_WITH_AES_128_CBC_SHA={id:[0,47],name:"TLS_RSA_WITH_AES_128_CBC_SHA",initSecurityParameters:function(e){e.bulk_cipher_algorithm=Ra.BulkCipherAlgorithm.aes,e.cipher_type=Ra.CipherType.block,e.enc_key_length=16,e.block_length=16,e.fixed_iv_length=16,e.record_iv_length=16,e.mac_algorithm=Ra.MACAlgorithm.hmac_sha1,e.mac_length=20,e.mac_key_length=20},initConnectionState:Wd},Ra.CipherSuites.TLS_RSA_WITH_AES_256_CBC_SHA={id:[0,53],name:"TLS_RSA_WITH_AES_256_CBC_SHA",initSecurityParameters:function(e){e.bulk_cipher_algorithm=Ra.BulkCipherAlgorithm.aes,e.cipher_type=Ra.CipherType.block,e.enc_key_length=32,e.block_length=16,e.fixed_iv_length=16,e.record_iv_length=16,e.mac_algorithm=Ra.MACAlgorithm.hmac_sha1,e.mac_length=20,e.mac_key_length=20},initConnectionState:Wd};aa.debug.storage={},aa.debug.get=function(e,$){var r;return void 0===e?r=aa.debug.storage:e in aa.debug.storage&&(r=void 0===$?aa.debug.storage[e]:aa.debug.storage[e][$]),r},aa.debug.set=function(e,$,r){e in aa.debug.storage||(aa.debug.storage[e]={}),aa.debug.storage[e][$]=r},aa.debug.clear=function(e,$){void 0===e?aa.debug.storage={}:e in aa.debug.storage&&(void 0===$?delete aa.debug.storage[e]:delete aa.debug.storage[e][$])};var Ob=aa.sha512=aa.sha512||{};aa.md.sha512=aa.md.algorithms.sha512=Ob;var Xd=aa.sha384=aa.sha512.sha384=aa.sha512.sha384||{};Xd.create=function(){return Ob.create("SHA-384")},aa.md.sha384=aa.md.algorithms.sha384=Xd,aa.sha512.sha256=aa.sha512.sha256||{create:function(){return Ob.create("SHA-512/256")}},aa.md["sha512/256"]=aa.md.algorithms["sha512/256"]=aa.sha512.sha256,aa.sha512.sha224=aa.sha512.sha224||{create:function(){return Ob.create("SHA-512/224")}},aa.md["sha512/224"]=aa.md.algorithms["sha512/224"]=aa.sha512.sha224,Ob.create=function(a){if(Qh||Rh(),void 0===a&&(a="SHA-512"),!(a in Pb))throw new Error("Invalid SHA-512 algorithm: "+a);for(var e=Pb[a],r=null,$=aa.util.createBuffer(),t=new Array(80),s=0;s<80;++s)t[s]=new Array(2);var g=64;switch(a){case"SHA-384":g=48;break;case"SHA-512/256":g=32;break;case"SHA-512/224":g=28;}var n={algorithm:a.replace("-","").toLowerCase(),blockLength:128,digestLength:g,messageLength:0,fullMessageLength:null,messageLengthSize:16,start:function(){n.messageLength=0,n.fullMessageLength=n.messageLength128=[];for(var a=n.messageLengthSize/4,t=0;t<a;++t)n.fullMessageLength.push(0);$=aa.util.createBuffer(),r=new Array(e.length);for(t=0;t<e.length;++t)r[t]=e[t].slice(0);return n}};return n.start(),n.update=function(a,e){"utf8"===e&&(a=aa.util.encodeUtf8(a));var s=a.length;n.messageLength+=s,s=[s/4294967296>>>0,s>>>0];for(var g=n.fullMessageLength.length-1;g>=0;--g)n.fullMessageLength[g]+=s[1],s[1]=s[0]+(n.fullMessageLength[g]/4294967296>>>0),n.fullMessageLength[g]=n.fullMessageLength[g]>>>0,s[0]=s[1]/4294967296>>>0;return $.putBytes(a),Zd(r,t,$),($.read>2048||0===$.length())&&$.compact(),n},n.digest=function(){var e=aa.util.createBuffer();e.putBytes($.bytes());var s,g=n.fullMessageLength[n.fullMessageLength.length-1]+n.messageLengthSize&n.blockLength-1;e.putBytes(Ph.substr(0,n.blockLength-g));for(var h=8*n.fullMessageLength[0],A=0;A<n.fullMessageLength.length-1;++A)h+=(s=8*n.fullMessageLength[A+1])/4294967296>>>0,e.putInt32(h>>>0),h=s>>>0;e.putInt32(h);var l=new Array(r.length);for(A=0;A<r.length;++A)l[A]=r[A].slice(0);Zd(l,t,e);var v,f=aa.util.createBuffer();v="SHA-512"===a?l.length:"SHA-384"===a?l.length-2:l.length-4;for(A=0;A<v;++A)f.putInt32(l[A][0]),A===v-1&&"SHA-512/224"===a||f.putInt32(l[A][1]);return f},n};var Ph=null,Qh=!1,Yd=null,Pb=null;function Rh(){Ph=String.fromCharCode(128),Ph+=aa.util.fillString(String.fromCharCode(0),128),Yd=[[1116352408,3609767458],[1899447441,602891725],[3049323471,3964484399],[3921009573,2173295548],[961987163,4081628472],[1508970993,3053834265],[2453635748,2937671579],[2870763221,3664609560],[3624381080,2734883394],[310598401,1164996542],[607225278,1323610764],[1426881987,3590304994],[1925078388,4068182383],[2162078206,991336113],[2614888103,633803317],[3248222580,3479774868],[3835390401,2666613458],[4022224774,944711139],[264347078,2341262773],[604807628,2007800933],[770255983,1495990901],[1249150122,1856431235],[1555081692,3175218132],[1996064986,2198950837],[2554220882,3999719339],[2821834349,766784016],[2952996808,2566594879],[3210313671,3203337956],[3336571891,1034457026],[3584528711,2466948901],[113926993,3758326383],[338241895,168717936],[666307205,1188179964],[773529912,1546045734],[1294757372,1522805485],[1396182291,2643833823],[1695183700,2343527390],[1986661051,1014477480],[2177026350,1206759142],[2456956037,344077627],[2730485921,1290863460],[2820302411,3158454273],[3259730800,3505952657],[3345764771,106217008],[3516065817,3606008344],[3600352804,1432725776],[4094571909,1467031594],[275423344,851169720],[430227734,3100823752],[506948616,1363258195],[659060556,3750685593],[883997877,3785050280],[958139571,3318307427],[1322822218,3812723403],[1537002063,2003034995],[1747873779,3602036899],[1955562222,1575990012],[2024104815,1125592928],[2227730452,2716904306],[2361852424,442776044],[2428436474,593698344],[2756734187,3733110249],[3204031479,2999351573],[3329325298,3815920427],[3391569614,3928383900],[3515267271,566280711],[3940187606,3454069534],[4118630271,4000239992],[116418474,1914138554],[174292421,2731055270],[289380356,3203993006],[460393269,320620315],[685471733,587496836],[852142971,1086792851],[1017036298,365543100],[1126000580,2618297676],[1288033470,3409855158],[1501505948,4234509866],[1607167915,987167468],[1816402316,1246189591]],(Pb={})["SHA-512"]=[[1779033703,4089235720],[3144134277,2227873595],[1013904242,4271175723],[2773480762,1595750129],[1359893119,2917565137],[2600822924,725511199],[528734635,4215389547],[1541459225,327033209]],Pb["SHA-384"]=[[3418070365,3238371032],[1654270250,914150663],[2438529370,812702999],[355462360,4144912697],[1731405415,4290775857],[2394180231,1750603025],[3675008525,1694076839],[1203062813,3204075428]],Pb["SHA-512/256"]=[[573645204,4230739756],[2673172387,3360449730],[596883563,1867755857],[2520282905,1497426621],[2519219938,2827943907],[3193839141,1401305490],[721525244,746961066],[246885852,2177182882]],Pb["SHA-512/224"]=[[2352822216,424955298],[1944164710,2312950998],[502970286,855612546],[1738396948,1479516111],[258812777,2077511080],[2011393907,79989058],[1067287976,1780299464],[286451373,2446758561]],Qh=!0}function Zd(a,e,r){for(var $,t,s,g,n,h,A,l,v,f,o,D,u,i,c,d,m,L,p,_,S,H,M,k,w,y,b,B,I,z,C,q,x,E=r.length();E>=128;){for(b=0;b<16;++b)e[b][0]=r.getInt32()>>>0,e[b][1]=r.getInt32()>>>0;for(;b<80;++b)$=(((B=(z=e[b-2])[0])>>>19|(I=z[1])<<13)^(I>>>29|B<<3)^B>>>6)>>>0,t=((B<<13|I>>>19)^(I<<3|B>>>29)^(B<<26|I>>>6))>>>0,s=(((B=(q=e[b-15])[0])>>>1|(I=q[1])<<31)^(B>>>8|I<<24)^B>>>7)>>>0,g=((B<<31|I>>>1)^(B<<24|I>>>8)^(B<<25|I>>>7))>>>0,C=e[b-7],x=e[b-16],I=t+C[1]+g+x[1],e[b][0]=$+C[0]+s+x[0]+(I/4294967296>>>0)>>>0,e[b][1]=I>>>0;for(o=a[0][0],D=a[0][1],u=a[1][0],i=a[1][1],c=a[2][0],d=a[2][1],m=a[3][0],L=a[3][1],p=a[4][0],_=a[4][1],S=a[5][0],H=a[5][1],M=a[6][0],k=a[6][1],w=a[7][0],y=a[7][1],b=0;b<80;++b)A=((p>>>14|_<<18)^(p>>>18|_<<14)^(_>>>9|p<<23))>>>0,l=(M^p&(S^M))>>>0,n=((o>>>28|D<<4)^(D>>>2|o<<30)^(D>>>7|o<<25))>>>0,h=((o<<4|D>>>28)^(D<<30|o>>>2)^(D<<25|o>>>7))>>>0,v=(o&u|c&(o^u))>>>0,f=(D&i|d&(D^i))>>>0,I=y+(((p<<18|_>>>14)^(p<<14|_>>>18)^(_<<23|p>>>9))>>>0)+((k^_&(H^k))>>>0)+Yd[b][1]+e[b][1],$=w+A+l+Yd[b][0]+e[b][0]+(I/4294967296>>>0)>>>0,t=I>>>0,s=n+v+((I=h+f)/4294967296>>>0)>>>0,g=I>>>0,w=M,y=k,M=S,k=H,S=p,H=_,p=m+$+((I=L+t)/4294967296>>>0)>>>0,_=I>>>0,m=c,L=d,c=u,d=i,u=o,i=D,o=$+s+((I=t+g)/4294967296>>>0)>>>0,D=I>>>0;I=a[0][1]+D,a[0][0]=a[0][0]+o+(I/4294967296>>>0)>>>0,a[0][1]=I>>>0,I=a[1][1]+i,a[1][0]=a[1][0]+u+(I/4294967296>>>0)>>>0,a[1][1]=I>>>0,I=a[2][1]+d,a[2][0]=a[2][0]+c+(I/4294967296>>>0)>>>0,a[2][1]=I>>>0,I=a[3][1]+L,a[3][0]=a[3][0]+m+(I/4294967296>>>0)>>>0,a[3][1]=I>>>0,I=a[4][1]+_,a[4][0]=a[4][0]+p+(I/4294967296>>>0)>>>0,a[4][1]=I>>>0,I=a[5][1]+H,a[5][0]=a[5][0]+S+(I/4294967296>>>0)>>>0,a[5][1]=I>>>0,I=a[6][1]+k,a[6][0]=a[6][0]+M+(I/4294967296>>>0)>>>0,a[6][1]=I>>>0,I=a[7][1]+y,a[7][0]=a[7][0]+w+(I/4294967296>>>0)>>>0,a[7][1]=I>>>0,E-=128}}var Ba=aa.asn1,Sh={name:"PrivateKeyInfo",tagClass:Ba.Class.UNIVERSAL,type:Ba.Type.SEQUENCE,constructed:!0,value:[{name:"PrivateKeyInfo.version",tagClass:Ba.Class.UNIVERSAL,type:Ba.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"PrivateKeyInfo.privateKeyAlgorithm",tagClass:Ba.Class.UNIVERSAL,type:Ba.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:Ba.Class.UNIVERSAL,type:Ba.Type.OID,constructed:!1,capture:"privateKeyOid"}]},{name:"PrivateKeyInfo",tagClass:Ba.Class.UNIVERSAL,type:Ba.Type.OCTETSTRING,constructed:!1,capture:"privateKey"}]};var Th={name:"SubjectPublicKeyInfo",tagClass:Ba.Class.UNIVERSAL,type:Ba.Type.SEQUENCE,constructed:!0,captureAsn1:"subjectPublicKeyInfo",value:[{name:"SubjectPublicKeyInfo.AlgorithmIdentifier",tagClass:Ba.Class.UNIVERSAL,type:Ba.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:Ba.Class.UNIVERSAL,type:Ba.Type.OID,constructed:!1,capture:"publicKeyOid"}]},{tagClass:Ba.Class.UNIVERSAL,type:Ba.Type.BITSTRING,constructed:!1,composed:!0,captureBitStringValue:"ed25519PublicKey"}]};var Ab=(ab(),{}).Buffer;var Uh=Th,Vh=Sh;if(void 0===Wh)var Wh=aa.jsbn.BigInteger;var Lc=aa.util.ByteBuffer,La=void 0===Ab?Uint8Array:Ab;aa.pki=aa.pki||{};var va=aa.ed25519;function cb($){var r=$.message;if(r instanceof Uint8Array||r instanceof La)return r;var a=$.encoding;if(void 0===r){if(!$.md)throw new TypeError("\"options.message\" or \"options.md\" not specified.");r=$.md.digest().getBytes(),a="binary"}if("string"==typeof r&&!a)throw new TypeError("\"options.encoding\" must be \"binary\" or \"utf8\".");if("string"==typeof r){if(void 0!==Ab)return Ab.from(r,a);r=new Lc(r,a)}else if(!(r instanceof Lc))throw new TypeError("\"options.message\" must be a node.js Buffer, a Uint8Array, a forge ByteBuffer, or a string with \"options.encoding\" specifying its encoding.");for(var n=new La(r.length()),e=0;e<n.length;++e)n[e]=r.at(e);return n}va.constants={},va.constants.PUBLIC_KEY_BYTE_LENGTH=32,va.constants.PRIVATE_KEY_BYTE_LENGTH=64,va.constants.SEED_BYTE_LENGTH=32,va.constants.SIGN_BYTE_LENGTH=64,va.constants.HASH_BYTE_LENGTH=64,va.generateKeyPair=function($){var r=($=$||{}).seed;if(void 0===r)r=aa.random.getBytesSync(va.constants.SEED_BYTE_LENGTH);else if("string"==typeof r){if(r.length!==va.constants.SEED_BYTE_LENGTH)throw new TypeError("\"seed\" must be "+va.constants.SEED_BYTE_LENGTH+" bytes in length.")}else if(!(r instanceof Uint8Array))throw new TypeError("\"seed\" must be a node.js Buffer, Uint8Array, or a binary string.");r=cb({message:r,encoding:"binary"});for(var a=new La(va.constants.PUBLIC_KEY_BYTE_LENGTH),n=new La(va.constants.PRIVATE_KEY_BYTE_LENGTH),e=0;e<32;++e)n[e]=r[e];return $h(a,n),{publicKey:a,privateKey:n}},va.privateKeyFromAsn1=function($){var r={},a=[];if(!aa.asn1.validate($,Vh,r,a)){var n=new Error("Invalid Key.");throw n.errors=a,n}var e=aa.asn1.derToOid(r.privateKeyOid),v=aa.oids.EdDSA25519;if(e!==v)throw new Error("Invalid OID \""+e+"\"; OID must be \""+v+"\".");var B=r.privateKey;return{privateKeyBytes:cb({message:aa.asn1.fromDer(B).value,encoding:"binary"})}},va.publicKeyFromAsn1=function($){var r={},a=[];if(!aa.asn1.validate($,Uh,r,a)){var n=new Error("Invalid Key.");throw n.errors=a,n}var e=aa.asn1.derToOid(r.publicKeyOid),v=aa.oids.EdDSA25519;if(e!==v)throw new Error("Invalid OID \""+e+"\"; OID must be \""+v+"\".");var B=r.ed25519PublicKey;if(B.length!==va.constants.PUBLIC_KEY_BYTE_LENGTH)throw new Error("Key length is invalid.");return cb({message:B,encoding:"binary"})},va.publicKeyFromPrivateKey=function($){var r=cb({message:($=$||{}).privateKey,encoding:"binary"});if(r.length!==va.constants.PRIVATE_KEY_BYTE_LENGTH)throw new TypeError("\"options.privateKey\" must have a byte length of "+va.constants.PRIVATE_KEY_BYTE_LENGTH);for(var a=new La(va.constants.PUBLIC_KEY_BYTE_LENGTH),n=0;n<a.length;++n)a[n]=r[32+n];return a},va.sign=function($){var r=cb($=$||{}),a=cb({message:$.privateKey,encoding:"binary"});if(a.length===va.constants.SEED_BYTE_LENGTH)a=va.generateKeyPair({seed:a}).privateKey;else if(a.length!==va.constants.PRIVATE_KEY_BYTE_LENGTH)throw new TypeError("\"options.privateKey\" must have a byte length of "+va.constants.SEED_BYTE_LENGTH+" or "+va.constants.PRIVATE_KEY_BYTE_LENGTH);var n=new La(va.constants.SIGN_BYTE_LENGTH+r.length);_h(n,r,r.length,a);for(var e=new La(va.constants.SIGN_BYTE_LENGTH),v=0;v<e.length;++v)e[v]=n[v];return e},va.verify=function($){var r=cb($=$||{});if(void 0===$.signature)throw new TypeError("\"options.signature\" must be a node.js Buffer, a Uint8Array, a forge ByteBuffer, or a binary string.");var a=cb({message:$.signature,encoding:"binary"});if(a.length!==va.constants.SIGN_BYTE_LENGTH)throw new TypeError("\"options.signature\" must have a byte length of "+va.constants.SIGN_BYTE_LENGTH);var n=cb({message:$.publicKey,encoding:"binary"});if(n.length!==va.constants.PUBLIC_KEY_BYTE_LENGTH)throw new TypeError("\"options.publicKey\" must have a byte length of "+va.constants.PUBLIC_KEY_BYTE_LENGTH);var e,v=new La(va.constants.SIGN_BYTE_LENGTH+r.length),B=new La(va.constants.SIGN_BYTE_LENGTH+r.length);for(e=0;e<va.constants.SIGN_BYTE_LENGTH;++e)v[e]=a[e];for(e=0;e<r.length;++e)v[e+va.constants.SIGN_BYTE_LENGTH]=r[e];return ai(B,v,v.length,n)>=0};var Mc=oa(),gc=oa([1]),Xh=oa([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),Yh=oa([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),$d=oa([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),_d=oa([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),Nc=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]),Zh=oa([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function Qb($,r){var a=aa.md.sha512.create(),n=new Lc($);a.update(n.getBytes(r),"binary");var e=a.digest().getBytes();if(void 0!==Ab)return Ab.from(e,"binary");for(var v=new La(va.constants.HASH_BYTE_LENGTH),B=0;B<64;++B)v[B]=e.charCodeAt(B);return v}function $h($,r){var a,n=[oa(),oa(),oa(),oa()],e=Qb(r,32);for(e[0]&=248,e[31]&=127,e[31]|=64,Rc(n,e),Qc($,n),a=0;a<32;++a)r[a+32]=$[a];return 0}function _h($,r,a,n){var e,v,B=new Float64Array(64),t=[oa(),oa(),oa(),oa()],o=Qb(n,32);o[0]&=248,o[31]&=127,o[31]|=64;var f=a+64;for(e=0;e<a;++e)$[64+e]=r[e];for(e=0;e<32;++e)$[32+e]=o[32+e];var D=Qb($.subarray(32),a+32);for(Oc(D),Rc(t,D),Qc($,t),e=32;e<64;++e)$[e]=n[e];var U=Qb($,a+64);for(Oc(U),e=32;e<64;++e)B[e]=0;for(e=0;e<32;++e)B[e]=D[e];for(e=0;e<32;++e)for(v=0;v<32;v++)B[e+v]+=U[e]*o[v];return ae($.subarray(32),B),f}function ai($,r,a,n){var e,v=new La(32),B=[oa(),oa(),oa(),oa()],t=[oa(),oa(),oa(),oa()];if(-1,a<64)return-1;if(bi(t,n))return-1;for(e=0;e<a;++e)$[e]=r[e];for(e=0;e<32;++e)$[e+32]=n[e];var o=Qb($,a);if(Oc(o),fe(B,t,o),Rc(t,r.subarray(32)),Pc(B,t),Qc(v,B),a-=64,de(r,0,v,0)){for(e=0;e<a;++e)$[e]=0;return-1}for(e=0;e<a;++e)$[e]=r[e+64];return a}function ae($,r){var a,n,e,v;for(n=63;n>=32;--n){for(a=0,e=n-32,v=n-12;e<v;++e)r[e]+=a-16*r[n]*Nc[e-(n-32)],a=r[e]+128>>8,r[e]-=256*a;r[e]+=a,r[n]=0}for(a=0,e=0;e<32;++e)r[e]+=a-(r[31]>>4)*Nc[e],a=r[e]>>8,r[e]&=255;for(e=0;e<32;++e)r[e]-=a*Nc[e];for(n=0;n<32;++n)r[n+1]+=r[n]>>8,$[n]=255&r[n]}function Oc($){for(var r=new Float64Array(64),a=0;a<64;++a)r[a]=$[a],$[a]=0;ae($,r)}function Pc($,r){var a=oa(),n=oa(),e=oa(),v=oa(),B=oa(),t=oa(),o=oa(),f=oa(),D=oa();Cb(a,$[1],$[0]),Cb(D,r[1],r[0]),za(a,a,D),Bb(n,$[0],$[1]),Bb(D,r[0],r[1]),za(n,n,D),za(e,$[3],r[3]),za(e,e,Yh),za(v,$[2],r[2]),Bb(v,v,v),Cb(B,n,a),Cb(t,v,e),Bb(o,v,e),Bb(f,n,a),za($[0],B,t),za($[1],f,o),za($[2],o,t),za($[3],B,f)}function be($,r,a){for(var n=0;n<4;++n)ge($[n],r[n],a)}function Qc($,r){var a=oa(),n=oa(),e=oa();fi(e,r[2]),za(a,r[0],e),za(n,r[1],e),hc($,n),$[31]^=ee(a)<<7}function hc($,r){var a,n,e,v=oa(),B=oa();for(a=0;a<16;++a)B[a]=r[a];for(Sc(B),Sc(B),Sc(B),n=0;n<2;++n){for(v[0]=B[0]-65517,a=1;a<15;++a)v[a]=B[a]-65535-(v[a-1]>>16&1),v[a-1]&=65535;v[15]=B[15]-32767-(v[14]>>16&1),e=v[15]>>16&1,v[14]&=65535,ge(B,v,1-e)}for(a=0;a<16;a++)$[2*a]=255&B[a],$[2*a+1]=B[a]>>8}function bi($,r){var a=oa(),n=oa(),e=oa(),v=oa(),B=oa(),t=oa(),o=oa();return ib($[2],gc),ci($[1],r),ob(e,$[1]),za(v,e,Xh),Cb(e,e,$[2]),Bb(v,$[2],v),ob(B,v),ob(t,B),za(o,t,B),za(a,o,e),za(a,a,v),di(a,a),za(a,a,e),za(a,a,v),za(a,a,v),za($[0],a,v),ob(n,$[0]),za(n,n,v),ce(n,e)&&za($[0],$[0],Zh),ob(n,$[0]),za(n,n,v),ce(n,e)?-1:(ee($[0])===r[31]>>7&&Cb($[0],Mc,$[0]),za($[3],$[0],$[1]),0)}function ci($,r){var a;for(a=0;a<16;++a)$[a]=r[2*a]+(r[2*a+1]<<8);$[15]&=32767}function di($,r){var a,n=oa();for(a=0;a<16;++a)n[a]=r[a];for(a=250;a>=0;--a)ob(n,n),1!==a&&za(n,n,r);for(a=0;a<16;++a)$[a]=n[a]}function ce($,r){var a=new La(32),n=new La(32);return hc(a,$),hc(n,r),de(a,0,n,0)}function de($,r,a,n){return ei($,r,a,n,32)}function ei($,r,a,n,e){var v,B=0;for(v=0;v<e;++v)B|=$[r+v]^a[n+v];return(1&B-1>>>8)-1}function ee($){var r=new La(32);return hc(r,$),1&r[0]}function fe($,r,a){var n,e;for(ib($[0],Mc),ib($[1],gc),ib($[2],gc),ib($[3],Mc),e=255;e>=0;--e)be($,r,n=a[e/8|0]>>(7&e)&1),Pc(r,$),Pc($,$),be($,r,n)}function Rc($,r){var a=[oa(),oa(),oa(),oa()];ib(a[0],$d),ib(a[1],_d),ib(a[2],gc),za(a[3],$d,_d),fe($,a,r)}function ib($,r){var a;for(a=0;a<16;a++)$[a]=0|r[a]}function fi($,r){var a,n=oa();for(a=0;a<16;++a)n[a]=r[a];for(a=253;a>=0;--a)ob(n,n),2!==a&&4!==a&&za(n,n,r);for(a=0;a<16;++a)$[a]=n[a]}function Sc($){var r,a,n=1;for(r=0;r<16;++r)a=$[r]+n+65535,n=Math.floor(a/65536),$[r]=a-65536*n;$[0]+=n-1+37*(n-1)}function ge($,r,a){for(var n,e=~(a-1),v=0;v<16;++v)n=e&($[v]^r[v]),$[v]^=n,r[v]^=n}function oa($){var r,a=new Float64Array(16);if($)for(r=0;r<$.length;++r)a[r]=$[r];return a}function Bb($,r,a){for(var n=0;n<16;++n)$[n]=r[n]+a[n]}function Cb($,r,a){for(var n=0;n<16;++n)$[n]=r[n]-a[n]}function ob($,r){za($,r,r)}function za($,r,a){var n,e,v=0,B=0,t=0,o=0,f=0,D=0,U=0,i=0,s=0,g=0,u=0,c=0,d=0,l=0,E=0,y=0,p=0,h=0,T=0,_=0,N=0,M=0,w=0,m=0,b=0,Y=0,L=0,K=0,G=0,I=0,H=0,A=a[0],S=a[1],k=a[2],P=a[3],V=a[4],q=a[5],O=a[6],C=a[7],F=a[8],Z=a[9],R=a[10],j=a[11],X=a[12],x=a[13],z=a[14],J=a[15];v+=(n=r[0])*A,B+=n*S,t+=n*k,o+=n*P,f+=n*V,D+=n*q,U+=n*O,i+=n*C,s+=n*F,g+=n*Z,u+=n*R,c+=n*j,d+=n*X,l+=n*x,E+=n*z,y+=n*J,B+=(n=r[1])*A,t+=n*S,o+=n*k,f+=n*P,D+=n*V,U+=n*q,i+=n*O,s+=n*C,g+=n*F,u+=n*Z,c+=n*R,d+=n*j,l+=n*X,E+=n*x,y+=n*z,p+=n*J,t+=(n=r[2])*A,o+=n*S,f+=n*k,D+=n*P,U+=n*V,i+=n*q,s+=n*O,g+=n*C,u+=n*F,c+=n*Z,d+=n*R,l+=n*j,E+=n*X,y+=n*x,p+=n*z,h+=n*J,o+=(n=r[3])*A,f+=n*S,D+=n*k,U+=n*P,i+=n*V,s+=n*q,g+=n*O,u+=n*C,c+=n*F,d+=n*Z,l+=n*R,E+=n*j,y+=n*X,p+=n*x,h+=n*z,T+=n*J,f+=(n=r[4])*A,D+=n*S,U+=n*k,i+=n*P,s+=n*V,g+=n*q,u+=n*O,c+=n*C,d+=n*F,l+=n*Z,E+=n*R,y+=n*j,p+=n*X,h+=n*x,T+=n*z,_+=n*J,D+=(n=r[5])*A,U+=n*S,i+=n*k,s+=n*P,g+=n*V,u+=n*q,c+=n*O,d+=n*C,l+=n*F,E+=n*Z,y+=n*R,p+=n*j,h+=n*X,T+=n*x,_+=n*z,N+=n*J,U+=(n=r[6])*A,i+=n*S,s+=n*k,g+=n*P,u+=n*V,c+=n*q,d+=n*O,l+=n*C,E+=n*F,y+=n*Z,p+=n*R,h+=n*j,T+=n*X,_+=n*x,N+=n*z,M+=n*J,i+=(n=r[7])*A,s+=n*S,g+=n*k,u+=n*P,c+=n*V,d+=n*q,l+=n*O,E+=n*C,y+=n*F,p+=n*Z,h+=n*R,T+=n*j,_+=n*X,N+=n*x,M+=n*z,w+=n*J,s+=(n=r[8])*A,g+=n*S,u+=n*k,c+=n*P,d+=n*V,l+=n*q,E+=n*O,y+=n*C,p+=n*F,h+=n*Z,T+=n*R,_+=n*j,N+=n*X,M+=n*x,w+=n*z,m+=n*J,g+=(n=r[9])*A,u+=n*S,c+=n*k,d+=n*P,l+=n*V,E+=n*q,y+=n*O,p+=n*C,h+=n*F,T+=n*Z,_+=n*R,N+=n*j,M+=n*X,w+=n*x,m+=n*z,b+=n*J,u+=(n=r[10])*A,c+=n*S,d+=n*k,l+=n*P,E+=n*V,y+=n*q,p+=n*O,h+=n*C,T+=n*F,_+=n*Z,N+=n*R,M+=n*j,w+=n*X,m+=n*x,b+=n*z,Y+=n*J,c+=(n=r[11])*A,d+=n*S,l+=n*k,E+=n*P,y+=n*V,p+=n*q,h+=n*O,T+=n*C,_+=n*F,N+=n*Z,M+=n*R,w+=n*j,m+=n*X,b+=n*x,Y+=n*z,L+=n*J,d+=(n=r[12])*A,l+=n*S,E+=n*k,y+=n*P,p+=n*V,h+=n*q,T+=n*O,_+=n*C,N+=n*F,M+=n*Z,w+=n*R,m+=n*j,b+=n*X,Y+=n*x,L+=n*z,K+=n*J,l+=(n=r[13])*A,E+=n*S,y+=n*k,p+=n*P,h+=n*V,T+=n*q,_+=n*O,N+=n*C,M+=n*F,w+=n*Z,m+=n*R,b+=n*j,Y+=n*X,L+=n*x,K+=n*z,G+=n*J,E+=(n=r[14])*A,y+=n*S,p+=n*k,h+=n*P,T+=n*V,_+=n*q,N+=n*O,M+=n*C,w+=n*F,m+=n*Z,b+=n*R,Y+=n*j,L+=n*X,K+=n*x,G+=n*z,I+=n*J,y+=(n=r[15])*A,B+=38*(h+=n*k),t+=38*(T+=n*P),o+=38*(_+=n*V),f+=38*(N+=n*q),D+=38*(M+=n*O),U+=38*(w+=n*C),i+=38*(m+=n*F),s+=38*(b+=n*Z),g+=38*(Y+=n*R),u+=38*(L+=n*j),c+=38*(K+=n*X),d+=38*(G+=n*x),l+=38*(I+=n*z),E+=38*(H+=n*J),v=(n=(v+=38*(p+=n*S))+(e=1)+65535)-65536*(e=Math.floor(n/65536)),B=(n=B+e+65535)-65536*(e=Math.floor(n/65536)),t=(n=t+e+65535)-65536*(e=Math.floor(n/65536)),o=(n=o+e+65535)-65536*(e=Math.floor(n/65536)),f=(n=f+e+65535)-65536*(e=Math.floor(n/65536)),D=(n=D+e+65535)-65536*(e=Math.floor(n/65536)),U=(n=U+e+65535)-65536*(e=Math.floor(n/65536)),i=(n=i+e+65535)-65536*(e=Math.floor(n/65536)),s=(n=s+e+65535)-65536*(e=Math.floor(n/65536)),g=(n=g+e+65535)-65536*(e=Math.floor(n/65536)),u=(n=u+e+65535)-65536*(e=Math.floor(n/65536)),c=(n=c+e+65535)-65536*(e=Math.floor(n/65536)),d=(n=d+e+65535)-65536*(e=Math.floor(n/65536)),l=(n=l+e+65535)-65536*(e=Math.floor(n/65536)),E=(n=E+e+65535)-65536*(e=Math.floor(n/65536)),y=(n=y+e+65535)-65536*(e=Math.floor(n/65536)),v=(n=(v+=e-1+37*(e-1))+(e=1)+65535)-65536*(e=Math.floor(n/65536)),B=(n=B+e+65535)-65536*(e=Math.floor(n/65536)),t=(n=t+e+65535)-65536*(e=Math.floor(n/65536)),o=(n=o+e+65535)-65536*(e=Math.floor(n/65536)),f=(n=f+e+65535)-65536*(e=Math.floor(n/65536)),D=(n=D+e+65535)-65536*(e=Math.floor(n/65536)),U=(n=U+e+65535)-65536*(e=Math.floor(n/65536)),i=(n=i+e+65535)-65536*(e=Math.floor(n/65536)),s=(n=s+e+65535)-65536*(e=Math.floor(n/65536)),g=(n=g+e+65535)-65536*(e=Math.floor(n/65536)),u=(n=u+e+65535)-65536*(e=Math.floor(n/65536)),c=(n=c+e+65535)-65536*(e=Math.floor(n/65536)),d=(n=d+e+65535)-65536*(e=Math.floor(n/65536)),l=(n=l+e+65535)-65536*(e=Math.floor(n/65536)),E=(n=E+e+65535)-65536*(e=Math.floor(n/65536)),y=(n=y+e+65535)-65536*(e=Math.floor(n/65536)),v+=e-1+37*(e-1),$[0]=v,$[1]=B,$[2]=t,$[3]=o,$[4]=f,$[5]=D,$[6]=U,$[7]=i,$[8]=s,$[9]=g,$[10]=u,$[11]=c,$[12]=d,$[13]=l,$[14]=E,$[15]=y}var he=aa.jsbn.BigInteger;function ie(e,r,a,t){e.generate=function(e,$){for(var n=new aa.util.ByteBuffer,g=Math.ceil($/t)+a,o=new aa.util.ByteBuffer,i=a;i<g;++i){o.putInt32(i),r.start(),r.update(e+o.getBytes());var f=r.digest();n.putBytes(f.getBytes(t))}return n.truncate(n.length()-$),n.getBytes()}}aa.kem.rsa={},aa.kem.rsa.create=function(e,r){var a=(r=r||{}).prng||aa.random,t={encrypt:function(r,t){var $,n=Math.ceil(r.n.bitLength()/8);do{$=new he(aa.util.bytesToHex(a.getBytesSync(n)),16).mod(r.n)}while($.compareTo(he.ONE)<=0);var g=n-($=aa.util.hexToBytes($.toString(16))).length;return g>0&&($=aa.util.fillString(String.fromCharCode(0),g)+$),{encapsulation:r.encrypt($,"NONE"),key:e.generate($,t)}},decrypt:function(r,a,t){var $=r.decrypt(a,"NONE");return e.generate($,t)}};return t},aa.kem.kdf1=function(e,r){ie(this,e,0,r||e.digestLength)},aa.kem.kdf2=function(e,r){ie(this,e,1,r||e.digestLength)};aa.log.levels=["none","error","warning","info","debug","verbose","max"];var ic={},Tc=[],jc=null;aa.log.LEVEL_LOCKED=2,aa.log.NO_LEVEL_CHECK=4,aa.log.INTERPOLATE=8;for(var pb=0;pb<aa.log.levels.length;++pb){var je=aa.log.levels[pb];ic[je]={index:pb,name:je.toUpperCase()}}aa.log.logMessage=function($){for(var l=ic[$.level].index,e=0;e<Tc.length;++e){var r=Tc[e];if(r.flags&aa.log.NO_LEVEL_CHECK)r.f($);else l<=ic[r.level].index&&r.f(r,$)}},aa.log.prepareStandard=function($){"standard"in $||($.standard=ic[$.level].name+" ["+$.category+"] "+$.message)},aa.log.prepareFull=function($){if(!("full"in $)){var l=[$.message];l=l.concat([]||$.arguments),$.full=aa.util.format.apply(this,l)}},aa.log.prepareStandardFull=function($){"standardFull"in $||(aa.log.prepareStandard($),$.standardFull=$.standard)};var ke=["error","warning","info","debug","verbose"];for(pb=0;pb<ke.length;++pb)!function($){aa.log[$]=function(l,e){var r=Array.prototype.slice.call(arguments).slice(2),o={timestamp:new Date,level:$,category:l,message:e,arguments:r};aa.log.logMessage(o)}}(ke[pb]);if(aa.log.makeLogger=function($){var l={flags:0,f:$};return aa.log.setLevel(l,"none"),l},aa.log.setLevel=function($,l){var e=!1;if($&&!($.flags&aa.log.LEVEL_LOCKED))for(var r=0;r<aa.log.levels.length;++r){if(l==aa.log.levels[r]){$.level=l,e=!0;break}}return e},aa.log.lock=function($,l){void 0===l||l?$.flags|=aa.log.LEVEL_LOCKED:$.flags&=~aa.log.LEVEL_LOCKED},aa.log.addLogger=function($){Tc.push($)},"undefined"!=typeof console&&"log"in console){var Uc;if(console.error&&console.warn&&console.info&&console.debug){var gi={error:console.error,warning:console.warn,info:console.info,debug:console.debug,verbose:console.debug},le=function($,l){aa.log.prepareStandard(l);var e=gi[l.level],r=[l.standard];r=r.concat(l.arguments.slice()),e.apply(console,r)};Uc=aa.log.makeLogger(le)}else{le=function($,l){aa.log.prepareStandardFull(l),console.log(l.standardFull)};Uc=aa.log.makeLogger(le)}aa.log.setLevel(Uc,"debug"),aa.log.addLogger(Uc),jc=Uc}else console={log:function(){}};if(null!==jc){var kc=aa.util.getQueryVariables();if("console.level"in kc&&aa.log.setLevel(jc,kc["console.level"].slice(-1)[0]),"console.lock"in kc){var hi=kc["console.lock"].slice(-1)[0];"true"==hi&&aa.log.lock(jc)}}aa.log.consoleLogger=jc;var fa=aa.asn1,Ha=aa.pkcs7=aa.pkcs7||{};function ii(e){var r={},a=[];if(!fa.validate(e,Ha.asn1.recipientInfoValidator,r,a)){var t=new Error("Cannot read PKCS#7 RecipientInfo. ASN.1 object is not an PKCS#7 RecipientInfo.");throw t.errors=a,t}return{version:r.version.charCodeAt(0),issuer:aa.pki.RDNAttributesAsArray(r.issuer),serialNumber:aa.util.createBuffer(r.serial).toHex(),encryptedContent:{algorithm:fa.derToOid(r.encAlgorithm),parameter:r.encParameter.value,content:r.encKey}}}function ji(e){return fa.create(fa.Class.UNIVERSAL,fa.Type.SEQUENCE,!0,[fa.create(fa.Class.UNIVERSAL,fa.Type.INTEGER,!1,fa.integerToDer(e.version).getBytes()),fa.create(fa.Class.UNIVERSAL,fa.Type.SEQUENCE,!0,[aa.pki.distinguishedNameToAsn1({attributes:e.issuer}),fa.create(fa.Class.UNIVERSAL,fa.Type.INTEGER,!1,aa.util.hexToBytes(e.serialNumber))]),fa.create(fa.Class.UNIVERSAL,fa.Type.SEQUENCE,!0,[fa.create(fa.Class.UNIVERSAL,fa.Type.OID,!1,fa.oidToDer(e.encryptedContent.algorithm).getBytes()),fa.create(fa.Class.UNIVERSAL,fa.Type.NULL,!1,"")]),fa.create(fa.Class.UNIVERSAL,fa.Type.OCTETSTRING,!1,e.encryptedContent.content)])}function ki(e){for(var r=[],a=0;a<e.length;++a)r.push(ii(e[a]));return r}function li(e){for(var r=[],a=0;a<e.length;++a)r.push(ji(e[a]));return r}function mi(e){var r=fa.create(fa.Class.UNIVERSAL,fa.Type.SEQUENCE,!0,[fa.create(fa.Class.UNIVERSAL,fa.Type.INTEGER,!1,fa.integerToDer(e.version).getBytes()),fa.create(fa.Class.UNIVERSAL,fa.Type.SEQUENCE,!0,[aa.pki.distinguishedNameToAsn1({attributes:e.issuer}),fa.create(fa.Class.UNIVERSAL,fa.Type.INTEGER,!1,aa.util.hexToBytes(e.serialNumber))]),fa.create(fa.Class.UNIVERSAL,fa.Type.SEQUENCE,!0,[fa.create(fa.Class.UNIVERSAL,fa.Type.OID,!1,fa.oidToDer(e.digestAlgorithm).getBytes()),fa.create(fa.Class.UNIVERSAL,fa.Type.NULL,!1,"")])]);if(e.authenticatedAttributesAsn1&&r.value.push(e.authenticatedAttributesAsn1),r.value.push(fa.create(fa.Class.UNIVERSAL,fa.Type.SEQUENCE,!0,[fa.create(fa.Class.UNIVERSAL,fa.Type.OID,!1,fa.oidToDer(e.signatureAlgorithm).getBytes()),fa.create(fa.Class.UNIVERSAL,fa.Type.NULL,!1,"")])),r.value.push(fa.create(fa.Class.UNIVERSAL,fa.Type.OCTETSTRING,!1,e.signature)),e.unauthenticatedAttributes.length>0){for(var a=fa.create(fa.Class.CONTEXT_SPECIFIC,1,!0,[]),t=0;t<e.unauthenticatedAttributes.length;++t){var $=e.unauthenticatedAttributes[t];a.values.push(Vc($))}r.value.push(a)}return r}function ni(e){for(var r=[],a=0;a<e.length;++a)r.push(mi(e[a]));return r}function Vc(e){var r;if(e.type===aa.pki.oids.contentType)r=fa.create(fa.Class.UNIVERSAL,fa.Type.OID,!1,fa.oidToDer(e.value).getBytes());else if(e.type===aa.pki.oids.messageDigest)r=fa.create(fa.Class.UNIVERSAL,fa.Type.OCTETSTRING,!1,e.value.bytes());else if(e.type===aa.pki.oids.signingTime){var a=new Date("1950-01-01T00:00:00Z"),t=new Date("2050-01-01T00:00:00Z"),$=e.value;if("string"==typeof $){var n=Date.parse($);$=isNaN(n)?13===$.length?fa.utcTimeToDate($):fa.generalizedTimeToDate($):new Date(n)}r=$>=a&&$<t?fa.create(fa.Class.UNIVERSAL,fa.Type.UTCTIME,!1,fa.dateToUtcTime($)):fa.create(fa.Class.UNIVERSAL,fa.Type.GENERALIZEDTIME,!1,fa.dateToGeneralizedTime($))}return fa.create(fa.Class.UNIVERSAL,fa.Type.SEQUENCE,!0,[fa.create(fa.Class.UNIVERSAL,fa.Type.OID,!1,fa.oidToDer(e.type).getBytes()),fa.create(fa.Class.UNIVERSAL,fa.Type.SET,!0,[r])])}function oi(e){return[fa.create(fa.Class.UNIVERSAL,fa.Type.OID,!1,fa.oidToDer(aa.pki.oids.data).getBytes()),fa.create(fa.Class.UNIVERSAL,fa.Type.SEQUENCE,!0,[fa.create(fa.Class.UNIVERSAL,fa.Type.OID,!1,fa.oidToDer(e.algorithm).getBytes()),fa.create(fa.Class.UNIVERSAL,fa.Type.OCTETSTRING,!1,e.parameter.getBytes())]),fa.create(fa.Class.CONTEXT_SPECIFIC,0,!0,[fa.create(fa.Class.UNIVERSAL,fa.Type.OCTETSTRING,!1,e.content.getBytes())])]}function Wc(e,r,a){var t={};if(!fa.validate(r,a,t,[])){var $=new Error("Cannot read PKCS#7 message. ASN.1 object is not a supported PKCS#7 message.");throw $.errors=$,$}if(fa.derToOid(t.contentType)!==aa.pki.oids.data)throw new Error("Unsupported PKCS#7 message. Only wrapped ContentType Data supported.");if(t.encryptedContent){var n="";if(aa.util.isArray(t.encryptedContent))for(var s=0;s<t.encryptedContent.length;++s){if(t.encryptedContent[s].type!==fa.Type.OCTETSTRING)throw new Error("Malformed PKCS#7 message, expecting encrypted content constructed of only OCTET STRING objects.");n+=t.encryptedContent[s].value}else n=t.encryptedContent;e.encryptedContent={algorithm:fa.derToOid(t.encAlgorithm),parameter:aa.util.createBuffer(t.encParameter.value),content:aa.util.createBuffer(n)}}if(t.content){n="";if(aa.util.isArray(t.content))for(s=0;s<t.content.length;++s){if(t.content[s].type!==fa.Type.OCTETSTRING)throw new Error("Malformed PKCS#7 message, expecting content constructed of only OCTET STRING objects.");n+=t.content[s].value}else n=t.content;e.content=aa.util.createBuffer(n)}return e.version=t.version.charCodeAt(0),e.rawCapture=t,t}function me(e){if(void 0===e.encryptedContent.key)throw new Error("Symmetric key not available.");if(void 0===e.content){var r;switch(e.encryptedContent.algorithm){case aa.pki.oids["aes128-CBC"]:case aa.pki.oids["aes192-CBC"]:case aa.pki.oids["aes256-CBC"]:r=aa.aes.createDecryptionCipher(e.encryptedContent.key);break;case aa.pki.oids.desCBC:case aa.pki.oids["des-EDE3-CBC"]:r=aa.des.createDecryptionCipher(e.encryptedContent.key);break;default:throw new Error("Unsupported symmetric cipher, OID "+e.encryptedContent.algorithm);}if(r.start(e.encryptedContent.parameter),r.update(e.encryptedContent.content),!r.finish())throw new Error("Symmetric decryption failed.");e.content=r.output}}Ha.messageFromPem=function(e){var r=aa.pem.decode(e)[0];if("PKCS7"!==r.type){var a=new Error("Could not convert PKCS#7 message from PEM; PEM header type is not \"PKCS#7\".");throw a.headerType=r.type,a}if(r.procType&&"ENCRYPTED"===r.procType.type)throw new Error("Could not convert PKCS#7 message from PEM; PEM is encrypted.");var t=fa.fromDer(r.body);return Ha.messageFromAsn1(t)},Ha.messageToPem=function(e,r){var a={type:"PKCS7",body:fa.toDer(e.toAsn1()).getBytes()};return aa.pem.encode(a,{maxline:r})},Ha.messageFromAsn1=function(e){var r={},a=[];if(!fa.validate(e,Ha.asn1.contentInfoValidator,r,a)){var t=new Error("Cannot read PKCS#7 message. ASN.1 object is not an PKCS#7 ContentInfo.");throw t.errors=a,t}var $,n=fa.derToOid(r.contentType);switch(n){case aa.pki.oids.envelopedData:$=Ha.createEnvelopedData();break;case aa.pki.oids.encryptedData:$=Ha.createEncryptedData();break;case aa.pki.oids.signedData:$=Ha.createSignedData();break;default:throw new Error("Cannot read PKCS#7 message. ContentType with OID "+n+" is not (yet) supported.");}return $.fromAsn1(r.content.value[0]),$},Ha.createSignedData=function(){var e=null;return e={type:aa.pki.oids.signedData,version:1,certificates:[],crls:[],signers:[],digestAlgorithmIdentifiers:[],contentInfo:null,signerInfos:[],fromAsn1:function(r){if(Wc(e,r,Ha.asn1.signedDataValidator),e.certificates=[],e.crls=[],e.digestAlgorithmIdentifiers=[],e.contentInfo=null,e.signerInfos=[],e.rawCapture.certificates)for(var a=e.rawCapture.certificates.value,t=0;t<a.length;++t)e.certificates.push(aa.pki.certificateFromAsn1(a[t]))},toAsn1:function(){e.contentInfo||e.sign();for(var r=[],a=0;a<e.certificates.length;++a)r.push(aa.pki.certificateToAsn1(e.certificates[a]));var t=[],$=fa.create(fa.Class.CONTEXT_SPECIFIC,0,!0,[fa.create(fa.Class.UNIVERSAL,fa.Type.SEQUENCE,!0,[fa.create(fa.Class.UNIVERSAL,fa.Type.INTEGER,!1,fa.integerToDer(e.version).getBytes()),fa.create(fa.Class.UNIVERSAL,fa.Type.SET,!0,e.digestAlgorithmIdentifiers),e.contentInfo])]);return r.length>0&&$.value[0].value.push(fa.create(fa.Class.CONTEXT_SPECIFIC,0,!0,r)),t.length>0&&$.value[0].value.push(fa.create(fa.Class.CONTEXT_SPECIFIC,1,!0,t)),$.value[0].value.push(fa.create(fa.Class.UNIVERSAL,fa.Type.SET,!0,e.signerInfos)),fa.create(fa.Class.UNIVERSAL,fa.Type.SEQUENCE,!0,[fa.create(fa.Class.UNIVERSAL,fa.Type.OID,!1,fa.oidToDer(e.type).getBytes()),$])},addSigner:function(r){var a=r.issuer,t=r.serialNumber;if(r.certificate){var $=r.certificate;"string"==typeof $&&($=aa.pki.certificateFromPem($)),a=$.issuer.attributes,t=$.serialNumber}var n=r.key;if(!n)throw new Error("Could not add PKCS#7 signer; no private key specified.");"string"==typeof n&&(n=aa.pki.privateKeyFromPem(n));var s=r.digestAlgorithm||aa.pki.oids.sha1;switch(s){case aa.pki.oids.sha1:case aa.pki.oids.sha256:case aa.pki.oids.sha384:case aa.pki.oids.sha512:case aa.pki.oids.md5:break;default:throw new Error("Could not add PKCS#7 signer; unknown message digest algorithm: "+s);}var d=r.authenticatedAttributes||[];if(d.length>0){for(var i=!1,o=!1,S=0;S<d.length;++S){var v=d[S];if(i||v.type!==aa.pki.oids.contentType){if(o||v.type!==aa.pki.oids.messageDigest);else if(o=!0,i)break}else if(i=!0,o)break}if(!i||!o)throw new Error("Invalid signer.authenticatedAttributes. If signer.authenticatedAttributes is specified, then it must contain at least two attributes, PKCS #9 content-type and PKCS #9 message-digest.")}e.signers.push({key:n,version:1,issuer:a,serialNumber:t,digestAlgorithm:s,signatureAlgorithm:aa.pki.oids.rsaEncryption,signature:null,authenticatedAttributes:d,unauthenticatedAttributes:[]})},sign:function(r){var a;(r=r||{},"object"!=typeof e.content||null===e.contentInfo)&&(e.contentInfo=fa.create(fa.Class.UNIVERSAL,fa.Type.SEQUENCE,!0,[fa.create(fa.Class.UNIVERSAL,fa.Type.OID,!1,fa.oidToDer(aa.pki.oids.data).getBytes())]),"content"in e&&(e.content instanceof aa.util.ByteBuffer?a=e.content.bytes():"string"==typeof e.content&&(a=aa.util.encodeUtf8(e.content)),r.detached?e.detachedContent=fa.create(fa.Class.UNIVERSAL,fa.Type.OCTETSTRING,!1,a):e.contentInfo.value.push(fa.create(fa.Class.CONTEXT_SPECIFIC,0,!0,[fa.create(fa.Class.UNIVERSAL,fa.Type.OCTETSTRING,!1,a)]))));0!==e.signers.length&&function(r){var a;a=e.detachedContent?e.detachedContent:(a=e.contentInfo.value[1]).value[0];if(!a)throw new Error("Could not sign PKCS#7 message; there is no content to sign.");var t=fa.derToOid(e.contentInfo.value[0].value),$=fa.toDer(a);for(var n in $.getByte(),fa.getBerValueLength($),$=$.getBytes(),r)r[n].start().update($);for(var s=new Date,d=0;d<e.signers.length;++d){var i=e.signers[d];if(0===i.authenticatedAttributes.length){if(t!==aa.pki.oids.data)throw new Error("Invalid signer; authenticatedAttributes must be present when the ContentInfo content type is not PKCS#7 Data.")}else{i.authenticatedAttributesAsn1=fa.create(fa.Class.CONTEXT_SPECIFIC,0,!0,[]);for(var o=fa.create(fa.Class.UNIVERSAL,fa.Type.SET,!0,[]),S=0;S<i.authenticatedAttributes.length;++S){var v=i.authenticatedAttributes[S];v.type===aa.pki.oids.messageDigest?v.value=r[i.digestAlgorithm].digest():v.type===aa.pki.oids.signingTime&&(v.value||(v.value=s)),o.value.push(Vc(v)),i.authenticatedAttributesAsn1.value.push(Vc(v))}$=fa.toDer(o).getBytes(),i.md.start().update($)}i.signature=i.key.sign(i.md,"RSASSA-PKCS1-V1_5")}e.signerInfos=ni(e.signers)}(function(){for(var r={},a=0;a<e.signers.length;++a){var t=e.signers[a],$=t.digestAlgorithm;$ in r||(r[$]=aa.md[aa.pki.oids[$]].create()),0===t.authenticatedAttributes.length?t.md=r[$]:t.md=aa.md[aa.pki.oids[$]].create()}for(var $ in e.digestAlgorithmIdentifiers=[],r)e.digestAlgorithmIdentifiers.push(fa.create(fa.Class.UNIVERSAL,fa.Type.SEQUENCE,!0,[fa.create(fa.Class.UNIVERSAL,fa.Type.OID,!1,fa.oidToDer($).getBytes()),fa.create(fa.Class.UNIVERSAL,fa.Type.NULL,!1,"")]));return r}())},verify:function(){throw new Error("PKCS#7 signature verification not yet implemented.")},addCertificate:function(r){"string"==typeof r&&(r=aa.pki.certificateFromPem(r)),e.certificates.push(r)},addCertificateRevokationList:function(e){throw new Error("PKCS#7 CRL support not yet implemented.")}}},Ha.createEncryptedData=function(){var e=null;return e={type:aa.pki.oids.encryptedData,version:0,encryptedContent:{algorithm:aa.pki.oids["aes256-CBC"]},fromAsn1:function(r){Wc(e,r,Ha.asn1.encryptedDataValidator)},decrypt:function(r){void 0!==r&&(e.encryptedContent.key=r),me(e)}}},Ha.createEnvelopedData=function(){var e=null;return e={type:aa.pki.oids.envelopedData,version:0,recipients:[],encryptedContent:{algorithm:aa.pki.oids["aes256-CBC"]},fromAsn1:function(r){var a=Wc(e,r,Ha.asn1.envelopedDataValidator);e.recipients=ki(a.recipientInfos.value)},toAsn1:function(){return fa.create(fa.Class.UNIVERSAL,fa.Type.SEQUENCE,!0,[fa.create(fa.Class.UNIVERSAL,fa.Type.OID,!1,fa.oidToDer(e.type).getBytes()),fa.create(fa.Class.CONTEXT_SPECIFIC,0,!0,[fa.create(fa.Class.UNIVERSAL,fa.Type.SEQUENCE,!0,[fa.create(fa.Class.UNIVERSAL,fa.Type.INTEGER,!1,fa.integerToDer(e.version).getBytes()),fa.create(fa.Class.UNIVERSAL,fa.Type.SET,!0,li(e.recipients)),fa.create(fa.Class.UNIVERSAL,fa.Type.SEQUENCE,!0,oi(e.encryptedContent))])])])},findRecipient:function(r){for(var a=r.issuer.attributes,t=0;t<e.recipients.length;++t){var $=e.recipients[t],n=$.issuer;if($.serialNumber===r.serialNumber&&n.length===a.length){for(var s=!0,d=0;d<a.length;++d)if(n[d].type!==a[d].type||n[d].value!==a[d].value){s=!1;break}if(s)return $}}return null},decrypt:function(r,a){if(void 0===e.encryptedContent.key&&void 0!==r&&void 0!==a)switch(r.encryptedContent.algorithm){case aa.pki.oids.rsaEncryption:case aa.pki.oids.desCBC:var t=a.decrypt(r.encryptedContent.content);e.encryptedContent.key=aa.util.createBuffer(t);break;default:throw new Error("Unsupported asymmetric cipher, OID "+r.encryptedContent.algorithm);}me(e)},addRecipient:function(r){e.recipients.push({version:0,issuer:r.issuer.attributes,serialNumber:r.serialNumber,encryptedContent:{algorithm:aa.pki.oids.rsaEncryption,key:r.publicKey}})},encrypt:function(r,a){if(void 0===e.encryptedContent.content){var t,$,n;switch(a=a||e.encryptedContent.algorithm,r=r||e.encryptedContent.key,a){case aa.pki.oids["aes128-CBC"]:t=16,$=16,n=aa.aes.createEncryptionCipher;break;case aa.pki.oids["aes192-CBC"]:t=24,$=16,n=aa.aes.createEncryptionCipher;break;case aa.pki.oids["aes256-CBC"]:t=32,$=16,n=aa.aes.createEncryptionCipher;break;case aa.pki.oids["des-EDE3-CBC"]:t=24,$=8,n=aa.des.createEncryptionCipher;break;default:throw new Error("Unsupported symmetric cipher, OID "+a);}if(void 0===r)r=aa.util.createBuffer(aa.random.getBytes(t));else if(r.length()!=t)throw new Error("Symmetric key has wrong length; got "+r.length()+" bytes, expected "+t+".");e.encryptedContent.algorithm=a,e.encryptedContent.key=r,e.encryptedContent.parameter=aa.util.createBuffer(aa.random.getBytes($));var s=n(r);if(s.start(e.encryptedContent.parameter.copy()),s.update(e.content),!s.finish())throw new Error("Symmetric encryption failed.");e.encryptedContent.content=s.output}for(var d=0;d<e.recipients.length;++d){var i=e.recipients[d];if(void 0===i.encryptedContent.content)switch(i.encryptedContent.algorithm){case aa.pki.oids.rsaEncryption:i.encryptedContent.content=i.encryptedContent.key.encrypt(e.encryptedContent.key.data);break;default:throw new Error("Unsupported asymmetric cipher, OID "+i.encryptedContent.algorithm);}}}}};var lc=aa.ssh=aa.ssh||{};function $a(r,e){var t=e.toString(16);t[0]>="8"&&(t="00"+t);var $=aa.util.hexToBytes(t);r.putInt32($.length),r.putBytes($)}function Db(r,e){r.putInt32(e.length),r.putString(e)}function mc(){for(var r=aa.md.sha1.create(),e=arguments.length,t=0;t<e;++t)r.update(arguments[t]);return r.digest()}lc.privateKeyToPutty=function(r,e,t){var $=""===(e=e||"")?"none":"aes256-cbc",a="PuTTY-User-Key-File-2: ssh-rsa\r\n";a+="Encryption: "+$+"\r\n",a+="Comment: "+(t=t||"")+"\r\n";var n=aa.util.createBuffer();Db(n,"ssh-rsa"),$a(n,r.e),$a(n,r.n);var f=aa.util.encode64(n.bytes(),64),i=Math.floor(f.length/66)+1;a+="Public-Lines: "+i+"\r\n",a+=f;var u,o=aa.util.createBuffer();if($a(o,r.d),$a(o,r.p),$a(o,r.q),$a(o,r.qInv),e){var g=o.length()+16-1;g-=g%16;var v=mc(o.bytes());v.truncate(v.length()-g+o.length()),o.putBuffer(v);var s=aa.util.createBuffer();s.putBuffer(mc("\0\0\0\0",e)),s.putBuffer(mc("\0\0\0\x01",e));var x=aa.aes.createEncryptionCipher(s.truncate(8),"CBC");x.start(aa.util.createBuffer().fillWithByte(0,16)),x.update(o.copy()),x.finish();var d=x.output;d.truncate(16),u=aa.util.encode64(d.bytes(),64)}else u=aa.util.encode64(o.bytes(),64);a+="\r\nPrivate-Lines: "+(i=Math.floor(u.length/66)+1)+"\r\n",a+=u;var w=mc("putty-private-key-file-mac-key",e),V=aa.util.createBuffer();Db(V,"ssh-rsa"),Db(V,$),Db(V,t),V.putInt32(n.length()),V.putBuffer(n),V.putInt32(o.length()),V.putBuffer(o);var c=aa.hmac.create();return c.start("sha1",w),c.update(V.bytes()),a+="\r\nPrivate-MAC: "+c.digest().toHex()+"\r\n"},lc.publicKeyToOpenSSH=function(r,e){e=e||"";var t=aa.util.createBuffer();return Db(t,"ssh-rsa"),$a(t,r.e),$a(t,r.n),"ssh-rsa "+aa.util.encode64(t.bytes())+" "+e},lc.privateKeyToOpenSSH=function(r,e){return e?aa.pki.encryptRsaPrivateKey(r,e,{legacy:!0,algorithm:"aes128"}):aa.pki.privateKeyToPem(r)},lc.getPublicKeyFingerprint=function(r,e){var t=(e=e||{}).md||aa.md.md5.create(),$=aa.util.createBuffer();Db($,"ssh-rsa"),$a($,r.e),$a($,r.n),t.start(),t.update($.getBytes());var a=t.digest();if("hex"===e.encoding){var n=a.toHex();return e.delimiter?n.match(/.{2}/g).join(e.delimiter):n}if("binary"===e.encoding)return a.getBytes();if(e.encoding)throw new Error("Unknown encoding \""+e.encoding+"\".");return a};var Ua="forge.task",Rb=0,Xc={},pi=0;aa.debug.set(Ua,"tasks",Xc);var Fa={};aa.debug.set(Ua,"queues",Fa);var ne="?",qi=30,ri=20,qb="ready",Ia="running",Va="blocked",Sa="sleeping",Ea="done",Wa="error",rb="stop",jb="start",Eb="block",Fb="sleep",sb="cancel",sa={};sa[qb]={},sa[qb][rb]=qb,sa[qb][jb]=Ia,sa[qb][sb]=Ea,sa[Ia]={},sa[Ia][rb]=qb,sa[Ia][jb]=Ia,sa[Ia][Eb]=Va,sa[Ia][Fb]=Sa,sa[Ia][sb]=Ea,sa[Va]={},sa[Va][rb]=Va,sa[Va][jb]=Va,sa[Va][Eb]=Va,sa[Va][Fb]=Va,sa[Va][sb]=Ea,sa[Sa]={},sa[Sa][rb]=Sa,sa[Sa][jb]=Sa,sa[Sa][Eb]=Sa,sa[Sa][Fb]=Sa,sa[Sa][sb]=Ea,sa[Ea]={},sa[Ea][rb]=Ea,sa[Ea][jb]=Ea,sa[Ea][Eb]=Ea,sa[Ea][Fb]=Ea,sa[Ea][sb]=Ea,sa[Wa]={},sa[Wa][rb]=Wa,sa[Wa][jb]=Wa,sa[Wa][Eb]=Wa,sa[Wa][Fb]=Wa,sa[Wa][sb]=Wa;var Ma=function($){this.id=-1,this.name=$.name||ne,this.parent=$.parent||null,this.run=$.run,this.subtasks=[],this.error=!1,this.state=qb,this.blocks=0,this.timeoutId=null,this.swapTime=null,this.userData=null,this.id=pi++,Xc[this.id]=this,Rb>=1&&aa.log.verbose(Ua,"[%s][%s] init",this.id,this.name,this)};Ma.prototype.debug=function($){$=$||"",aa.log.debug(Ua,$,"[%s][%s] task:",this.id,this.name,this,"subtasks:",this.subtasks.length,"queue:",Fa)},Ma.prototype.next=function($,e){"function"==typeof $&&(e=$,$=this.name);var s=new Ma({run:e,name:$,parent:this});return s.state=Ia,s.type=this.type,s.successCallback=this.successCallback||null,s.failureCallback=this.failureCallback||null,this.subtasks.push(s),this},Ma.prototype.parallel=function($,e){return aa.util.isArray($)&&(e=$,$=this.name),this.next($,function(s){var a=s;a.block(e.length);for(var r=function($,s){aa.task.start({type:$,run:function($){e[s]($)},success:function($){a.unblock()},failure:function($){a.unblock()}})},t=0;t<e.length;t++){r($+"__parallel-"+s.id+"-"+t,t)}})},Ma.prototype.stop=function(){this.state=sa[this.state][rb]},Ma.prototype.start=function(){this.error=!1,this.state=sa[this.state][jb],this.state===Ia&&(this.start=new Date,this.run(this),kb(this,0))},Ma.prototype.block=function($){$=void 0===$?1:$,this.blocks+=$,this.blocks>0&&(this.state=sa[this.state][Eb])},Ma.prototype.unblock=function($){return $=void 0===$?1:$,this.blocks-=$,0===this.blocks&&this.state!==Ea&&(this.state=Ia,kb(this,0)),this.blocks},Ma.prototype.sleep=function($){$=void 0===$?0:$,this.state=sa[this.state][Fb];var e=this;this.timeoutId=setTimeout(function(){e.timeoutId=null,e.state=Ia,kb(e,0)},$)},Ma.prototype.wait=function($){$.wait(this)},Ma.prototype.wakeup=function(){this.state===Sa&&(cancelTimeout(this.timeoutId),this.timeoutId=null,this.state=Ia,kb(this,0))},Ma.prototype.cancel=function(){this.state=sa[this.state][sb],this.permitsNeeded=0,null!==this.timeoutId&&(cancelTimeout(this.timeoutId),this.timeoutId=null),this.subtasks=[]},Ma.prototype.fail=function($){if(this.error=!0,Yc(this,!0),$)$.error=this.error,$.swapTime=this.swapTime,$.userData=this.userData,kb($,0);else{if(null!==this.parent){for(var e=this.parent;null!==e.parent;)e.error=this.error,e.swapTime=this.swapTime,e.userData=this.userData,e=e.parent;Yc(e,!0)}this.failureCallback&&this.failureCallback(this)}};var si=function($){$.error=!1,$.state=sa[$.state][jb],setTimeout(function(){$.state===Ia&&($.swapTime=+new Date,$.run($),kb($,0))},0)},kb=function($,e){var s=e>qi||+new Date-$.swapTime>ri,a=function(e){if(e++,$.state===Ia)if(s&&($.swapTime=+new Date),$.subtasks.length>0){var a=$.subtasks.shift();a.error=$.error,a.swapTime=$.swapTime,a.userData=$.userData,a.run(a),a.error||kb(a,e)}else Yc($),$.error||null!==$.parent&&($.parent.error=$.error,$.parent.swapTime=$.swapTime,$.parent.userData=$.userData,kb($.parent,e))};s?setTimeout(a,0):a(e)},Yc=function($,e){$.state=Ea,delete Xc[$.id],Rb>=1&&aa.log.verbose(Ua,"[%s][%s] finish",$.id,$.name,$),null===$.parent&&($.type in Fa?0===Fa[$.type].length?aa.log.error(Ua,"[%s][%s] task queue empty [%s]",$.id,$.name,$.type):Fa[$.type][0]!==$?aa.log.error(Ua,"[%s][%s] task not first in queue [%s]",$.id,$.name,$.type):(Fa[$.type].shift(),0===Fa[$.type].length?(Rb>=1&&aa.log.verbose(Ua,"[%s][%s] delete queue [%s]",$.id,$.name,$.type),delete Fa[$.type]):(Rb>=1&&aa.log.verbose(Ua,"[%s][%s] queue start next [%s] remain:%s",$.id,$.name,$.type,Fa[$.type].length),Fa[$.type][0].start())):aa.log.error(Ua,"[%s][%s] task queue missing [%s]",$.id,$.name,$.type),e||($.error&&$.failureCallback?$.failureCallback($):!$.error&&$.successCallback&&$.successCallback($)))};aa.task.start=function($){var e=new Ma({run:$.run,name:$.name||ne});e.type=$.type,e.successCallback=$.success||null,e.failureCallback=$.failure||null,e.type in Fa?Fa[$.type].push(e):(Rb>=1&&aa.log.verbose(Ua,"[%s][%s] create queue [%s]",e.id,e.name,e.type),Fa[e.type]=[e],si(e))},aa.task.cancel=function($){$ in Fa&&(Fa[$]=[Fa[$][0]])},aa.task.createCondition=function(){var $={tasks:{},wait:function(e){e.id in $.tasks||(e.block(),$.tasks[e.id]=e)},notify:function(){var e=$.tasks;for(var s in $.tasks={},e)e[s].unblock()}};return $};_a=aa;document.addEventListener("DOMContentLoaded",function(e){console.log("loaded");const r=qe();r.showReceiveSectionButton.addEventListener("click",()=>{r.receiveSection.classList.remove("hidden"),r.sendSection.classList.add("hidden")}),r.showSendSectionButton.addEventListener("click",()=>{r.receiveSection.classList.add("hidden"),r.sendSection.classList.remove("hidden")}),r.decryptMessageButton.addEventListener("click",()=>{const e=r.receiveEncryptedMessageArea.value,t=_a.util.decode64(e),n=_a.pki.privateKeyFromPem(r.receivePrivateKeyArea.value).decrypt(t),a=_a.util.decodeUtf8(n);r.decryptedMessageArea.value=a}),r.encryptMessageButton.addEventListener("click",()=>{const e=r.sendPublicKeyArea.value,t=r.secretMessageArea.value,n=_a.pki.publicKeyFromPem(e),a=_a.util.encodeUtf8(t),s=n.encrypt(a),i=_a.util.encode64(s);r.sendEncryptedMessageArea.value=i}),r.generateKeysButton.addEventListener("click",async()=>{const e=await pe();if(e.isError)return void console.error(e);const t=e.result;r.receivePublicKeyArea.value=_a.pki.publicKeyToPem(t.publicKey),r.receivePrivateKeyArea.value=_a.pki.privateKeyToPem(t.privateKey)})});})();